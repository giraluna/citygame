function findType(a,b){if("undefined"==typeof b&&(b=cg),buildingTypeIndexes[a])return buildingTypeIndexes[a];for(var c in b){if(b[c].type===a)return buildingTypeIndexes[a]=b[c],b[c];if("object"==typeof b[c]&&!b[c].type){var d=findType(a,b[c]);if(d)return d}}}function getFrom2dArray(a,b){for(var c=[],d=0;d<b.length;d++)void 0!==b[d]&&b[d][0]>=0&&b[d][0]<a.length&&b[d][1]>=0&&b[d][1]<a.length&&c.push(a[b[d][0]][b[d][1]]);return c}function getRandomKey(a){var b=Object.keys(a),c=Math.floor(Math.random()*b.length);return b[c]}function getRandomProperty(a){var b=a[getRandomKey(a)];return b}function getRandomArrayItem(a){var b=Math.floor(Math.random()*a.length);return a[b]}function setDeepProperties(a,b,c){if(b.length<=0){for(var d in c)a[d]=c[d];return a}var e=b.shift();a.hasOwnProperty(e)||(a[e]={});var f=a[e];return setDeepProperties(f,b,c)}function deepDestroy(a){if(a.texture&&(a.texture.baseTexture.source._pixiId&&PIXI.Texture.removeTextureFromCache(a.texture.baseTexture.source._pixiId),a.texture.destroy(!0)),a.children&&!(a.children.length<=0))for(var b=0;b<a.children.length;b++)deepDestroy(a.children[b])}function rectToIso(a,b){var c=[a/2,0],d=[a,b/2],e=[a/2,b],f=[0,b/2];return[c,d,e,f]}function getOrthoCoord(a,b,c){var d=a[0]/b[0]+a[1]/b[1]-c[0]/2,e=a[1]/b[1]-a[0]/b[0]+c[1]/2;return[Math.floor(d),Math.floor(e)]}function getIsoCoord(a,b,c,d,e){var f=c/2,g=d/2,h=(a-b)*f,i=(a+b)*g;return e&&(h+=e[0],i+=e[1]),[h,i]}function getTileScreenPosition(a,b,c,d,e){{var f=e.worldTransform,g=f.a;[f.tx+d[0]/2*g,f.ty+c[1]/2*g]}c[0]*=g,c[1]*=g}function randInt(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function randRange(a,b){return Math.random()*(b-a)+a}function rollDice(a,b){for(var c=0,d=0;a>d;d++)c+=randInt(1,b);return c}function spritesheetToImages(a,b){var c=new Image;c.src=b+a.meta.image;var d={};return function(){for(var b in a.frames){var e=a.frames[b].frame,f=d[b]=new Image(e.w,e.h),g=document.createElement("canvas");g.width=e.w,g.height=e.h;var h=g.getContext("2d");h.drawImage(c,e.x,e.y,e.w,e.h,0,0,e.w,e.h),f.src=g.toDataURL(),d[b]=f}}(),d}function addClickAndTouchEventListener(a,b){function c(a){a.preventDefault(),b.call()}a.addEventListener("click",c),a.addEventListener("touchend",c)}function hslToRgb(a,b,c){function d(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var e,f,g;if(0==b)e=f=g=c;else{var h=.5>c?c*(1+b):c+b-c*b,i=2*c-h;e=d(i,h,a+1/3),f=d(i,h,a),g=d(i,h,a-1/3)}return[e,f,g]}function hslToHex(a,b,c){return PIXI.rgb2hex(hslToRgb(a,b,c))}function getNeighbors(a,b,c){"undefined"==typeof c&&(c=!1);var d={n:void 0,e:void 0,s:void 0,w:void 0,ne:void 0,nw:void 0,se:void 0,sw:void 0},e={n:void 0,e:void 0,s:void 0,w:void 0},f=a,g=a.length,h=a[0].length,i=b[0],j=b[1];return e.s=h>j+1?!0:!1,e.e=g>i+1?!0:!1,e.n=j-1>=0?!0:!1,e.w=i-1>=0?!0:!1,d.s=e.s?f[i][j+1]:void 0,d.e=e.e?f[i+1][j]:void 0,d.n=e.n?f[i][j-1]:void 0,d.w=e.w?f[i-1][j]:void 0,c===!0&&(d.ne=e.n&&e.e?f[i+1][j-1]:void 0,d.nw=e.n&&e.w?f[i-1][j-1]:void 0,d.se=e.s&&e.e?f[i+1][j+1]:void 0,d.sw=e.s&&e.w?f[i-1][j+1]:void 0),d}function getDistanceFromCell(a,b,c,d){"undefined"==typeof d&&(d=!1),c++;for(var e=[],f={},g=0;g<b.length;g++)f[b[g].gridPos]={item:b[g],distance:1,invertedDistance:c,invertedDistanceRatio:1},e.push(b[g]);for(;e.length>0;){var h,i=e.shift();h=void 0!==i.getNeighbors?i.getNeighbors(d):getNeighbors(a,i.gridPos,d);for(var j in h){var k=h[j];if(void 0!==k&&void 0===f[k.gridPos]){var l=1;d&&-1!==["ne","nw","se","sw"].indexOf(j)&&(l=1.375);var m=f[i.gridPos].distance+l;if(m>c)break;f[k.gridPos]={item:k,distance:m,invertedDistance:c+1-m,invertedDistanceRatio:(c+1-m)/c},e.push(k)}}}return f}function getArea(a){var b=a.targetArray,c=a.centerSize||[1,1],d=a.start,e=[d[0]+c[0]-1,d[1]+c[1]-1],f=a.size,g=a.anchor||"center",h=a.excludeStart||!1,i=d.slice(0),j=e.slice(0),k=[[0,0],[0,0]];"center"===g&&(k=[[-1,-1],[1,1]]),"ne"===g&&(k[1]=[-1,1]),"se"===g&&(k[1]=[-1,-1]),"sw"===g&&(k[1]=[1,-1]),"nw"===g&&(k[1]=[1,1]);for(var l=0;f>l;l++)i[0]+=k[0][0],i[1]+=k[0][1],j[0]+=k[1][0],j[1]+=k[1][1];var m=rectSelect(i,j);return h&&(m=m.filter(function(a){return a[0]>=d[0]&&a[0]<=e[0]&&a[1]>=d[1]&&a[1]<=e[1]?void 0:a})),getFrom2dArray(b,m)}function singleSelect(a,b){return[b]}function rectSelect(a,b){for(var c,d,e=[],f=Math.abs(a[0]-b[0]),g=Math.abs(a[1]-b[1]),h=b[0]<a[0]?-1:1,i=b[1]<a[1]?-1:1,j=0;f>=j;j++){c=a[0]+j*h;for(var k=0;g>=k;k++)d=a[1]+k*i,e.push([c,d])}return e}function manhattanSelect(a,b){var c,d,e=Math.abs(a[0]-b[0]),f=Math.abs(a[1]-b[1]),g=b[0]<a[0]?-1:1,h=b[1]<a[1]?-1:1,i=[];if(e>=f){for(var j=0;e>=j;j++)d=a[0]+j*g,i.push([d,a[1]]);for(var k=1;f>=k;k++)c=a[1]+k*h,i.push([b[0],c])}else{for(var k=0;f>=k;k++)c=a[1]+k*h,i.push([a[0],c]);for(var j=1;e>=j;j++)d=a[0]+j*g,i.push([d,b[1]])}return i}function arrayToPolygon(a){for(var b=[],c=0;c<a.length;c++)b.push(new PIXI.Point(a[c][0],a[c][1]));return new PIXI.Polygon(b)}function arrayToPoint(a){return new PIXI.Point(a[0],a[1])}function getReverseDir(a){switch(a){case"n":return"s";case"s":return"n";case"e":return"w";case"w":return"e";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function formatEveryThirdPower(a,b){return function(c){var d=0,e="";if(c>=1e6&&isFinite(c)){for(c/=1e3;Math.round(c)>=1e3;)c/=1e3,d++;if(d>a.length)return"Infinity";e=a[d]}return(Math.round(1e3*c)/1e3).toFixed(b)+e}}function rawFormatter(a){return Math.round(1e3*a/1e3)}function beautify(a,b){"undefined"==typeof b&&(b=0);var c=0>a;a=Math.abs(a);var d=numberFormatters[b],e=d(a).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");return c?"-"+e:e}function toggleDebugmode(){var a=document.getElementById("react-side-menu"),b=document.getElementById("side-menu"),c=document.getElementById("speed");[a,b,c].forEach(function(a){a.classList.toggle("debug-hidden")})}function capitalize(a){return a.substring(0,1).toUpperCase()+a.substring(1)}function cloneObject(a){var b={};for(var c in a)b[c]=a[c];return b}function drawCoastInConsole(a){for(var b=0;b<a.finalCoast.length;b++){for(var c=""+b,d=[""],e=0;e<a.finalCoast[b].length;e++){var f=1===a.finalCoast[b][e]?"#0F0":"#00F";c+="%c  ",d.push("background: "+f)}d[0]=c,console.log.apply(console,d)}}function drawNeighbors(a,b){var c=[["nw","n","ne"],["w","_c","e"],["sw","s","se"]];a._c=b;for(var d=0;d<c.length;d++)for(var e=""+d,f=[""],g=0;g<c[d].length;g++){var h=c[d][g];if(a[h]){var i="grass"===a[h]?"#0F0":"#00F";e+="%c    ",f.push("background: "+i)}}f[0]=e,console.log.apply(console,f)}function makeLandValueOverlay(a){function b(a){var b=d-c;1>b&&(b=1);var e=b/6;1>e&&(e=1);var f=(Math.round(a/e)*e-c)/b;return f}for(var c,d,e=[],f={},g=0;g<a.width;g++)for(var h=0;h<a.height;h++){var i=a.cells[g][h];"water"!==i.type.type&&(c?i.landValue<c?c=i.landValue:i.landValue>d&&(d=i.landValue):c=d=i.landValue,e.push({value:i.landValue,sprite:i.sprite}))}for(var j=new PIXI.DisplayObjectContainer,g=0;g<e.length;g++){var i=e[g];if(!f[i.value]){var k=b(i.value);0>k?k=0:k>1&&(k=1);var l=100-100*k,m=1-.2*k,n=.75+.25*k;f[i.value]=hslToHex(l/360,m,n/2)}var o=f[i.value],p=PIXI.Sprite.fromFrame("blank.png");p.position=i.sprite.position.clone(),p.position.y-=i.sprite.height-31,p.anchor=i.sprite.anchor.clone(),p.tint=o,j.addChild(p)}return j}function makeNewEmployees(a,b){for(var c=[],d=function(a){return.0526316*a-.0526316},e=b>6?1:3-.868589*Math.log(b),f=0;a>f;f++){var g=new Employee(names,{skillLevel:d(b),growthLevel:Math.random(),skillVariance:e});c.push(g)}return c}function getRoadConnections(a,b){var c={},d="",e=a.getNeighbors(!1);for(var f in e)e[f]&&e[f].content&&"road"===e[f].content.baseType&&(c[f]=!0);if(b>0)for(var g in c)getRoadConnections(e[g],b-1);for(var g in c)d+=g;if(""===d)return null;if("n"===d||"s"===d||"ns"===d?d="v":("e"===d||"w"===d||"ew"===d)&&(d="h"),a.content&&"road"===a.content.baseType){var h=cg.content.roads["road_"+d];a.changeContent(h,!1)}}function getTubeConnections(a,b){var c={},d="",e=a.getNeighbors(!1);for(var f in e)e[f]&&e[f].undergroundContent&&"tube"===e[f].undergroundContent.baseType&&(c[f]=!0);if(b>0)for(var g in c)getTubeConnections(e[g],b-1);for(var g in c)d+=g;if(""===d)return null;if("n"===d||"s"===d||"ns"===d?d="v":("e"===d||"w"===d||"ew"===d)&&(d="h"),a.undergroundContent&&"tube"===a.undergroundContent.baseType){var h=cg.content.tubes["tube_"+d];a.changeUndergroundContent(h,!1)}}function pineapple(){cg.content.buildings.pineapple={type:"pineapple",baseType:"building",width:64,height:128,anchor:[.5,1.25],frame:"pineapple2.png"}}function makeToolTip(a,b){var c,d=new PIXI.DisplayObjectContainer;c=a.autoSize||!a.width?makeSpeechRect(a,b):makeSpeechRect(a);var e=c[0],f=c[1],g=new PIXI.Graphics;return drawPolygon(g,e,a.style.lineStyle,a.style.fillStyle),b.position.set(f[0]+a.padding[0],f[1]+a.padding[1]),d.addChild(g),d.addChild(b),d}function drawPolygon(a,b,c,d){a.lineStyle(c.width,c.color,c.alpha),a.beginFill(d.color,d.alpha),a.moveTo(b[0][0],b[0][1]);for(var e=1;e<b.length;e++)if(b[e][0]!==b[e-1][0]||b[e][1]!==b[e-1][1]){var f=b[e][0],g=b[e][1];a.lineTo(f,g)}return a.endFill(),a}function makeSpeechRect(a,b){var c=a.width||200,d=a.height||100,e=a.padding||10,f=a.tipPos||.25,g=a.tipWidth||10,h=a.tipHeight||20,i=a.tipDir||"right",j=a.pointing||"down";b&&(c=b.width+2*e[0],d=b.height+2*e[1]);var k,l,m=c*(1-f),n=d+h,o=-c*f,p=h,q="down"===j?-1:1;return"down"===j?(k=[[0,0],[0,-p],[m,-p],[m,-n],[o,-n],[o,-p],[0,-p],[0,0]],l=[o,-n]):"up"===j&&(k=[[0,0],[0,p],[m,p],[m,n],[o,n],[o,p],[0,p],[0,0]],l=[o,p]),"right"===i?k[1][0]=g:"left"===i&&(k[6][0]=-g),0>f?(k[1][0]=k[5][0]+g,k[5]=k[6]=[k[5][0],k[5][1]+g*q]):f>1&&(k[6][0]=k[2][0]-g,k[2]=k[1]=[k[2][0],k[2][1]+g*q]),[k,l]}var UIComponents;!function(a){a.Draggable={handleDragStart:function(a){this.DOMNode.style.zIndex=this.props.incrementZIndex(),a.nativeEvent.dataTransfer&&(a.nativeEvent.dataTransfer.dropEffect="move",this.offset={x:a.nativeEvent.pageX-parseInt(this.DOMNode.style.left),y:a.nativeEvent.pageY-parseInt(this.DOMNode.style.top)})},handleDrag:function(a){if(0!==a.clientX||0!==a.clientY){var b=a.clientX-this.offset.x,c=a.clientY-this.offset.y,d=parseInt(this.DOMNode.offsetWidth),e=parseInt(this.DOMNode.offsetHeight),f=parseInt(this.pixiContainer.offsetWidth),g=parseInt(this.pixiContainer.offsetHeight),h=b+d,i=c+e;0>b?b=0:h>f&&(b=f-d),0>c?c=0:i>g&&(c=g-e),this.DOMNode.style.left=b+"px",this.DOMNode.style.top=c+"px"}},handleDragEnd:function(){},componentDidMount:function(){this.DOMNode=this.getDOMNode(),this.pixiContainer=document.getElementById("pixi-container")}}}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.SplitMultilineText={splitMultilineText:function(a){if(Array.isArray(a)){for(var b=[],c=0;c<a.length;c++)b.push(a[c]),b.push(React.DOM.br(null));return b}return a}}}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.List=React.createClass({mixins:[a.SplitMultilineText],getInitialState:function(){var a=this.props.initialColumn||this.props.initialColumns[0],b=this.props.listItems[0];return{columns:this.props.initialColumns,selected:b,sortBy:{column:a,order:a.defaultOrder||"desc",currColumnIndex:this.props.initialColumns.indexOf(a)}}},componentDidMount:function(){var a=this;this.handleSelectRow(this.props.sortedItems[0]),this.getDOMNode().addEventListener("keydown",function(b){switch(b.keyCode){case 40:a.shiftSelection(1);break;case 38:a.shiftSelection(-1);break;default:return}})},handleSelectColumn:function(a){if(!a.notSortable){var b;b=this.state.sortBy.column.key===a.key?"desc"===this.state.sortBy.order?"asc":"desc":a.defaultOrder,this.setState({sortBy:{column:a,order:b,currColumnIndex:this.state.columns.indexOf(a)}})}},handleSelectRow:function(a){this.props.onRowChange&&this.props.onRowChange.call(null,a),this.setState({selected:a})},sort:function(){var a=this,b=this.state.sortBy.column,c=b.propToSortBy||b.key,d=this.props.listItems,e=function(b,d){for(var e=c,f=a.state.sortBy.currColumnIndex,g=0;g<a.state.columns.length&&b.data[e]===d.data[e];g++){f=(f+1)%a.state.columns.length;var h=a.state.columns[f];e=h.propToSortBy||h.key}return b.data[e]>d.data[e]?1:-1};d.sort(b.sortingFunction?function(a,c){var d=b.sortingFunction(a,c);return 0===d&&(d=e(a,c)),d}:e),"desc"===this.state.sortBy.order&&d.reverse(),this.props.sortedItems=d},shiftSelection:function(a){for(var b={},c=0;c<this.props.sortedItems.length;c++)b[this.props.sortedItems[c].key]=c;var d=b[this.state.selected.key],e=(d+a)%this.props.sortedItems.length;0>e&&(e+=this.props.sortedItems.length),this.setState({selected:this.props.sortedItems[e]})},render:function(){var a=this,b=[],c=[];this.state.columns.forEach(function(d){var e={key:d.key};a.props.colStylingFN&&(e=a.props.colStylingFN(d,e)),b.push(React.DOM.col(e)),c.push(React.DOM.th({className:d.notSortable?null:"sortable-column",title:d.title||e.title||null,onMouseDown:a.handleSelectColumn.bind(null,d),onTouchStart:a.handleSelectColumn.bind(null,d),key:d.key},d.label))}),this.sort();var d=this.props.sortedItems,e=[];return d.forEach(function(b){var c=[];for(var d in a.state.columns){var f=a.state.columns[d],g={key:""+b.key+"_"+f.key};a.props.cellStylingFN&&(g=a.props.cellStylingFN(b,f,g)),c.push(React.DOM.td(g,a.splitMultilineText(b.data[f.key])||null))}var h={};h.key=b.key,h.onClick=a.handleSelectRow.bind(null,b),h.onTouchStart=a.handleSelectRow.bind(null,b),a.state.selected&&a.state.selected.key===b.key&&(h.className="selected"),a.props.rowStylingFN&&(h=a.props.rowStylingFN(b,h)),e.push(React.DOM.tr(h,c))}),React.DOM.div(null,React.DOM.table({tabIndex:1},React.DOM.colgroup(null,b),React.DOM.thead(null,React.DOM.tr(null,c)),React.DOM.tbody(null,e)))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.ActionInfo=React.createClass({render:function(){var a=this.props.data,b=this.props.text&&Object.keys(this.props.data).length>0?[React.DOM.span(null,this.props.text),React.DOM.br(null)]:null,c=null;if(a.time){var d="invalid time";a.time.approximate===!0?d="~"+a.time.amount+" days":a.time.approximate===!1&&(d=""+a.time.amount+" days"),c=[React.DOM.span(null,d),React.DOM.br(null)]}var e=null;if(a.cost){var f="invalid cost";a.cost.approximate===!0?f="~"+a.cost.amount+"$":a.cost.approximate===!1&&(f=""+a.cost.amount+"$"),e=[React.DOM.span(null,f),React.DOM.br(null)]}return React.DOM.div({className:"action-info"},b,c,e)}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.Employee=React.createClass({getDefaultProps:function(){var a={employee:{name:"UNDEFINED",skills:{neg:0,rec:0,con:0}}};return a},render:function(){var a=this.props.employee.name,b=[];for(var c in this.props.employee.skills){var d={key:c};this.props.relevantSkills&&this.props.relevantSkills.length>0&&-1===this.props.relevantSkills.indexOf(c)&&(d.className="irrelevant-cell"),b.push(React.DOM.td(d,this.props.employee.skills[c]))}return React.DOM.tr(this.props.rowProps,React.DOM.td({className:"employee-name"},a),b)}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.EmployeeList=React.createClass({applyRowStyle:function(a,b){return a.data.employee.active!==!0&&(b.className="inactive",b.onClick=b.onTouchStart=null),b},applyColStyle:function(a,b){return this.props.relevantSkills&&this.props.relevantSkills.length>0&&this.props.relevantSkills.indexOf(a.key)>-1&&(b.className="relevant-col"),b},applyCellStyle:function(a,b,c){return this.props.relevantSkills&&this.props.relevantSkills.length>0&&this.props.relevantSkills.indexOf(b.key)<0&&"name"!==b.key&&"trait"!==b.key&&(c.className="irrelevant-cell"),c},sortEmployees:function(a,b){var c=a.data.employee,d=b.data.employee;return!c.active&&d.active?-1:!d.active&&c.active?1:0},render:function(){var b=!1,c=[];for(var d in this.props.employees){var e=this.props.employees[d],f={name:e.name,negotiation:e.skills.negotiation,recruitment:e.skills.recruitment,construction:e.skills.construction,trait:null,traitTitle:null,employee:e};e.trait&&(f.trait=React.DOM.div({className:"employee-modifier-container"},React.DOM.span(null,e.trait.title),React.DOM.br(null),React.DOM.small(null,e.trait.description)),f.traitTitle=e.trait.title),e.player&&(b=!0,f.del=React.DOM.a({href:"#",onClick:function(a,b){eventManager.dispatchEvent({type:"makeConfirmPopup",content:{text:"Are you sure you want to fire "+b.name+"?",onOk:function(){a.removeEmployee(b)}}})}.bind(null,e.player,e)},"X")),c.push({key:e.id,data:f})}var g=[{label:"Name",key:"name",sortingFunction:this.sortEmployees,defaultOrder:"asc"},{label:"neg",key:"negotiation",sortingFunction:this.sortEmployees,defaultOrder:"desc",title:"Negotiation\nGives a discount when buying new plots"},{label:"rec",key:"recruitment",sortingFunction:this.sortEmployees,defaultOrder:"desc",title:"Recruitment\nAble to find better new recruits"},{label:"con",key:"construction",sortingFunction:this.sortEmployees,defaultOrder:"desc",title:"Construction\nDecreases building cost and time"},{label:"trait",key:"trait",defaultOrder:"desc",propToSortBy:"traitTitle",title:"Traits\nMouse over trait to see benefits. Traits do not stack."}],h=0;if(this.props.relevantSkills&&this.props.relevantSkills.length>0)for(var i=0;i<g.length;i++)g[i].key===this.props.relevantSkills[0]&&(h=i);return b&&g.push({label:"fire",key:"del",notSortable:!0}),a.List({selected:null,columns:null,sortBy:null,initialColumn:g[h],ref:"list",rowStylingFN:this.applyRowStyle,colStylingFN:this.applyColStyle,cellStylingFN:this.applyCellStyle,onRowChange:this.props.onRowChange||null,listItems:c,initialColumns:g})}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.EmployeeAction=React.createClass({getInitialState:function(){var a;for(var b in this.props.employees)if(this.props.employees[b].active===!0){a=this.props.employees[b];break}return{selected:a?{key:a.id,employee:a}:null,action:this.props.action||null}},handleSelectRow:function(a){var b=a.data.employee;b.active===!0&&this.setState({selected:{key:b.id,employee:b}})},render:function(){var b=this.state.selected?this.state.selected.employee:null,c=this.state.action,d=a.EmployeeList({employees:this.props.employees,relevantSkills:this.props.relevantSkills,onRowChange:this.handleSelectRow}),e={};if(c&&b&&b.active===!0){var f=this.props.relevantSkills.map(function(a){return b.skills[a]});e.selectedEmployee=b;for(var g in c.data){var h=c.data[g];if(h){var i={},j=actions.getActionCost(f,h.amount);h.approximate===!0?(i.approximate=!0,i.amount=j.approximate):h.approximate===!1?(i.approximate=!1,i.amount=j.actual):i=null,e[g]=i}else e[g]=null}}var k=c?a.ActionInfo({data:e,text:c.actionText}):null;return React.DOM.div(null,d,k)}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.EmployeeActionPopup=React.createClass({mixins:[a.Draggable,a.SplitMultilineText],handleOk:function(){var a=this.refs.employeeAction.state.selected;if(!a||!a.employee.active)return eventManager.dispatchEvent({type:"makeInfoPopup",content:{text:"No employee selected"}}),!1;var b=this.props.onOk.call(null,a);b!==!1&&this.handleClose()},handleClose:function(){this.props.onClose.call()},getInitialState:function(){return{employees:this.props.employees||this.props.player.employees,style:this.props.initialStyle}},componentWillRecieveProps:function(a){this.setState({employees:a.employees||a.player.employees})},componentDidMount:function(){var a=this,b=this.refs.okBtn.getDOMNode(),c=this.refs.closeBtn.getDOMNode();this.props.activationDelay?(b.disabled=!0,c.disabled=!0,window.setTimeout(function(){b.disabled=!1,c.disabled=!1,b.focus()},a.props.activationDelay)):b.focus()},render:function(){var b=this.splitMultilineText(this.props.text)||null,c=this.state.employees,d={ref:"employeeAction",employees:c,relevantSkills:this.props.relevantSkills,action:this.props.action,selected:null},e=function(a){a.stopPropagation()},f=React.DOM.button({ref:"okBtn",onClick:this.handleOk,onTouchStart:this.handleOk,draggable:!0,onDrag:e},this.props.okBtnText||"Ok"),g=React.DOM.button({ref:"closeBtn",onClick:this.handleClose,onTouchStart:this.handleClose,draggable:!0,onDrag:e},this.props.closeBtnText||"Cancel");return React.DOM.div({className:"popup",style:this.state.style,draggable:!0,onDragStart:this.handleDragStart,onDrag:this.handleDrag,onDragEnd:this.handleDragEnd,onTouchStart:this.handleDragStart},React.DOM.p({className:"popup-text"},b),React.DOM.div({className:"popup-content",draggable:!0,onDrag:e},a.EmployeeAction(d)),React.DOM.div({className:"popup-buttons"},f,g))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.InfoPopup=React.createClass({mixins:[a.Draggable,a.SplitMultilineText],componentDidMount:function(){this.refs.okBtn.getDOMNode().focus()},render:function(){var a=this.splitMultilineText(this.props.text)||null,b=React.DOM.button({ref:"okBtn",onClick:this.props.onClose,onTouchStart:this.props.onClose,draggable:!0,onDrag:function(a){a.stopPropagation()}},this.props.okBtnText||"Ok");return React.DOM.div({className:"popup",style:this.props.initialStyle,draggable:!0,onDragStart:this.handleDragStart,onDrag:this.handleDrag,onDragEnd:this.handleDragEnd,onTouchStart:this.handleDragStart},React.DOM.p({className:"popup-text"},a),React.DOM.div({className:"popup-buttons"},b))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.ConfirmPopup=React.createClass({mixins:[a.Draggable,a.SplitMultilineText],handleClose:function(){this.props.onClose.call()},handleOk:function(){var a=this.props.onOk.call();a!==!1&&this.handleClose()},componentDidMount:function(){this.refs.okBtn.getDOMNode().focus()},render:function(){var a=this.splitMultilineText(this.props.text)||null,b=React.DOM.button({ref:"okBtn",onClick:this.handleOk,onTouchStart:this.handleOk,draggable:!0,onDrag:function(a){a.stopPropagation()}},this.props.okBtnText||"Confirm"),c=React.DOM.button({onClick:this.handleClose,onTouchStart:this.handleClose,draggable:!0,onDrag:function(a){a.stopPropagation()}},this.props.CloseBtnText||"Cancel");return React.DOM.div({className:"popup",style:this.props.initialStyle,draggable:!0,onDragStart:this.handleDragStart,onDrag:this.handleDrag,onDragEnd:this.handleDragEnd,onTouchStart:this.handleDragStart},React.DOM.p({className:"popup-text"},a),React.DOM.div({className:"popup-buttons"},b,c))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.LoadPopup=React.createClass({mixins:[a.Draggable,a.SplitMultilineText],handleOk:function(){var a=this.refs.savedGameList.state.selected;if(!a)return eventManager.dispatchEvent({type:"makeInfoPopup",content:{text:"No saved game selected"}}),!1;var b=this.props.onOk.call(null,a.data.name);b!==!1&&this.handleClose()},handleClose:function(){this.props.onClose.call()},render:function(){var b=[];for(var c in localStorage)if("options"!==c){var d=JSON.parse(localStorage[c]),e=new Date(d.date),f=[[e.getDate(),e.getMonth()+1,e.getFullYear().toString().slice(2,4)].join("/"),[e.getHours(),e.getMinutes().toString().length<2?"0"+e.getMinutes():e.getMinutes().toString()].join(":")].join(" ");b.push({key:c,data:{name:c,date:f,accurateDate:e,del:React.DOM.a({href:"#",onClick:function(a){eventManager.dispatchEvent({type:"makeConfirmPopup",content:{text:["Are you sure you want to delete this save?",a],onOk:function(){localStorage.removeItem(a)}}})}.bind(null,c)},"X")}})}var g=[{label:"Name",key:"name"},{label:"Date",key:"date",defaultOrder:"desc",propToSortBy:"accurateDate"},{label:"Delete",key:"del",notSortable:!0}],h=function(a){a.stopPropagation()},i=React.DOM.button({ref:"okBtn",onClick:this.handleOk,onTouchStart:this.handleOk,draggable:!0,onDrag:h},this.props.okBtnText||"Load"),j=React.DOM.button({onClick:this.handleClose,onTouchStart:this.handleClose,draggable:!0,onDrag:h},this.props.closeBtnText||"Cancel");return React.DOM.div({className:"popup",style:this.props.initialStyle,draggable:!0,onDragStart:this.handleDragStart,onDrag:this.handleDrag,onDragEnd:this.handleDragEnd,onTouchStart:this.handleDragStart},React.DOM.p({className:"popup-text"},"Select game to load"),React.DOM.div({className:"popup-content",draggable:!0,onDrag:h},a.List({selected:null,columns:null,sortBy:null,initialColumn:g[1],ref:"savedGameList",listItems:b,initialColumns:g})),React.DOM.div({className:"popup-buttons"},i,j))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.SavePopup=React.createClass({mixins:[a.Draggable,a.SplitMultilineText],componentDidMount:function(){var a=function(){this.refs.inputElement.getDOMNode().value=this.refs.savedGameList.state.selected.data.name}.bind(this);window.setTimeout(a,50)},handleOk:function(){function a(){var a=b.props.onOk.call(null,c);a!==!1&&b.handleClose()}var b=this,c=this.refs.inputElement.getDOMNode().value,d=!1;for(var e in localStorage)c===e&&(d=!0);return c?d?(eventManager.dispatchEvent({type:"makeConfirmPopup",content:{text:["Are you sure you want to overwrite this save?",c],onOk:a}}),!1):void a():(eventManager.dispatchEvent({type:"makeInfoPopup",content:{text:"Select a name to save as"}}),!1)},handleClose:function(){this.props.onClose.call()},render:function(){var b=this,c=[];for(var d in localStorage)if("options"!==d){var e=JSON.parse(localStorage[d]),f=new Date(e.date),g=[[f.getDate(),f.getMonth()+1,f.getFullYear().toString().slice(2,4)].join("/"),[f.getHours(),f.getMinutes().toString().length<2?"0"+f.getMinutes():f.getMinutes().toString()].join(":")].join(" ");c.push({key:d,data:{name:d,date:g,accurateDate:f,del:React.DOM.a({href:"#",onClick:function(a){eventManager.dispatchEvent({type:"makeConfirmPopup",content:{text:["Are you sure you want to delete this save?",a],onOk:function(){localStorage.removeItem(a)}}})}.bind(null,d)},"X")}})}var h=[{label:"Name",key:"name"},{label:"Date",key:"date",defaultOrder:"desc",propToSortBy:"accurateDate"},{label:"Delete",key:"del",notSortable:!0}],i=function(a){a.stopPropagation()},j=React.DOM.button({ref:"okBtn",onClick:this.handleOk,onTouchStart:this.handleOk,draggable:!0,onDrag:i},this.props.okBtnText||"Save"),k=React.DOM.button({onClick:this.handleClose,onTouchStart:this.handleClose,draggable:!0,onDrag:i},this.props.closeBtnText||"Cancel"),l=React.DOM.input({ref:"inputElement",type:"text"});return React.DOM.div({className:"popup",style:this.props.initialStyle,draggable:!0,onDragStart:this.handleDragStart,onDrag:this.handleDrag,onDragEnd:this.handleDragEnd,onTouchStart:this.handleDragStart},React.DOM.p({className:"popup-text"},"Select name to save as"),React.DOM.div({className:"popup-content",draggable:!0,onDrag:i},a.List({selected:null,columns:null,sortBy:null,initialColumn:h[1],ref:"savedGameList",listItems:c,initialColumns:h,onRowChange:function(a){b.refs.inputElement.getDOMNode().value=a.data.name}}),React.DOM.br(null),l),React.DOM.div({className:"popup-buttons"},j,k))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.BuildingList=React.createClass({getInitialState:function(){var a=this.props.buildingTemplates;for(var b in a){var c=a[b];if(this.props.player.money>=c.cost)return{selected:c}}return{selected:null}},handleSelectRow:function(a){this.setState({selected:a})},render:function(){var a=this.props.player,b=[];for(var c in this.props.buildingTemplates){var d=this.props.buildingTemplates[c],e=!0,f={key:d.type,title:d.translate+"\nBase profit: "+d.baseProfit},g={className:"money"},h={className:"building-title"},i=a.getBuildCost(d);a.money<i&&(e=!1,f.className="inactive",g.className="insufficient"),e&&(f.onClick=f.onTouchStart=this.handleSelectRow.bind(null,d.type),f.className="active"),this.state.selected&&this.state.selected===d.type&&(f.className="selected");var j=this.props.buildingImages[d.frame],k=React.DOM.tr(f,React.DOM.td({className:"building-image"},React.DOM.img({src:j.src,width:j.width/2,height:j.height/2})),React.DOM.td(h,d.translate),React.DOM.td(g,i+"$"));b.push(k)}return React.DOM.div({className:"scrollable-wrapper"},React.DOM.table({className:"building-list"},React.DOM.thead(null,React.DOM.tr(null,React.DOM.th(null),React.DOM.th(null,"Type"),React.DOM.th(null,"Cost"))),React.DOM.tbody(null,b)))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.BuildingListPopup=React.createClass({mixins:[a.Draggable,a.SplitMultilineText],getInitialState:function(){return{player:this.props.player,style:this.props.initialStyle}},componentWillRecieveProps:function(a){this.setState({player:a.player})},componentDidMount:function(){this.refs.okBtn.getDOMNode().focus()},handleOk:function(){var a=this.refs.buildingList.state.selected,b=a?this.props.buildingTemplates[a]:null;if(!b||this.props.player.money<b.cost)return eventManager.dispatchEvent({type:"makeInfoPopup",content:{text:"No building selected"}}),!1;var c=this.props.onOk.call(null,b);c!==!1&&this.handleClose()},handleClose:function(){this.props.onClose.call()},render:function(){var b=this.splitMultilineText(this.props.text)||null,c={ref:"buildingList",buildingTemplates:this.props.buildingTemplates,buildingImages:this.props.buildingImages,player:this.state.player,selected:null},d=function(a){a.stopPropagation()},e=React.DOM.button({ref:"okBtn",onClick:this.handleOk,onTouchStart:this.handleOk,draggable:!0,onDrag:d},this.props.okBtnText||"Build"),f=React.DOM.button({onClick:this.handleClose,onTouchStart:this.handleClose,draggable:!0,onDrag:d},this.props.closeBtnText||"Cancel");return React.DOM.div({className:"popup",style:this.props.initialStyle,draggable:!0,onDragStart:this.handleDragStart,onDrag:this.handleDrag,onDragEnd:this.handleDragEnd,onTouchStart:this.handleDragStart},React.DOM.p({className:"popup-text"},b),React.DOM.div({className:"popup-content",draggable:!0,onDrag:d},a.BuildingList(c)),React.DOM.div({className:"popup-buttons"},e,f))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.ModifierList=React.createClass({render:function(){for(var b=[],c=0;c<this.props.modifiers.length;c++){var d=this.props.modifiers[c],e={key:d.type,data:{title:d.title,description:d.description,modifier:d}};this.props.excludeCost!==!0&&(e.data.cost=d.cost||null,e.data.costString=void 0!==d.cost?beautify(d.cost)+"$":null),b.push(e)}var f=[];return f.push({label:"Title",key:"title"}),this.props.excludeCost!==!0&&f.push({label:"Cost",key:"costString",defaultOrder:"asc",propToSortBy:"cost"}),f.push({label:"Description",key:"description"}),a.List({selected:null,columns:null,sortBy:null,initialColumn:f[1],ref:"list",className:"modifier-list",rowStylingFN:this.props.rowStylingFN,listItems:b,initialColumns:f})}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.ModifierPopup=React.createClass({mixins:[a.Draggable,a.SplitMultilineText],handleClose:function(){this.props.onClose.call()},handleOk:function(){var a=this.refs.modifierList.refs.list.state.selected;if(!a){if(!(this.props.modifierList.length<1))return!1;this.handleClose()}var b=this.props.onOk.call(null,a);b===!0?this.handleClose():this.refs.modifierList.refs.list.shiftSelection(1)},applyRowStyle:function(a,b){return a.data.modifier.cost>this.props.player.money&&(b.className="inactive",b.onClick=b.onTouchStart=null),b},render:function(){var b=function(a){a.stopPropagation()},c=React.DOM.button({ref:"okBtn",onClick:this.handleOk,onTouchStart:this.handleOk,draggable:!0,onDrag:b},this.props.okBtnText||"Buy"),d=React.DOM.button({onClick:this.handleClose,onTouchStart:this.handleClose,draggable:!0,onDrag:b},this.props.closeBtnText||"Close"),e=this.splitMultilineText(this.props.text)||null;return React.DOM.div({className:"popup",style:this.props.initialStyle,draggable:!0,onDragStart:this.handleDragStart,onDrag:this.handleDrag,onDragEnd:this.handleDragEnd,onTouchStart:this.handleDragStart},React.DOM.p({className:"popup-text"},e),React.DOM.div({className:"popup-content",draggable:!0,onDrag:b},a.ModifierList({ref:"modifierList",rowStylingFN:this.applyRowStyle,modifiers:this.props.modifierList,excludeCost:this.props.excludeCost||!1})),React.DOM.div({className:"popup-buttons"},c,d))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.StatList=React.createClass({render:function(){for(var a=[],b=0;b<this.props.stats.length;b++){var c=this.props.stats[b],d=React.DOM.div({className:"stat-container",key:""+b},React.DOM.div({className:"stat-main"},React.DOM.span({className:"stat-title"},c.title),React.DOM.span({className:"stat-content"},c.content)),c.subContent?React.DOM.small({className:"stat-subContent"},c.subContent):null);
a.push(d)}return React.DOM.div({className:"stat-group"},React.DOM.div({className:"stat-header"},this.props.header),a)}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.Stats=React.createClass({mixins:[a.SplitMultilineText],toggleSelf:function(){eventManager.dispatchEvent({type:"toggleFullScreenPopup",content:null})},render:function(){var b=this.props.player,c=[],d=(b.clicks,[{title:"Money:",content:"$"+beautify(b.money)},{title:"Clicks:",content:b.clicks},{title:"Money from clicks:",content:"$"+(b.incomePerType.click?beautify(b.incomePerType.click):0)},{title:"Owned plots:",content:b.ownedCellsAmount}]),e=a.StatList({stats:d,header:"General",key:"generalStatList"});c.push(e);var f=1+.005*b.prestige;b.levelUpModifiers.prestigeEffectIncrease1&&(f*=1+.0025*b.prestige);var g=[{title:"Times reset:",content:b.timesReset},{title:"Prestige:",content:b.prestige.toFixed(),subContent:"for a total of "+(100*(f-1)).toFixed(1)+"% extra profit"},{title:"Current experience:",content:beautify(b.experience)},{title:"Total experience:",content:beautify(b.totalResetExperience+b.experience)}],h=a.StatList({stats:g,header:"Prestige",key:"prestigeStatList"});if(c.push(h),b.permanentLevelupUpgrades.length>0){for(var i=[],j=0;j<b.permanentLevelupUpgrades.length;j++)i.push(levelUpModifiers[b.permanentLevelupUpgrades[j]]);var k=a.ModifierList({ref:"permModifierList",modifiers:i,excludeCost:!0});c.push(React.DOM.div({className:"stat-group",key:"permModifierList"},React.DOM.div({className:"stat-header"},"Permanent perks"),k))}if(Object.keys(b.levelUpModifiers).length>0){var l=[];for(var m in b.levelUpModifiers)b.permanentLevelupUpgrades.indexOf(m)>-1||l.push(b.levelUpModifiers[m]);var n=a.ModifierList({ref:"perkList",modifiers:l,excludeCost:!0});c.push(React.DOM.div({className:"stat-group",key:"perkList"},React.DOM.div({className:"stat-header"},"Unlocked perks"),n))}if(Object.keys(b.modifiers).length>0){var o=[];for(var m in b.modifiers)o.push(b.modifiers[m]);var p=a.ModifierList({ref:"unlockList",modifiers:o,excludeCost:!0});c.push(React.DOM.div({className:"stat-group",key:"unlockList"},React.DOM.div({className:"stat-header"},"Upgrades"),p))}if(Object.keys(b.employees).length>0){var q=a.EmployeeList({ref:"employeeList",employees:b.employees});c.push(React.DOM.div({className:"stat-group",key:"employeeList"},React.DOM.div({className:"stat-header"},"Employees"),q))}return React.DOM.div({className:"all-stats"},React.DOM.a({id:"close-info",className:"close-popup",href:"#",onClick:this.toggleSelf,onTouchStart:this.toggleSelf},"X"),c)}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.OptionList=React.createClass({render:function(){for(var a=[],b=0;b<this.props.options.length;b++){var c=this.props.options[b],d=React.DOM.div({className:"stat-container",key:""+b},React.DOM.div({className:"stat-main"},c.content),c.subContent?React.DOM.small({className:"stat-subContent"},c.subContent):null);a.push(d)}return React.DOM.div({className:"stat-group"},React.DOM.div({className:"stat-header"},this.props.header),a)}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.OptionsPopup=React.createClass({toggleSelf:function(){eventManager.dispatchEvent({type:"toggleFullScreenPopup",content:null})},handleImport:function(){var a=this.refs.importTextArea.getDOMNode().value,b=LZString.decompressFromBase64(a);localStorage.setItem("tempImported",b),eventManager.dispatchEvent({type:"loadGame",content:"tempImported"}),localStorage.removeItem("tempImported")},handleExport:function(){eventManager.dispatchEvent({type:"saveGame",content:"tempImported"});var a=LZString.compressToBase64(localStorage.getItem("tempImported"));this.refs.importTextArea.getDOMNode().value=a,localStorage.removeItem("tempImported")},render:function(){var b=[],c=[{content:React.DOM.div({id:"import-export-container"},React.DOM.div({id:"import-export-buttons"},React.DOM.button({id:"import-button",onClick:this.handleImport,onTouchStart:this.handleImport},"Import"),React.DOM.button({id:"export-button",onClick:this.handleExport,onTouchStart:this.handleExport},"Export")),React.DOM.textarea({id:"import-export-text",ref:"importTextArea"}))}],d=a.OptionList({options:c,header:"Import & Export",key:"importExportList"});b.push(d);var e=[{content:React.DOM.div(null,React.DOM.input({type:"checkbox",id:"draw-click-popups",name:"draw-click-popups",defaultChecked:Options.drawClickPopups,onChange:function(){eventManager.dispatchEvent({type:"toggleDrawClickPopups",content:""})}}),React.DOM.label({htmlFor:"draw-click-popups"},"Draw click popups"))}],f=a.OptionList({options:e,header:"Visual & Performance",key:"visualOptionList"});b.push(f);var g=[{content:React.DOM.div(null,React.DOM.input({type:"number",id:"autosave-limit",className:"small-number-input",defaultValue:Options.autosaveLimit,step:1,min:1,max:9,onChange:function(a){var b=a.target,c=b.value;c!==Options.autosaveLimit&&eventManager.dispatchEvent({type:"setAutosaveLimit",content:c})}}),React.DOM.label({htmlFor:"autosave-limit"},"Autosave limit"))}],h=a.OptionList({options:g,header:"Other",key:"otherOptionList"});return b.push(h),React.DOM.div({className:"all-options"},React.DOM.a({id:"close-info",className:"close-popup",href:"#",onClick:this.toggleSelf,onTouchStart:this.toggleSelf},"X"),b)}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.Notifications=React.createClass({render:function(){for(var a=[],b=0;b<this.props.notifications.length;b++){var c=this.props.notifications[b],d=React.DOM.div({key:""+b,className:"react-notification",onClick:c.onClose},React.DOM.img({src:c.icon}));a.push(d)}return React.DOM.div({id:"react-notifications"},a)}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.Changelog=React.createClass({mixins:[a.SplitMultilineText],toggleSelf:function(){eventManager.dispatchEvent({type:"toggleFullScreenPopup",content:null})},getInitialState:function(){return{changelog:null}},componentDidMount:function(){var a=this,b=new XMLHttpRequest;b.overrideMimeType("application/json"),b.open("GET","changelog.json",!0),b.responseType="json",b.onload=function(){a.setState({changelog:b.response})},b.send()},render:function(){var b=[];if(this.state.changelog)for(var c in this.state.changelog){for(var d=this.state.changelog[c],e=[],f=0;f<d.length;f++)e.push({content:d[f]});b.push(a.OptionList({options:e,header:c,key:c}))}return React.DOM.div({className:"all-changes"},React.DOM.a({id:"close-info",className:"close-popup",href:"#",onClick:this.toggleSelf,onTouchStart:this.toggleSelf},"X"),b)}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.SideMenuModifierButton=React.createClass({getInitialState:function(){return{hasNewModifier:!1,lastModifierCount:0}},handleOpenModifiers:function(){this.setState({hasNewModifier:!1}),eventManager.dispatchEvent({type:"makeModifierPopup",content:{player:this.props.player,modifierList:this.props.player.unlockedModifiers}})},componentWillReceiveProps:function(a){var b=a.player.unlockedModifiers.length;b>this.state.lastModifierCount&&this.setState({hasNewModifier:!0}),this.setState({lastModifierCount:b})},render:function(){var a=(this.props.player,this.props.player.unlockedModifiers.length);a>this.state.lastModifierCount;var b={id:"side-menu-modifiers",className:"grid-cell interactive",onClick:this.handleOpenModifiers,onTouchStart:this.handleOpenModifiers};this.state.hasNewModifier;var c="Available upgrades: ";return a>0&&(c+=a),React.DOM.div(b,c)}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.SideMenuTools=React.createClass({handleRecruit:function(){eventManager.dispatchEvent({type:"recruit",content:""})},handleToolChange:function(a,b){this.props.setSelectedTool(a);var c=!1;"click"!==a&&b&&b.shiftKey&&(c=!0),eventManager.dispatchEvent({type:"changeTool",content:{type:a,continuous:c}})},componentDidMount:function(){eventManager.addEventListener("buyHotkey",function(a){this.handleToolChange("buy",a.content)}.bind(this)),eventManager.addEventListener("sellHotkey",function(a){this.handleToolChange("sell",a.content)}.bind(this)),eventManager.addEventListener("clickHotkey",function(a){this.handleToolChange("click",a.content)}.bind(this)),eventManager.addEventListener("recruitHotkey",this.handleRecruit)},render:function(){var a={click:{ref:"click",className:"grid-cell interactive",onClick:this.handleToolChange.bind(null,"click"),onTouchStart:this.handleToolChange.bind(null,"click")},buy:{ref:"buy",className:"grid-cell interactive",onClick:this.handleToolChange.bind(null,"buy"),onTouchStart:this.handleToolChange.bind(null,"buy")},sell:{ref:"sell",className:"grid-cell interactive",onClick:this.handleToolChange.bind(null,"sell"),onTouchStart:this.handleToolChange.bind(null,"sell")},recruit:{ref:"recruit",className:"grid-cell interactive",onClick:this.handleRecruit,onTouchStart:this.handleRecruit}},b=this.props.selectedTool;return Object.keys(this.props.player.employees).length<1?(a.recruit.className+=" new-modifier",a.buy.className="grid-cell disabled",a.sell.className="grid-cell disabled"):b&&a[b]&&(a[b].className+=" selected-tool"),React.DOM.div({id:"side-menu-tools",className:"grid-column"},React.DOM.div({className:"grid-row"},React.DOM.div(a.click,"click"),React.DOM.div(a.recruit,React.DOM.u(null,"r"),"ecruit")),React.DOM.div({className:"grid-row"},React.DOM.div(a.buy,"b",React.DOM.u(null,"u"),"y plot"),React.DOM.div(a.sell,React.DOM.u(null,"s"),"ell")))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.SideMenuStats=React.createClass({getInitialState:function(){return{hasLevelUpUpgrade:!1,lastModifierCount:0,canPrestige:!1}},componentWillReceiveProps:function(a){var b=Object.keys(a.player.unlockedLevelUpModifiers).length;b>0?this.setState({hasLevelUpUpgrade:!0}):a.player.level>=100&&this.setState({canPrestige:!0}),this.setState({lastModifierCount:b})},componentDidMount:function(){var a=this.refs.moneyText.getDOMNode(),b=this.refs.profitText.getDOMNode(),c=this.refs.exp.getDOMNode(),d=this.refs.expText.getDOMNode(),e=this.refs.levelText.getDOMNode();eventManager.addEventListener("updatePlayerMoney",function(c){a.innerHTML=c.content.total,b.innerHTML="$"+c.content.rolling+"/d"}),eventManager.addEventListener("updatePlayerExp",function(a){var b=a.content.experience+" / "+a.content.nextLevel,f="Level   "+a.content.level+" ";c.value=a.content.percentage,d.innerHTML=b,e.innerHTML=f}),this.props.player.addMoney(0)},handleOpenModifiers:function(){var a=this,b=this.props.player,c=Object.keys(b.unlockedLevelUpModifiers).length-1,d=Object.keys(b.unlockedLevelUpModifiers).sort(function(a,b){return parseInt(a)<parseInt(b)?1:-1})[c],e=b.unlockedLevelUpModifiers[d];return e?void eventManager.dispatchEvent({type:"makeModifierPopup",content:{player:b,text:["Select your bonus perk for level "+d,"You only get to pick one"],modifierList:e,excludeCost:!0,okBtnText:"Select",onOk:function(c){var d=b.addLevelUpModifier(c.data.modifier);return eventManager.dispatchEvent({type:"updateReact",content:""}),a.setState({hasLevelUpUpgrade:!1}),d!==!1?!0:!1}}}):void this.setState({hasLevelUpUpgrade:!1})},handleOpenPrestige:function(){if(this.state.canPrestige){var a=function(){this.setState({canPrestige:!1})}.bind(this);eventManager.dispatchEvent({type:"prestigeReset",content:a})}},render:function(){var a={id:"player-level",ref:"exp",value:0,max:100},b={id:"player-level-wrapper"};return this.state.hasLevelUpUpgrade?(a.className="new-modifier",b.onClick=this.handleOpenModifiers,b.onTouchStart=this.handleOpenModifiers,b.className="interactive"):this.state.canPrestige&&(a.className="new-modifier",b.onClick=this.handleOpenPrestige,b.onTouchStart=this.handleOpenPrestige,b.className="interactive"),React.DOM.div({id:"side-menu-stats"},React.DOM.div(b,React.DOM.progress(a),React.DOM.div({id:"level-string-container"},React.DOM.div({id:"level-string-wrapper",className:"stat-string-wrapper"},React.DOM.span({ref:"levelText"},null),React.DOM.span({ref:"expText"},null)))),React.DOM.div({id:"money-string-container"},React.DOM.div({id:"money-string-wrapper",className:"stat-string-wrapper"},React.DOM.span({ref:"moneyText"},null),React.DOM.span({ref:"profitText"},null))))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.SideMenuSave=React.createClass({handleSave:function(){eventManager.dispatchEvent({type:"makeSavePopup",content:""})},handleLoad:function(){eventManager.dispatchEvent({type:"makeLoadPopup",content:""})},render:function(){return React.DOM.div({id:"save-buttons",className:"grid-row"},React.DOM.div({className:"grid-cell interactive",onClick:this.handleSave,onTouchStart:this.handleSave},"save"),React.DOM.div({className:"grid-cell interactive",onClick:this.handleLoad,onTouchStart:this.handleLoad},"load"))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.SideMenuZoom=React.createClass({getInitialState:function(){return{zoom:1}},handleZoomChange:function(a){var b=a.target;this.setState({zoom:parseFloat(b.value)})},handleZoomSubmit:function(a){return a.preventDefault(),eventManager.dispatchEvent({type:"changeZoom",content:this.state.zoom}),!1},handleMapmodeChange:function(a){var b=a.target;eventManager.dispatchEvent({type:"changeMapmode",content:b.value})},componentDidMount:function(){var a=this,b=this.refs.zoomValue.getDOMNode();eventManager.addEventListener("updateZoomValue",function(c){b.value=c.content.toFixed(3),a.setState({zoom:c.content})})},render:function(){var a=[];return["terrain","landValue","underground"].forEach(function(a){{var b={key:a,value:a};React.DOM.option(b,a)}}),React.DOM.select({id:"side-menu-mapmode-select",value:"landValue"},a),React.DOM.form({id:"side-menu-zoom",className:"grid-row",onSubmit:this.handleZoomSubmit},React.DOM.input({id:"zoom-amount",ref:"zoomValue",className:"grid-row",type:"number",defaultValue:"1",step:.1,onChange:this.handleZoomChange}),React.DOM.button({id:"zoomBtn",className:"grid-row"},"zoom"))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.SideMenuMapmode=React.createClass({handleMapmodeChange:function(a){var b=a.target;eventManager.dispatchEvent({type:"changeMapmode",content:b.value})},render:function(){var a=[];return["terrain","landValue","underground"].forEach(function(b){var c={key:b,value:b},d="landValue"===b?"land value":b;a.push(React.DOM.option(c,d))}),React.DOM.select({id:"side-menu-mapmode-select",className:"grid-row",defaultValue:"landValue",title:"Map mode",onChange:this.handleMapmodeChange},a)}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.SideMenuBuildings=React.createClass({getInitialState:function(){return{beautifyIndex:0,lastSelectedBuilding:playerBuildableBuildings[0],currentPopOver:null}},drawPopOver:function(a,b){if(this.state.currentPopOver!==a.type){var c=this.refs.popOver.getDOMNode(),d=[{title:"Affected by",target:effectSourcesIndex[a.categoryType]},{title:"Affects",target:a.effectTargets}];if(this.indexedPopoverContent||(this.indexedPopoverContent={}),!this.indexedPopoverContent[a.type]){var e="";e+="<div>Base profit $"+a.baseProfit+"/d</div>",d.forEach(function(a){if(a.target&&!(a.target.positive.length<1&&a.target.negative.length<1)){e+="<h4>"+a.title+"</h4>",e+="<div class='tooltip-modifiers-container'>";for(var b in a.target){var c=a.target[b];e+="<div class='tooltip-modifiers tooltip-modifiers-"+b+"'>",e+="<ul>";for(var d=0;d<c.length;d++)e+="<li>"+capitalize(c[d])+"</li>";e+="</ul>",e+="</div>"}e+="</div>"}}),this.indexedPopoverContent[a.type]=e}c.innerHTML=this.indexedPopoverContent[a.type],c.classList.remove("hidden"),c.style.top=this.refs[b].getDOMNode().getBoundingClientRect().top+"px",this.setState({currentPopOver:a.type})}},hidePopOver:function(){this.state.currentPopOver&&(this.refs.popOver.getDOMNode().classList.add("hidden"),this.setState({currentPopOver:null}))},handleBuildingSelect:function(a,b){if(!(this.props.player.money<this.props.player.getBuildCost(a))){this.props.setSelectedTool(a.type),this.setState({lastSelectedBuilding:a});var c=b&&b.shiftKey?b.shiftKey:!1;eventManager.dispatchEvent({type:"changeBuildingType",content:{building:a,continuous:c}})}},componentDidMount:function(){eventManager.addEventListener("resizeSmaller",function(){this.setState({beautifyIndex:2})}.bind(this)),eventManager.addEventListener("resizeBigger",function(){this.setState({beautifyIndex:0})}.bind(this)),eventManager.addEventListener("buildHotkey",function(a){this.handleBuildingSelect(this.state.lastSelectedBuilding,a.content)}.bind(this))},render:function(){for(var a=[],b=this.props.player,c=0;c<playerBuildableBuildings.length;c++){var d=playerBuildableBuildings[c],e=b.getBuildCost(d),f=b.money>=e,g=b.amountBuiltPerType[d.type],h={className:"side-building",key:d.type,ref:d.type,onMouseLeave:this.hidePopOver,onTouchStart:this.handleBuildingSelect.bind(null,d),onMouseEnter:this.drawPopOver.bind(null,d,d.type)},i={className:"building-image"},j={className:"building-title"},k={className:"building-cost"},l={className:"building-amount"};f?(h.className+=" interactive",h.onClick=this.handleBuildingSelect.bind(null,d)):(h.className+=" disabled",k.className+=" insufficient"),this.props.selectedTool&&this.props.selectedTool===d.type&&(h.className+=" selected-tool");var m=""+beautify(e,this.state.beautifyIndex);this.state.beautifyIndex<2&&(m+="$");var n=this.props.frameImages[d.icon];i.src=n.src;var o=React.DOM.div(h,React.DOM.div({className:"building-image-container"},React.DOM.img(i,null)),React.DOM.div({className:"building-content"},React.DOM.div({className:"building-content-wrapper"},React.DOM.div(j,d.title),React.DOM.div(k,m)),React.DOM.div(l,g)));a.push(o)}return React.DOM.div({id:"side-menu-buildings",className:"grid-column"},a,React.DOM.div({id:"building-popover",className:"hidden",ref:"popOver"},"asdjhksadhja"))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.SideMenu=React.createClass({getInitialState:function(){return{selectedTool:null}},setSelectedTool:function(a){this.setState({selectedTool:a})},render:function(){return React.DOM.div({id:"react-side-menu"},a.SideMenuTools({player:this.props.player,setSelectedTool:this.setSelectedTool,selectedTool:this.state.selectedTool}),a.SideMenuBuildings({player:this.props.player,frameImages:this.props.frameImages,setSelectedTool:this.setSelectedTool,selectedTool:this.state.selectedTool,beautifyIndex:null,lastSelectedBuilding:null}),React.DOM.div({id:"side-menu-other-buttons",className:"grid-column"},a.SideMenuSave(),a.SideMenuMapmode(),a.SideMenuZoom()),a.SideMenuStats({player:this.props.player,hasLevelUpUpgrade:null,lastModifierCount:null}),a.SideMenuModifierButton({player:this.props.player,hasNewModifier:null,lastModifierCount:null}))}})}(UIComponents||(UIComponents={}));var UIComponents;!function(a){a.Stage=React.createClass({getDefaultProps:function(){return{fullScreenPopups:{stats:function(){return React.DOM.div({className:"fullscreen-popup-wrapper"},React.DOM.div({id:"stats-container",className:"fullscreen-popup"},a.Stats({player:this.props.player})))},options:function(){return React.DOM.div({className:"fullscreen-popup-wrapper"},React.DOM.div({id:"options-container",className:"fullscreen-popup"},a.OptionsPopup(null)))},changelog:function(){return React.DOM.div({className:"fullscreen-popup-wrapper"},React.DOM.div({id:"changelog-container",className:"fullscreen-popup"},a.Changelog(null)))}}}},getInitialState:function(){return{showFullScreenPopup:null}},componentDidMount:function(){var a=this;eventManager.addEventListener("toggleFullScreenPopup",function(b){a.setState(b.content===a.state.showFullScreenPopup?{showFullScreenPopup:null}:{showFullScreenPopup:b.content})})},render:function(){var b=[];for(var c in this.props.popups){var d=this.props.popups[c];b.push(a[d.type].call(null,d.props))}var e=this.state.showFullScreenPopup?this.props.fullScreenPopups[this.state.showFullScreenPopup].call(this):null;return React.DOM.div({id:"react-wrapper"},React.DOM.div({id:"react-popups",onDragEnter:function(a){a.preventDefault()},onDragOver:function(a){a.preventDefault()},onDrop:function(a){a.preventDefault()},onDragLeave:function(a){a.preventDefault()}},b,a.Notifications({notifications:this.props.notifications})),e,a.SideMenu({player:this.props.player,frameImages:this.props.frameImages,selectedTool:null}))}})}(UIComponents||(UIComponents={}));var ReactUI=function(){function a(a,b){this.idGenerator=0,this.popups={},this.notifications=[],this.topZIndex=15,this.icons={},this.player=a,this.frameImages=b,this.init()}return a.prototype.init=function(){React.initializeTouchEvents(!0),this.addEventListeners(),this.icons={newEmployee:"img/icons/newemployee.png"},this.updateReact(),this.updateInterval=window.setInterval(this.updateReact.bind(this),1e3)},a.prototype.addEventListeners=function(){var a=this;eventManager.addEventListener("makeEmployeeActionPopup",function(b){a.makeEmployeeActionPopup(b.content)}),eventManager.addEventListener("makeRecruitPopup",function(b){a.makeRecruitPopup(b.content)}),eventManager.addEventListener("makeRecruitCompletePopup",function(b){a.makeRecruitCompletePopup(b.content)}),eventManager.addEventListener("makeRecruitCompleteNotification",function(b){b.content.delay=0,a.makeNotification({icon:a.icons.newEmployee,onOk:a.makeRecruitCompletePopup.bind(a,b.content)})}),eventManager.addEventListener("makeCellBuyPopup",function(b){a.makeCellBuyPopup(b.content)}),eventManager.addEventListener("makeConfirmPopup",function(b){a.makeConfirmPopup(b.content)}),eventManager.addEventListener("makePopup",function(b){a.makePopup(b.content.type,b.content.props)}),eventManager.addEventListener("makeInfoPopup",function(b){a.makeInfoPopup(b.content)}),eventManager.addEventListener("makeBuildingSelectPopup",function(b){a.makeBuildingSelectPopup(b.content)}),eventManager.addEventListener("makeBuildingConstructPopup",function(b){a.makeBuildingConstructPopup(b.content)}),eventManager.addEventListener("makeInputPopup",function(b){a.makeInputPopup(b.content)}),eventManager.addEventListener("makeLoadPopup",function(){a.makeLoadPopup()}),eventManager.addEventListener("makeSavePopup",function(){a.makeSavePopup()}),eventManager.addEventListener("makeModifierPopup",function(b){a.makeModifierPopup(b.content)}),eventManager.addEventListener("makeNotification",function(b){a.makeNotification(b.content)}),eventManager.addEventListener("closeTopPopup",function(){a.closeTopPopup()}),eventManager.addEventListener("clearReact",function(){a.clear()}),eventManager.addEventListener("updateReact",function(){a.updateReact()})},a.prototype.makePopup=function(a,b){var c=this.idGenerator++,d=b.onClose;b.onClose=function(){this.destroyPopup(c,d)}.bind(this);var e=this.incrementZIndex(),f={};for(var g in b)f[g]=b[g];f.key=c;document.getElementById("react-popups");f.initialStyle={top:window.innerHeight/3.5-120+15*Object.keys(this.popups).length,left:window.innerWidth/3.5-120+15*Object.keys(this.popups).length,zIndex:e},f.incrementZIndex=this.incrementZIndex.bind(this,c);var h={type:a,props:f,zIndex:e};this.popups[c]=h,this.updateReact()},a.prototype.makeEmployeeActionPopup=function(a){this.makePopup("EmployeeActionPopup",a)},a.prototype.makeInfoPopup=function(a){this.makePopup("InfoPopup",a)},a.prototype.makeLoadPopup=function(){this.makePopup("LoadPopup",{onOk:function(a){eventManager.dispatchEvent({type:"loadGame",content:a})}})},a.prototype.makeSavePopup=function(){this.makePopup("SavePopup",{onOk:function(a){eventManager.dispatchEvent({type:"saveGame",content:a})}})},a.prototype.makeModifierPopup=function(a){var b=a.onOk||function(b){return a.player.addModifier(b.data.modifier),eventManager.dispatchEvent({type:"updateReact",content:""}),!1};this.makePopup("ModifierPopup",{player:a.player,text:a.text||null,modifierList:a.modifierList||a.player.unlockedModifiers,excludeCost:a.excludeCost||!1,onOk:b,onClose:a.onClose||null,okBtnText:a.okBtnText||"Buy"})},a.prototype.makeRecruitPopup=function(a){var b=function(b){actions.recruitEmployee({playerId:a.player.id,employeeId:b.employee.id})};this.makeEmployeeActionPopup({player:a.player,relevantSkills:["recruitment"],text:"Select employee in charge of recruitment",onOk:b,okBtnText:"Select",action:{actionText:"Scouting new employees would take:",data:{time:{approximate:!0,amount:14}}}})},a.prototype.makeRecruitCompletePopup=function(a){var b=this,c=function(b){a.player.addEmployee(b.employee)};isFinite(a.delay)||(a.delay=2e3);var d=function(){a.recruitingEmployee&&(a.recruitingEmployee.active=!0,b.updateReact())};this.makeEmployeeActionPopup({employees:a.employees,text:a.text||"Choose employee to recruit",onOk:c,onClose:d,okBtnText:"Recruit",activationDelay:a.delay})},a.prototype.makeCellBuyPopup=function(a){if(Object.keys(a.player.employees).length<1)return void this.makeInfoPopup({text:"Recruit some employees first"});if(!a.player.ownedCells[a.cell.gridPos]&&"water"!==a.cell.type.type){var b=a.player.getCellBuyCost(a.cell),c=function(c){var d=actions.getActionCost([c.employee.skills.negotiation],b).actual;return a.player.money<d?(eventManager.dispatchEvent({type:"makeInfoPopup",content:{text:"Not enough funds"}}),!1):(actions.buyCell({gridPos:a.cell.gridPos,boardId:a.cell.board.id,playerId:a.player.id,employeeId:c.employee.id}),a.onOk&&a.onOk.call(),!0)};this.makeEmployeeActionPopup({player:a.player,relevantSkills:["negotiation"],text:"Select employee in charge of purchasing the plot",onOk:c,okBtnText:"Buy",action:{target:a.cell,actionText:"Buying this plot would take:",data:{time:{approximate:!0,amount:14},cost:{approximate:!1,amount:b}}}})}},a.prototype.makeConfirmPopup=function(a){this.makePopup("ConfirmPopup",a)},a.prototype.makeBuildingSelectPopup=function(a){return Object.keys(a.player.employees).length<1?void this.makeInfoPopup({text:"Recruit some employees first"}):void this.makePopup("BuildingListPopup",{player:a.player,buildingTemplates:cg.content.buildings,buildingImages:this.frameImages,onOk:a.onOk})},a.prototype.makeBuildingConstructPopup=function(a){var b=function(b){b&&(actions.constructBuilding({playerId:a.player.id,gridPos:a.cell.gridPos,boardId:a.cell.board.id,buildingType:a.buildingTemplate.type,employeeId:b.employee.id}),a.onOk.call())};this.makeEmployeeActionPopup({player:a.player,relevantSkills:["construction"],text:"Select employee in charge of construction",onOk:b,okBtnText:"Build",action:{target:a.cell,actionText:"Constructing this building would take:",data:{time:{approximate:!0,amount:a.buildingTemplate.buildTime},cost:{approximate:!1,amount:a.player.getBuildCost(a.buildingTemplate)}},baseDuration:a.buildingTemplate.buildTime,exactCost:a.buildingTemplate.cost}})},a.prototype.makeInputPopup=function(a){this.makePopup("InputPopup",a)},a.prototype.makeNotification=function(a){a.id=this.idGenerator++,a.onClose=function(){a.onOk.call(),this.removeNotification(a.id)}.bind(this),this.notifications.push(a),this.updateReact()},a.prototype.removeNotification=function(a){this.notifications=this.notifications.filter(function(b){return b.id!==a}),this.updateReact()},a.prototype.incrementZIndex=function(a){var b=this.topZIndex++;return a&&(this.popups[a].zIndex=b),b},a.prototype.destroyPopup=function(a,b){b&&b.call(),this.popups[a]=null,delete this.popups[a],this.updateReact()},a.prototype.closeTopPopup=function(){if(!(Object.keys(this.popups).length<1)){var a,b=0;for(var c in this.popups)this.popups[c].zIndex>b&&(b=this.popups[c].zIndex,a=c);this.destroyPopup(a)}},a.prototype.clear=function(){this.clearNotifications(),this.clearAllPopups()},a.prototype.clearNotifications=function(){this.notifications=[]},a.prototype.clearAllPopups=function(){this.popups={}},a.prototype.updateReact=function(){document.hidden||React.renderComponent(UIComponents.Stage({popups:this.popups,notifications:this.notifications,player:this.player,frameImages:this.frameImages,showStats:void 0,fullScreenPopups:void 0}),document.getElementById("react-container"))},a}(),arrayLogic=function(a,b,c){var d,e={and:/(and)|&/i,not:/(not)|!/i,or:/(or)|\^/i};for(var f in e)e[f].test(a)&&(d=f);if(!d)throw new Error("faulty parameter: "+a);switch(d){case"and":return arrayLogic.and(b,c);case"not":return arrayLogic.not(b,c);case"or":return arrayLogic.or(b,c)}};arrayLogic.and=function(a,b){if(!arrayLogic.inputIsValid(a,b))return void 0;for(var c,d=0;d<a.length;d++){c=!1;for(var e=0;e<b.length;e++)if(a[d]===b[e]){c=!0;break}}return c},arrayLogic.not=function(a,b){if(!arrayLogic.inputIsValid(a,b))return void 0;for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(a[c]===b[d])return!1;return!0},arrayLogic.or=function(a,b){if(!arrayLogic.inputIsValid(a,b))return void 0;for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(a[c]===b[d])return!0;return!1},arrayLogic.inputIsValid=function(){for(var a=0;a<arguments.length;a++)if(!arguments[a]||!arguments[a].length||0===arguments[a].length)return!1;return!0};var playerModifiers;!function(a){a.testModifier={type:"testModifier",title:"testing",description:"test",effects:[{targets:["global"],addedProfit:50},{targets:["fastfood"],multiplier:4}]},a.prestigeDefault={type:"prestigeDefault",title:"Default prestige modifier",description:"1% total profit per prestige",dynamicEffect:{prestige:function(a){a.addSpecialModifier({type:"prestigeDefault",title:"Default prestige modifier",description:"0.5% total profit per prestige",effects:[{targets:["global"],multiplier:1+.005*a.prestige}]})}}},a.clickModifier1={type:"clickModifier1",title:"Hardly working",description:"+0.2$ / click",cost:50,unlockConditions:[{type:"level",value:1}],effects:[{targets:["click"],addedProfit:.2}]},a.clickModifier2={type:"clickModifier2",title:"Working hard",description:"+0.5$ / click",cost:200,unlockConditions:[{type:"clicks",value:200}],effects:[{targets:["click"],addedProfit:.5}]},a.clickModifier3={type:"clickModifier3",title:"Rolled up sleeves",description:"Clicking profit +20%",cost:1e3,unlockConditions:[{type:"clicks",value:400},{type:"money",value:250}],effects:[{targets:["click"],multiplier:1.2}]},a.clickModifier4={type:"clickModifier4",title:"A little bit of elbow grease",description:"Clicking profit +20%",cost:5e3,unlockConditions:[{type:"clicks",value:600},{type:"money",value:2e3}],effects:[{targets:["click"],multiplier:1.2}]},a.clickModifier5={type:"clickModifier5",title:"A lot more elbow grease",description:"Clicking profit +50%",cost:25e3,unlockConditions:[{type:"clicks",value:900},{type:"money",value:1e4}],effects:[{targets:["click"],multiplier:1.5}]},a.clickModifier6={type:"clickModifier6",title:"Way too much elbow grease",description:"Clicking profit +50%",cost:1e5,unlockConditions:[{type:"clicks",value:1200},{type:"money",value:5e4}],effects:[{targets:["click"],multiplier:1.5}]},a.parkingModifier1={type:"parkingModifier1",title:"Boom gates",description:"Parking +0.1$ /s",cost:50,unlockConditions:[{type:"parking",value:1}],effects:[{targets:["parking"],addedProfit:.1}]},a.parkingModifier2={type:"parkingModifier2",title:"Parking space effeciency",description:"Parking profits +20%",cost:500,unlockConditions:[{type:"parking",value:3}],effects:[{targets:["parking"],multiplier:1.2}]},a.parkingModifier3={type:"parkingModifier3",title:"Parking elevators",description:"Parking profits +20%",cost:2e3,unlockConditions:[{type:"parking",value:5}],effects:[{targets:["parking"],multiplier:1.2}]},a.parkingModifier4={type:"parkingModifier4",title:"Parking hyperspace efficiency",description:"Parking profits +50%",cost:1e4,unlockConditions:[{type:"parking",value:10}],effects:[{targets:["parking"],multiplier:1.5}]},a.parkingModifier5={type:"parkingModifier5",title:"Street parking meters",description:"Parking profits +50%",cost:5e4,unlockConditions:[{type:"parking",value:15}],effects:[{targets:["parking"],multiplier:1.5}]},a.convenienceModifier1={type:"convenienceModifier1",title:"Newspaper stands",description:"Retail buildings +0.5$ /s",cost:300,unlockConditions:[{type:"shopping",value:1}],effects:[{targets:["shopping"],addedProfit:.5}]},a.convenienceModifier2={type:"convenienceModifier2",title:"Lottery tickets",description:"Retail buildings +2$ /s",cost:1500,unlockConditions:[{type:"shopping",value:3}],effects:[{targets:["shopping"],addedProfit:2}]},a.convenienceModifier3={type:"convenienceModifier3",title:"Liquor license",description:"Retail profits +30%",cost:5e3,unlockConditions:[{type:"shopping",value:5}],effects:[{targets:["shopping"],multiplier:1.3}]},a.convenienceModifier4={type:"convenienceModifier4",title:"Loss leaders",description:"Retail profits + 50%",cost:5e4,unlockConditions:[{type:"shopping",value:10}],effects:[{targets:["shopping"],multiplier:1.5}]},a.convenienceModifier5={type:"convenienceModifier5",title:"Market saturation",description:"Retail profits + 50% - 1% per retail building",cost:25e4,unlockConditions:[{type:"shopping",value:15}],effects:[{targets:["shopping"],multiplier:1.5}],dynamicEffect:{shopping:function(a){a.addSpecialModifier({type:"convenienceModifier5",title:"Market saturation",description:"Retail profits + 50% - 1% per retail building",effects:[{targets:["shopping"],multiplier:1-.01*a.amountBuiltPerCategory.shopping}]})
}}},a.fastFoodModifier1={type:"fastFoodModifier1",title:"Jumbo-size fries",description:"Fast food restaurants +1.5$ /s",cost:700,unlockConditions:[{type:"fastfood",value:1}],effects:[{targets:["fastfood"],addedProfit:1.5}]},a.fastFoodModifier2={type:"fastFoodModifier2",title:"Jumbo-size soda cups",description:"Fast food restaurants +4$ /s",cost:2500,unlockConditions:[{type:"fastfood",value:3}],effects:[{targets:["fastfood"],addedProfit:4}]},a.fastFoodModifier3={type:"fastFoodModifier3",title:"Jumbo-size diet soda cups",description:"Fast food restaurant profits +30%",cost:7500,unlockConditions:[{type:"fastfood",value:5}],effects:[{targets:["fastfood"],multiplier:1.3}]},a.fastFoodModifier4={type:"fastFoodModifier4",title:"Jumbo-size set meals",description:"Fast food restaurant profits + 50%",cost:35e3,unlockConditions:[{type:"fastfood",value:10}],effects:[{targets:["fastfood"],multiplier:1.5}]},a.fastFoodModifier5={type:"fastFoodModifier5",title:"Chocolate chip cookies",description:"Fast food restaurant profits + 33%\nClicking profit +2% per restaurant",cost:15e4,unlockConditions:[{type:"fastfood",value:15}],effects:[{targets:["fastfood"],multiplier:1.33}],dynamicEffect:{fastfood:function(a){a.addSpecialModifier({type:"fastFoodModifier5",title:"Chocolate chip cookies",description:"Fast food restaurant profits + 33%\nClicking profit +2% per restaurant",effects:[{targets:["click"],multiplier:1+.02*a.amountBuiltPerCategory.fastfood}]})}}},a.apartmentModifier1={type:"apartmentModifier1",title:"Central heating",description:"Apartments +4$ /s",cost:1500,unlockConditions:[{type:"apartment",value:1}],effects:[{targets:["apartment"],addedProfit:4}]},a.apartmentModifier2={type:"apartmentModifier2",title:"Air conditioning",description:"Apartments +8$ /s",cost:5e3,unlockConditions:[{type:"apartment",value:3}],effects:[{targets:["apartment"],addedProfit:8}]},a.apartmentModifier3={type:"apartmentModifier3",title:"Soundproof Walls",description:"Apartment profits +20%",cost:15e3,unlockConditions:[{type:"apartment",value:5}],effects:[{targets:["apartment"],multiplier:1.2}]},a.apartmentModifier4={type:"apartmentModifier4",title:"Fitness centers",description:"Apartment profits + 50%",cost:75e3,unlockConditions:[{type:"apartment",value:10}],effects:[{targets:["apartment"],multiplier:1.5}]},a.apartmentModifier5={type:"apartmentModifier5",title:"Modular apartment buildings",description:"Apartment building cost -33%",cost:25e4,unlockConditions:[{type:"apartment",value:15}],effects:[{targets:["apartment"],buildCost:{multiplier:.67}}]},a.officeModifier1={type:"officeModifier1",title:"Red staplers",description:"Offices +8$ /s",cost:5e3,unlockConditions:[{type:"office",value:1}],effects:[{targets:["office"],addedProfit:8}]},a.officeModifier2={type:"officeModifier2",title:"Ass-resistant photocopiers",description:"Office profits +20%",cost:15e3,unlockConditions:[{type:"office",value:3}],effects:[{targets:["office"],multiplier:1.2}]},a.officeModifier3={type:"officeModifier3",title:"Ass-seeking photocopiers",description:"Office profits + 50%",cost:5e4,unlockConditions:[{type:"office",value:5}],effects:[{targets:["office"],multiplier:1.5}]},a.officeModifier4={type:"officeModifier4",title:"Middle management",description:"Office profits + 50%",cost:2e5,unlockConditions:[{type:"office",value:10}],effects:[{targets:["office"],multiplier:1.5}]},a.officeModifier5={type:"officeModifier5",title:"Corporate real estate",description:"Office profits + 25%\nBuying plots 2% cheaper per office",cost:5e5,unlockConditions:[{type:"office",value:15}],effects:[{targets:["office"],multiplier:1.25}],dynamicEffect:{office:function(a){a.addSpecialModifier({type:"officeModifier5",title:"Corporate real estate",description:"Office profits + 25%\nBuying plots 2% cheaper per office",effects:[{targets:["global"],buyCost:{multiplier:1-.02*a.amountBuiltPerCategory.office}}]})}}},a.factoryModifier1={type:"factoryModifier1",title:"Steam powered factories",description:"Factories +15$ /s",cost:5e4,unlockConditions:[{type:"factory",value:1}],effects:[{targets:["factory"],addedProfit:15}]},a.factoryModifier2={type:"factoryModifier2",title:"Electricity powered factories",description:"Factories +40$ /s",cost:15e4,unlockConditions:[{type:"factory",value:3}],effects:[{targets:["factory"],addedProfit:40}]},a.factoryModifier3={type:"factoryModifier3",title:"Baby animal powered factories",description:"Factory profits + 50%",cost:35e4,unlockConditions:[{type:"factory",value:5}],effects:[{targets:["factory"],multiplier:1.5}]},a.factoryModifier4={type:"factoryModifier4",title:"Lubricated crankshafts",description:"Factory profits + 50%",cost:6e5,unlockConditions:[{type:"factory",value:7}],effects:[{targets:["factory"],multiplier:1.5}]},a.factoryModifier5={type:"factoryModifier5",title:"OSHA regulations",description:"Factory profits + 50%\nFactory build cost +15%",cost:15e5,unlockConditions:[{type:"factory",value:12}],effects:[{targets:["factory"],multiplier:1.5,buildCost:{multiplier:1.15}}]},a.hotelModifier1={type:"hotelModifier1",title:"Heated swimming pool",description:"Hotels +30$ /s",cost:2e5,unlockConditions:[{type:"hotel",value:1}],effects:[{targets:["hotel"],addedProfit:30}]},a.hotelModifier2={type:"hotelModifier2",title:"Imported cleaning staff",description:"Building hotels is 15% cheaper",cost:4e5,unlockConditions:[{type:"hotel",value:3}],effects:[{targets:["hotel"],buildCost:{multiplier:.85}}]},a.hotelModifier3={type:"hotelModifier3",title:"Swim-up bar",description:"Hotel profits + 50%",cost:5e5,unlockConditions:[{type:"hotel",value:5}],effects:[{targets:["hotel"],multiplier:1.5}]},a.hotelModifier4={type:"hotelModifier4",title:"Guided tours",description:"Hotel profits + 50%",cost:1e6,unlockConditions:[{type:"hotel",value:7}],effects:[{targets:["hotel"],multiplier:1.5}]},a.hotelModifier5={type:"hotelModifier5",title:"Tourist pricing",description:"Hotel profits + 50%Global profit -5%",cost:1e6,unlockConditions:[{type:"hotel",value:12}],effects:[{targets:["hotel"],multiplier:1.5},{targets:["global"],multiplier:.95}]},a.modifiersByUnlock=function(){var b={};for(var c in a){var d=a[c];if(d.unlockConditions)for(var e=0;e<d.unlockConditions.length;e++){var f=d.unlockConditions[e];"default"!==f?(b[f.type]||(b[f.type]={}),b[f.type][f.value]||(b[f.type][f.value]=[]),b[f.type][f.value].push(d)):(b.default||(b.default=[]),b.default.push(d))}}return b}(),a.allModifiers=function(){var b=[];for(var c in a)a[c].type&&b.push(a[c]);return b}()}(playerModifiers||(playerModifiers={}));var levelUpModifiers;!function(a){a.testModifier={type:"testModifier",title:"testing",description:"test",effects:[{targets:["global"],addedProfit:50},{targets:["fastfood"],multiplier:4}]},a.fundingBoost1={type:"fundingBoost1",title:"Starting capital",description:"+250$",unlockConditions:[{type:"level",value:5}],onAdd:{oneTime:!0,effect:function(a){a.money+=250}}},a.clicksPerParking1={type:"clicksPerParking1",title:"Clicks per parking",description:"+0.2$ / click for every parking lot",unlockConditions:[{type:"level",value:5}],dynamicEffect:{parkinglot:function(a){a.addSpecialModifier({type:"clicksPerParking1",title:"Clicks per parking",description:"+0.2$ / click for every parking lot",effects:[{targets:["click"],addedProfit:.2*a.amountBuiltPerType.parkinglot}]})}}},a.clicksPerLevel1={type:"clicksPerLevel1",title:"Reverse carpal tunnel syndrome",description:"Clicking profit +2% per level",unlockConditions:[{type:"level",value:5}],dynamicEffect:{level:function(a){a.addSpecialModifier({type:"clicksPerLevel1",title:"Reverse carpal tunnel syndrome",description:"Clicks * 1.02 per level",effects:[{targets:["click"],multiplier:1+.02*a.level}]})}}},a.shoppingCostReduction1={type:"shoppingCostReduction1",title:"Franchising",description:"Shopping and fast food buildings 10% cheaper to build",unlockConditions:[{type:"level",value:5}],effects:[{targets:["shopping","fastfood"],buildCost:{multiplier:.9}}]},a.parkingCostReduction1={type:"parkingCostReduction1",title:"Discount asphalt",description:"Parking lots 35% cheaper to build",unlockConditions:[{type:"level",value:5}],effects:[{targets:["parking"],buildCost:{multiplier:.65}}]},a.fundingBoost2={type:"fundingBoost2",title:"More starting capital",description:"+1000$",unlockConditions:[{type:"level",value:10}],onAdd:{oneTime:!0,effect:function(a){a.money+=1e3}}},a.america1={type:"america1",title:"The American way",description:"Fast food profit +10% per parking lot and vice versa",unlockConditions:[{type:"level",value:10}],dynamicEffect:{parkinglot:function(a){a.addSpecialModifier({type:"america1_a",title:"The American way A",description:"Fast food profit +10% per parking",effects:[{targets:["fastfood"],multiplier:1+.1*a.amountBuiltPerType.parkinglot}]})},fastfood:function(a){a.addSpecialModifier({type:"america1_b",title:"The American way B",description:"Parking lot profit +10% per fast food restaurant",effects:[{targets:["parking"],multiplier:1+.1*a.amountBuiltPerType.fastfood}]})}}},a.betterSellPrice1={type:"betterSellPrice1",title:"Real estate flipping",description:"Get back an additional 15% of the cost when selling buildings and land",unlockConditions:[{type:"level",value:10}],onAdd:{oneTime:!1,effect:function(a){a.modifierEffects.sellPrice+=.15}}},a.increasedRecruitQuality1={type:"increasedRecruitQuality1",title:"Promising talent",description:"Better new recruits",unlockConditions:[{type:"level",value:10}],onAdd:{oneTime:!1,effect:function(a){a.modifierEffects.recruitQuality+=.25}}},a.fundingBoost3={type:"fundingBoost3",title:"External investors",description:"+5000$",unlockConditions:[{type:"level",value:25}],onAdd:{oneTime:!0,effect:function(a){a.money+=5e3}}},a.buildRush1={type:"buildRush1",title:"Construction boom",description:"All buildings 33% cheaper for 2 minutes",unlockConditions:[{type:"level",value:25}],onAdd:{oneTime:!0,effect:function(a){a.addTimedModifier({type:"buildRush1",title:"Construction boom",description:"All buildings 33% cheaper for 2 minutes",lifeTime:12e4,effects:[{targets:["global"],buildCost:{multiplier:.666}}]})}}},a.buildCostReduction1={type:"buildCostReduction1",title:"Deunionization",description:"All buildings are 5% cheaper to build",unlockConditions:[{type:"level",value:25}],effects:[{targets:["global"],buildCost:{multiplier:.95}}]},a.buyRush1={type:"buyRush1",title:"Land grab",description:"Buying plots 66% cheaper for 2 minutes",unlockConditions:[{type:"level",value:25}],onAdd:{oneTime:!0,effect:function(a){a.addTimedModifier({type:"buildRush1",title:"Land grab",description:"Buying plots 66% cheaper for 2 minutes",lifeTime:12e4,effects:[{targets:["global"],buyCost:{multiplier:.33}}]})}}},a.clickFrenzy1={type:"clickFrenzy1",title:"Click frenzy",description:"Clicking profits * 5 for 1 minutes",unlockConditions:[{type:"level",value:25}],onAdd:{oneTime:!0,effect:function(a){a.addTimedModifier({type:"clickFrenzy1",title:"Click frenzy",description:"Clicking profits * 5 for 1 minutes",lifeTime:6e4,effects:[{targets:["click"],multiplier:5}]})}}},a.shoppingProfitPerApartment={type:"shoppingProfitPerApartment",title:"Targeted marketing",description:"3% higher retail profit per owned apartment",unlockConditions:[{type:"level",value:25}],dynamicEffect:{apartment:function(a){a.addSpecialModifier({type:"shoppingProfitPerApartment",title:"Targeted marketing",description:"3% higher retail profit per owned apartment",effects:[{targets:["shopping"],multiplier:1+.03*a.amountBuiltPerCategory.apartment}]})}}},a.branchOffices1={type:"branchOffices1",title:"Branch offices",description:"2% higher global profit per office building",unlockConditions:[{type:"level",value:50}],dynamicEffect:{office:function(a){a.addSpecialModifier({type:"branchOffices1",title:"Branch offices",description:"2% higher global profit per office building",effects:[{targets:["global"],multiplier:1+.02*a.amountBuiltPerCategory.office}]})}}},a.increasedRecruitQuality2={type:"increasedRecruitQuality2",title:"Talent scouts",description:"Significantly better recruits",unlockConditions:[{type:"level",value:50}],onAdd:{oneTime:!1,effect:function(a){a.modifierEffects.recruitQuality+=.75}}},a.prestigeEffectIncrease1={type:"prestigeEffectIncrease1",title:"Increased prestige effect",description:"0.25% additional profit per prestige",unlockConditions:[{type:"level",value:50},{type:"prestige",value:1}],dynamicEffect:{prestige:function(a){a.addSpecialModifier({type:"prestigeEffectIncrease1",title:"Increased prestige effect",description:"0.25% additional profit per prestige",effects:[{targets:["global"],multiplier:1+.0025*a.prestige}]})}}},a.shoppingCostReductionPerFactory={type:"shoppingCostReductionPerFactory",title:"Supply chain",description:"Shopping buildings 2% cheaper per factory",unlockConditions:[{type:"level",value:50}],dynamicEffect:{factory:function(a){a.addSpecialModifier({type:"shoppingCostReductionPerFactory",title:"Supply chain",description:"Shopping buildings 2% cheaper per factory",effects:[{targets:["shopping"],buildCost:{multiplier:1-.02*a.amountBuiltPerCategory.factory}}]})}}},a.hotelParking1={type:"hotelParking1",title:"Valet service",description:"Parking lot profits +50% per hotel",unlockConditions:[{type:"level",value:75}],dynamicEffect:{hotel:function(a){a.addSpecialModifier({type:"hotelParking1",title:"Valet service",description:"Parking lot profits +50% per hotel",effects:[{targets:["parking"],multiplier:1+.5*a.amountBuiltPerCategory.hotel}]})}}},a.hotelFastfood1={type:"hotelFastfood1",title:"Local cuisine promotion",description:"Fast food profits +33% per hotel",unlockConditions:[{type:"level",value:75}],dynamicEffect:{hotel:function(a){a.addSpecialModifier({type:"hotelFastfood1",title:"Local cuisine promotion",description:"Fast food profits +33% per hotel",effects:[{targets:["fastfood"],multiplier:1+.33*a.amountBuiltPerCategory.hotel}]})}}},a.factoryPerLevel1={type:"factoryPerLevel1",title:"Experienced foremen",description:"Factory profits +2% per level",unlockConditions:[{type:"level",value:75}],dynamicEffect:{level:function(a){a.addSpecialModifier({type:"factoryPerLevel1",title:"Experienced foremen",description:"Factory profits +2% per level",effects:[{targets:["factory"],multiplier:1+.02*a.level}]})}}},a.prestigeHotel1={type:"prestigeHotel1",title:"Prestigious hotels",description:"Hotel profits +2% per prestige",unlockConditions:[{type:"level",value:75},{type:"prestige",value:1}],dynamicEffect:{prestige:function(a){a.addSpecialModifier({type:"prestigeHotel1",title:"Prestigious hotels",description:"Hotel profits +2% per prestige",effects:[{targets:["hotel"],multiplier:1+.02*a.prestige}]})}}},a.branchOffices2={type:"branchOffices2",title:"Company headquarters",description:"3% higher global profit per office building",unlockConditions:[{type:"level",value:75}],dynamicEffect:{office:function(a){a.addSpecialModifier({type:"branchOffices2",title:"Company headquarters",description:"3% higher global profit per office building",effects:[{targets:["global"],multiplier:1+.03*a.amountBuiltPerCategory.office}]})}}},a.modifiersByUnlock=function(){var b={};for(var c in a){var d=a[c];if(d.unlockConditions)for(var e=0;e<d.unlockConditions.length;e++){var f=d.unlockConditions[e];"default"!==f?(b[f.type]||(b[f.type]={}),b[f.type][f.value]||(b[f.type][f.value]=[]),b[f.type][f.value].push(d)):(b.default||(b.default=[]),b.default.push(d))}}return b}(),a.allModifiers=function(){var b=[];for(var c in a)a[c].type&&b.push(a[c]);return b}()}(levelUpModifiers||(levelUpModifiers={}));var employeeModifiers;!function(a){a.fastFoodTrait1={type:"fastFoodTrait1",title:"Burger flipping mastery",description:"Fast food profits +15%",unlockConditions:[{type:"skillTotal",value:5}],effects:[{targets:["fastfood"],multiplier:1.15}]},a.clicksPerShoppingTrait1={type:"clicksPerShoppingTrait1",title:"Product location manager",description:"Clicking profit +5% per retail building",unlockConditions:[{type:"skillTotal",value:10}],dynamicEffect:{shopping:function(a){a.addSpecialModifier({type:"clicksPerShoppingTrait1",title:"Product location manager",description:"Clicking profit +5% per retail building",effects:[{targets:["click"],multiplier:1+.05*a.amountBuiltPerCategory.shopping}]})}}},a.apartmentTrait1={type:"apartmentTrait1",title:"Landlord",description:"Apartment profits +20%",unlockConditions:[{type:"skillTotal",value:20}],effects:[{targets:["apartment"],multiplier:1.2}]},a.apartmentFactoriesTrait1={type:"apartmentFactoriesTrait1",title:"Union leader",description:"Factory profits +5% per apartment and vice versa.\nFactory & apartment cost +25%",unlockConditions:[{type:"skillTotal",value:50}],effects:[{targets:["factory","apartment"],buildCost:{multiplier:1.25}}],dynamicEffect:{apartment:function(a){a.addSpecialModifier({type:"apartmentFactoriesTrait1_a",title:"Union leader A",description:"Factory profits +5% per apartment.",effects:[{targets:["factory"],multiplier:1+.05*a.amountBuiltPerCategory.apartment}]})},factory:function(a){a.addSpecialModifier({type:"apartmentFactoriesTrait1_b",title:"Union leader B",description:"Apartment profits +5% per factory.",effects:[{targets:["apartment"],multiplier:1+.05*a.amountBuiltPerCategory.factory}]})}}},a.factoryBuildingsTrait1={type:"factoryBuildingsTrait1",title:"Industry connections",description:"All buildings 1% cheaper per factory",unlockConditions:[{type:"skillTotal",value:50}],dynamicEffect:{factory:function(a){a.addSpecialModifier({type:"factoryBuildingsTrait1",title:"Industry connections",description:"All buildings 1% cheaper per factory",effects:[{targets:["global"],buildCost:{multiplier:1-.01*a.amountBuiltPerCategory.factory}}]})}}},a.hotelShoppingTrait1={type:"hotelShoppingTrait1",title:"Shopping tourism promoter",description:"Retail profits +5% per hotel",unlockConditions:[{type:"skillTotal",value:57}],dynamicEffect:{hotel:function(a){a.addSpecialModifier({type:"hotelShoppingTrait1",title:"Shopping tourism promoter",description:"Retail profits +5% per hotel",effects:[{targets:["global"],multiplier:1+.05*a.amountBuiltPerCategory.hotel}]})}}},a.hotelTrait1={type:"hotelTrait1",title:"Concierge",description:"Hotel profits +10%",unlockConditions:[{type:"skillTotal",value:57}],effects:[{targets:["hotel"],multiplier:1.1}]},a.modifiersByUnlock=function(){var b={};for(var c in a){var d=a[c];if(d.unlockConditions)for(var e=0;e<d.unlockConditions.length;e++){var f=d.unlockConditions[e];"default"!==f?(b[f.type]||(b[f.type]={}),b[f.type][f.value]||(b[f.type][f.value]=[]),b[f.type][f.value].push(d)):(b.default||(b.default=[]),b.default.push(d))}}return b}(),a.allModifiers=function(){var b=[];for(var c in a)a[c].type&&b.push(a[c]);return b}()}(employeeModifiers||(employeeModifiers={}));var cellModifiers;!function(a){function b(a,b){return"undefined"==typeof b&&(b=1),{type:"niceEnviroment",title:"Nice enviroment",range:a,strength:b,targets:["apartment","office","hotel"],effect:{multiplier:.3},landValue:{radius:4,multiplier:.1,scalingFN:function(a){return 1+Math.log(a/2)}}}}function c(a,b){return"undefined"==typeof b&&(b=1),{type:"crowded",title:"Crowded",range:a,strength:b,targets:["apartment"],scaling:function(a){return a>=5?1+Math.log(a):0},effect:{multiplier:-.1}}}function d(a,b){return"undefined"==typeof b&&(b=1),{type:"population",title:"Nearby customers",range:a,strength:b,targets:["fastfood","shopping"],effect:{addedProfit:.3,multiplier:.2},scaling:function(a){return a},landValue:{radius:4,multiplier:.01}}}function e(a,b){return"undefined"==typeof b&&(b=1),{type:"fastfoodCompetition",title:"Competing restaurants",range:a,strength:b,targets:["fastfood"],effect:{addedProfit:-.25,multiplier:-.3}}}function f(a,b){return"undefined"==typeof b&&(b=1),{type:"shoppingCompetition",title:"Competing stores",range:a,strength:b,targets:["shopping"],effect:{addedProfit:-.2,multiplier:-.2}}}function g(a,b){return"undefined"==typeof b&&(b=1),{type:"nearbyShopping",title:"Nearby stores",range:a,strength:b,targets:["fastfood","parking"],effect:{multiplier:.2}}}function h(a,b){return"undefined"==typeof b&&(b=1),{type:"nearbyStation",title:"Nearby station",range:a,strength:b,targets:["fastfood","shopping","office","apartment","parking","hotel","stadium"],effect:{addedProfit:.25,multiplier:.25},landValue:{radius:20,multiplier:.05,falloffFN:function(a,b,c){return b*c}}}}function i(a,b){return"undefined"==typeof b&&(b=1),{type:"parkingCompetition",title:"Competing parking lots",range:a,strength:b,targets:["parking"],effect:{addedProfit:-.2,multiplier:-.2}}}function j(a,b){return"undefined"==typeof b&&(b=1),{type:"nearbyParking",title:"Nearby parking",range:a,strength:b,targets:["fastfood","shopping"],effect:{addedProfit:.25,multiplier:.1}}}function k(a,b){return"undefined"==typeof b&&(b=1),{type:"nearbyFactory",title:"Nearby Factory",range:a,strength:b,targets:["fastfood","shopping","apartment","office","hotel"],effect:{multiplier:-.15},landValue:{radius:5,multiplier:-.07,falloffFN:function(a,b,c){return b*c/2}}}}function l(a,b){return"undefined"==typeof b&&(b=1),{type:"nearbyRoad",title:"Nearby Road",range:a,strength:b,targets:["parking"],effect:{multiplier:.15},scaling:function(){return 1}}}function m(a,b){return"undefined"==typeof b&&(b=1),{type:"nearbyHotel",title:"Nearby Hotel",range:a,strength:b,targets:["office"],effect:{multiplier:.33},landValue:{radius:6,multiplier:.05,falloffFN:function(a,b,c){return b*c/2}}}}function n(a,b){return"undefined"==typeof b&&(b=1),{type:"hotelCompetition",title:"Competing hotels",range:a,strength:b,targets:["hotel"],effect:{multiplier:-.2}}}function o(a,b){return"undefined"==typeof b&&(b=1),{type:"nearbyStadium",title:"Nearby stadium",range:a,strength:b,targets:["parking"],effect:{multiplier:.2}}}function p(a,b){return"undefined"==typeof b&&(b=1),{type:"stadiumCompetition",title:"Competing stadiums",range:a,strength:b,targets:["stadium"],effect:{multiplier:-.25}}}a.niceEnviroment=b,a.crowded=c,a.population=d,a.fastfoodCompetition=e,a.shoppingCompetition=f,a.nearbyShopping=g,a.nearbyStation=h,a.parkingCompetition=i,a.nearbyParking=j,a.nearbyFactory=k,a.nearbyRoad=l,a.nearbyHotel=m,a.hotelCompetition=n,a.nearbyStadium=o,a.stadiumCompetition=p}(cellModifiers||(cellModifiers={}));var cg={terrain:{grass:{type:"grass",anchor:[.5,1],frame:"grass2.png",interactive:!0,hitArea:[[0,-32],[32,-16],[0,0],[-32,-16]],flags:["ground","grass"]},water:{type:"water",anchor:[.5,1],frame:"water.png",interactive:!0,hitArea:[[0,-32],[32,-16],[0,0],[-32,-16]],flags:["water"],effects:[{type:"niceEnviroment",range:2,strength:1}]},sand:{type:"sand",anchor:[.5,1],frame:"sand.png",interactive:!0,hitArea:[[0,-32],[32,-16],[0,0],[-32,-16]],flags:["ground","sand"]},snow:{type:"snow",anchor:[.5,1],frame:"snow.png",interactive:!0,hitArea:[[0,-32],[32,-16],[0,0],[-32,-16]],flags:["ground","snow"]}},content:{underConstruction:{type:"underConstruction",baseType:"underConstruction",anchor:[.5,1],frame:["underconstruction.png"]},plants:{grass:{tree1:{type:"tree1",baseType:"plant",anchor:[.5,1],frame:["tree1.png"],canBuildOn:["grass"],effects:[{type:"niceEnviroment",range:2,strength:1}]},tree2:{type:"tree2",baseType:"plant",anchor:[.5,1],frame:["tree2.png"],canBuildOn:["grass"],effects:[{type:"niceEnviroment",range:2,strength:1}]},tree3:{type:"tree3",baseType:"plant",anchor:[.5,1],frame:["tree3.png"],canBuildOn:["grass"],effects:[{type:"niceEnviroment",range:2,strength:1}]},tree4:{type:"tree4",baseType:"plant",anchor:[.5,1],frame:["tree4.png"],canBuildOn:["grass"],effects:[{type:"niceEnviroment",range:2,strength:1}]},tree5:{type:"tree5",baseType:"plant",anchor:[.5,1],frame:["tree5.png"],canBuildOn:["grass"],effects:[{type:"niceEnviroment",range:2,strength:1}]}},sand:{cactus:{type:"cactus",baseType:"plant",anchor:[.5,1.5],frame:["cactus.png"],canBuildOn:["sand"]}},water:{tentacle:{type:"tentacle",baseType:"plant",anchor:[.5,1.5],frame:["tentacle.png"],canBuildOn:["water"]}},snow:{snowman:{type:"snowman",baseType:"plant",anchor:[.5,1.25],frame:["snowman.png"],canBuildOn:["snow"]}}},roads:{road_h:{type:"road_h",baseType:"road",categoryType:"road",title:"Road",anchor:[.5,1],frame:["road_h.png"],effects:[{type:"nearbyRoad",range:1,strength:1}]},road_v:{type:"road_v",baseType:"road",categoryType:"road",title:"Road",anchor:[.5,1],frame:["road_v.png"],effects:[{type:"nearbyRoad",range:1,strength:1}]},road_ne:{type:"road_ne",baseType:"road",categoryType:"road",title:"Road",anchor:[.5,1],frame:["road_ne.png"],effects:[{type:"nearbyRoad",range:1,strength:1}]},road_nw:{type:"road_nw",baseType:"road",categoryType:"road",title:"Road",anchor:[.5,1],frame:["road_nw.png"],effects:[{type:"nearbyRoad",range:1,strength:1}]},road_sw:{type:"road_sw",baseType:"road",categoryType:"road",title:"Road",anchor:[.5,1],frame:["road_sw.png"],effects:[{type:"nearbyRoad",range:1,strength:1}]},road_es:{type:"road_es",baseType:"road",categoryType:"road",title:"Road",anchor:[.5,1],frame:["road_se.png"],effects:[{type:"nearbyRoad",range:1,strength:1}]},road_nesw:{type:"road_nesw",baseType:"road",categoryType:"road",title:"Road",anchor:[.5,1],frame:["road_news.png"],effects:[{type:"nearbyRoad",range:1,strength:1}]},road_new:{type:"road_new",baseType:"road",categoryType:"road",title:"Road",anchor:[.5,1],frame:["road_new.png"],effects:[{type:"nearbyRoad",range:1,strength:1}]},road_nsw:{type:"road_nsw",baseType:"road",categoryType:"road",title:"Road",anchor:[.5,1],frame:["road_nsw.png"],effects:[{type:"nearbyRoad",range:1,strength:1}]},road_esw:{type:"road_esw",baseType:"road",categoryType:"road",title:"Road",anchor:[.5,1],frame:["road_sew.png"],effects:[{type:"nearbyRoad",range:1,strength:1}]},road_nes:{type:"road_nes",baseType:"road",categoryType:"road",title:"Road",anchor:[.5,1],frame:["road_nse.png"],effects:[{type:"nearbyRoad",range:1,strength:1}]}},tubes:{tube_h:{type:"tube_h",baseType:"tube",anchor:[.5,1],frame:["tube_h.png"]},tube_v:{type:"tube_v",baseType:"tube",anchor:[.5,1],frame:["tube_v.png"]},tube_ne:{type:"tube_ne",baseType:"tube",anchor:[.5,1],frame:["tube_ne.png"]},tube_nw:{type:"tube_nw",baseType:"tube",anchor:[.5,1],frame:["tube_nw.png"]},tube_sw:{type:"tube_sw",baseType:"tube",anchor:[.5,1],frame:["tube_sw.png"]},tube_es:{type:"tube_es",baseType:"tube",anchor:[.5,1],frame:["tube_se.png"]},tube_nesw:{type:"tube_nesw",baseType:"tube",anchor:[.5,1],frame:["tube_news.png"]},tube_new:{type:"tube_new",baseType:"tube",anchor:[.5,1],frame:["tube_new.png"]},tube_nsw:{type:"tube_nsw",baseType:"tube",anchor:[.5,1],frame:["tube_nsw.png"]},tube_esw:{type:"tube_esw",baseType:"tube",anchor:[.5,1],frame:["tube_sew.png"]},tube_nes:{type:"tube_nes",baseType:"tube",anchor:[.5,1],frame:["tube_nse.png"]}},buildings:{house1:{type:"house1",baseType:"building",categoryType:"apartment",title:"Apartment 1",baseProfit:16,daysForProfitTick:1,cost:3e3,buildTime:14,anchor:[.5,1],frame:["house1.png"],canNotBuildOn:["water","building","road"],population:5,effects:[{type:"crowded",range:2,strength:1},{type:"population",range:3,strength:1}]},house2:{type:"house2",baseType:"building",categoryType:"apartment",title:"Apartment 2",baseProfit:200,daysForProfitTick:1,cost:1e5,buildTime:21,anchor:[.5,1],frame:["house2.png"],canNotBuildOn:["water","building","road"],population:10,effects:[{type:"crowded",range:2,strength:2},{type:"population",range:3,strength:2}]},house3:{type:"house3",baseType:"building",categoryType:"apartment",title:"Apartment 3",baseProfit:1.2,daysForProfitTick:1,cost:25,buildTime:14,anchor:[.5,1],frame:["house3.png"],canNotBuildOn:["water","building","road"],population:5,effects:[{type:"crowded",range:2,strength:1},{type:"population",range:3,strength:1}]},house4:{type:"house4",baseType:"building",categoryType:"apartment",title:"Apartment 4",baseProfit:2.5,daysForProfitTick:1,cost:50,buildTime:21,anchor:[.5,1],frame:["house4.png"],canNotBuildOn:["water","building","road"],population:10,effects:[{type:"crowded",range:2,strength:2},{type:"population",range:3,strength:2}]},house5:{type:"house5",baseType:"building",categoryType:"apartment",title:"Apartment 5",baseProfit:2.5,daysForProfitTick:1,cost:50,buildTime:21,anchor:[.5,1],frame:["house5.png"],canNotBuildOn:["water","building","road"],population:10,effects:[{type:"crowded",range:2,strength:2},{type:"population",range:3,strength:2}]},house6:{type:"house6",baseType:"building",categoryType:"apartment",title:"Apartment 6",baseProfit:2.5,daysForProfitTick:1,cost:50,buildTime:21,anchor:[.5,1],frame:["house6.png"],canNotBuildOn:["water","building","road"],population:10,effects:[{type:"crowded",range:2,strength:2},{type:"population",range:3,strength:2}]},house7:{type:"house7",baseType:"building",categoryType:"apartment",title:"Apartment 7",baseProfit:1.2,daysForProfitTick:1,cost:25,buildTime:14,anchor:[.425,1],frame:["house7.png"],canNotBuildOn:["water","building","road"],population:5,effects:[{type:"crowded",range:2,strength:1},{type:"population",range:3,strength:1}]},fastfood:{type:"fastfood",baseType:"building",categoryType:"fastfood",title:"Fast food restaurant",baseProfit:3,daysForProfitTick:1,cost:150,buildTime:14,anchor:[.5,1],frame:["fastfood.png"],canNotBuildOn:["water","building","road"],effects:[{type:"fastfoodCompetition",range:3,strength:1}]},conveniencestore:{type:"conveniencestore",baseType:"building",categoryType:"shopping",title:"Convenience store",baseProfit:8,daysForProfitTick:1,cost:1e3,buildTime:10,anchor:[.5,1],frame:["conveniencestore.png"],canNotBuildOn:["water","building","road"],effects:[{type:"shoppingCompetition",range:2,strength:1},{type:"nearbyShopping",range:2,strength:1}]},smalloffice:{type:"smalloffice",baseType:"building",categoryType:"office",title:"Small office",baseProfit:40,daysForProfitTick:1,cost:1e4,buildTime:21,anchor:[.5,1],frame:["smalloffice.png"],canNotBuildOn:["water","building","road"],effects:[{type:"population",range:3,strength:1}]},smallstation:{type:"smallstation",baseType:"building",categoryType:"station",title:"Small station",cost:0,buildTime:1,anchor:[.5,1],frame:["smallstation.png"],canNotBuildOn:["water","building","road"],underground:"tube_nesw",effects:[{type:"nearbyStation",range:3,strength:1}]},parkinglot:{type:"parkinglot",baseType:"building",categoryType:"parking",title:"Parking lot",baseProfit:1,daysForProfitTick:1,cost:25,buildTime:7,anchor:[.5,1],frame:["parkinglot.png"],canNotBuildOn:["water","building","road"],effects:[{type:"nearbyParking",range:2,strength:1}]},stretchystore:{type:"stretchystore",baseType:"building",categoryType:"shopping",title:"Convenience store 2",size:[2,1],baseProfit:60,daysForProfitTick:1,cost:25e3,buildTime:14,anchor:[.5,1],frame:["stretchystore_f0.png","stretchystore_f1.png"],icon:"stretchystore.png",canNotBuildOn:["water","building","road"],effects:[{type:"shoppingCompetition",range:3,strength:1},{type:"nearbyShopping",range:3,strength:1}]},factory:{type:"factory",baseType:"building",categoryType:"factory",title:"Factory",baseProfit:100,daysForProfitTick:1,cost:5e4,buildTime:21,anchor:[.5,1],frame:["factory.png"],canNotBuildOn:["water","building","road"],effects:[{type:"nearbyFactory",range:4,strength:1}]},hotel:{type:"hotel",baseType:"building",categoryType:"hotel",title:"Hotel",baseProfit:100,daysForProfitTick:1,cost:25e4,buildTime:21,anchor:[.5,1],frame:["hotel.png"],canNotBuildOn:["water","building","road"],effects:[{type:"nearbyHotel",range:4,strength:1},{type:"hotelCompetition",range:3,strength:1}]},departmentStore:{type:"departmentStore",baseType:"building",categoryType:"shopping",title:"Department store",size:[1,2],baseProfit:60,daysForProfitTick:1,cost:25e3,buildTime:21,anchor:[.5,1],frame:["departmentstore_f0.png","departmentstore_f1.png"],icon:"departmentstore.png",canNotBuildOn:["water","building","road"],effects:[{type:"shoppingCompetition",range:3,strength:2},{type:"nearbyShopping",range:4,strength:2}]},soccerStadium:{type:"soccerStadium",baseType:"building",categoryType:"stadium",title:"Soccer stadium",size:[2,2],baseProfit:60,daysForProfitTick:1,cost:25e3,buildTime:30,anchor:[.5,1],frame:["soccerstadium_f0.png","soccerstadium_f2.png","soccerstadium_f1.png","soccerstadium_f3.png"],icon:"soccerstadium.png",canNotBuildOn:["water","building","road"],effects:[{type:"stadiumCompetition",range:3,strength:1},{type:"nearbyStadium",range:2,strength:1}]}}}},buildingTypeIndexes={};
!function a(b){for(var c in b)if("effects"===c){for(var d=[],e={negative:{},positive:{}},f=0;f<b.effects.length;f++){var g=b.effects[f];cellModifiers[g.type]||console.error("Invalid effect defined on ",b);var h=cellModifiers[g.type].call(null,g.range,g.strength);h.center=b.size||[1,1],h.scaling=h.scaling||function(a){return 1+Math.log(a)},d.push(h);for(var i in h.effect){var j="positive";h.effect[i]<0&&(j="negative");for(var k=0;k<h.targets.length;k++)e[j][h.targets[k]]=!0}}b.translatedEffects=d,b.effectTargets={positive:Object.keys(e.positive),negative:Object.keys(e.negative)}}else"object"==typeof b[c]&&a(b[c])}(cg);var effectSourcesIndex={};!function b(a){for(var c in a)if("effectTargets"===c)for(var d in a[c])for(var e=a[c][d],f=0;f<e.length;f++){var g=e[f];effectSourcesIndex[g]||(effectSourcesIndex[g]={positive:[],negative:[]});var h=a.categoryType||"enviroment";effectSourcesIndex[g][d].indexOf(h)<0&&effectSourcesIndex[g][d].push(h)}else"object"==typeof a[c]&&b(a[c])}(cg),function c(a){for(var b in a)"frame"===b?a.icon||1!==a.frame.length||(a.icon=a.frame[0]):"object"==typeof a[b]&&c(a[b])}(cg);var playerBuildableBuildings=[];["parkinglot","conveniencestore","fastfood","house1","smalloffice","stretchystore","house2","factory","hotel","departmentStore"].forEach(function(a){playerBuildableBuildings.push(findType(a))});for(var basevalues=[[25,.3],[300,.7],[700,1.5],[1500,3],[5e3,10],[2e4,13],[5e4,20],[1e5,50],[25e4,75],[75e4,90],[125e4,120]],i=0;i<playerBuildableBuildings.length;i++){var type=playerBuildableBuildings[i];type.cost=basevalues[i][0],type.baseProfit=basevalues[i][1]}var names={american:{male:["James","Christopher","Ronald","John","Daniel","Anthony","Robert","Paul","Kevin","Michael","Mark","Jason","William","Donald","Robin","Jeff","David","George","Richard","Kenneth","Charles","Steven","Joseph","Edward","Thomas","Brian","Davis"],female:["Mary","Lisa","Michelle","Patricia","Nancy","Laura","Linda","Karen","Sarah","Barbara","Betty","Kimberly","Elizabeth","Helen","Deborah","Jennifer","Sandra","Maria","Donna","Susan","Carol","Margaret","Ruth"],surnames:["Smith","Anderson","Clark","Wright","Mitchell","Johnson","Thomas","Rodriguez","Lopez","Perez","Williams","Jackson","Lewis","Hill","Roberts","Jones","White","Lee","Scott","Turner","Brown","Harris","Walker","Green","Phillips","Davis","Martin","Hall","Adams","Campbell","Miller","Farmer","Thompson","Allen","Baker","Parker","Wilson","Garcia","Young","Gonzalez","Evans","Moore","Martinez","Hernandez","Nelson","Edwards","Taylor","Robinson","King","Carter","Collins"]},british:{male:["Abdul","Mark","David","Andrew","Richard","Christopher","James","Simon","Michael","Matthew","Stephen","Lee","John","Robert","Darren","Daniel","Steven","Jason","Nicholas","Jonathan","Ian","Neil","Peter","Stuart","Anthony","Martin","Kevin","Craig","Philip","Gary","Scott","Wayne","Timothy","Benjamin","Adam","Alan","Dean","Adrian","Carl","Thomas","William","Graham","Alexander","Colin","Jamie","Gareth","Justin","Barry","Christian","Karl","Brian","Edward","Keith","Marc","Nigel","Sean","Shaun","Nathan","Joseph","Russell","Mohammed","Jeremy","Phillip","Damian","Shane","Duncan","Patrick","Julian","Dominic","Charles","Marcus","Gavin","Tony","Antony","Robin","Trevor","Glen","Iain","Ryan","Martyn","Gregory","Samuel","George","Oliver","Raymond","Abdul","Mathew","Stewart","Malcolm","Garry","Leon","Brett","Terry","Kenneth","Luke","Roger","Glenn","Leigh","Terence","Derek"],female:["Sarah","Claire","Nicola","Emma","Lisa","Joanne","Michelle","Helen","Samantha","Karen","Amanda","Rachel","Louise","Julie","Clare","Rebecca","Sharon","Victoria","Caroline","Susan","Alison","Catherine","Elizabeth","Deborah","Donna","Tracey","Tracy","Angela","Jane","Zoe","Kerry","Melanie","Sally","Jennifer","Dawn","Andrea","Suzanne","Lucy","Joanna","Anna","Charlotte","Paula","Katherine","Maria","Marie","Fiona","Kelly","Natalie","Kathryn","Jacqueline","Wendy","Sara","Hayley","Laura","Natasha","Ruth","Lorraine","Tina","Rachael","Anne","Stephanie","Kirsty","Christine","Julia","Gillian","Cheryl","Hannah","Vanessa","Ann","Jayne","Diane","Heather","Sandra","Teresa","Kate","Linda","Mary","Elaine","Georgina","Emily","Katie","Alexandra","Nichola","Carol","Sophie","Heidi","Kim","Tanya","Patricia","Beverley","Leanne","Denise","Tara","Clair","Sonia","Debbie","Lesley","Anita","Lindsey","Debra"],surnames:["Smith","Jones","Taylor","Williams","Brown","Davies","Evans","Wilson","Thomas","Roberts","Johnson","Lewis","Walker","Robinson","Wood","Thompson","White","Watson","Jackson","Wright","Green","Harris","Cooper","King","Lee","Martin","Clarke","James","Morgan","Hughes","Edwards","Hill","Moore","Clark","Harrison","Scott","Young","Morris","Hall","Ward","Turner","Carter","Phillips","Mitchell","Patel","Adams","Campbell","Anderson","Allen","Cook","Bailey","Parker","Miller","Davis","Murphy","Price","Bell","Baker","Griffiths","Kelly","Simpson","Marshall","Collins","Bennett","Cox","Richardson","Fox","Gray","Rose","Chapman","Hunt","Robertson","Shaw","Reynolds","Lloyd","Ellis","Richards","Russell","Wilkinson","Khan","Graham","Stewart","Reid","Murray","Powell","Palmer","Holmes","Rogers","Stevens","Walsh","Hunter","Thomson","Matthews","Ross","Owen","Mason","Knight","Kennedy","Butler","Saunders"]},german:{male:["Christian","Michael","Stefan","Andreas","Thomas","Marcus","Matthias","Sven","Jan","Alexander","Oliver","Martin","Torsten","Frank","Marco","Marc","Daniel","Jens","Karsten","Andre","Dirk","Lars","Sebastian","Tobias","Sascha","Jrg","Kai","Bjrn","Florian","Christoph","Peter","Dennis","Maik","Ralf","Robert","Ren","Patrick","Holger","Nils","Heiko","Mario","Philip","Olaf","Steffen","Timo","Tim","Ingo","Jrgen","Marcel","Volker","Benjamin","Bernd","Arne","Axel","Klaus","David","Jrn","Felix","Boris","Mirko","Henning","Uwe","Torben","Wolfgang","Nico","Mohammed","Ali","Manuel","Malte","Johannes","Jochen","Simon","Joachim","Roland"],female:["Nicole","Stefanie","Sandra","Katrin","Claudia","Tanja","Anja","Melanie","Andrea","Daniela","Julia","Susanne","Christina","Katja","Kerstin","Ivonne","Silke","Sabine","Sonja","Alexandra","Nadine","Nina","Simone","Maike","Christine","Petra","Britta","Anna","Martina","Michaela","Manuela","Bianka","Silvia","Katharina","Bettina","Ulrike","Heike","Anke","Birgit","Christiane","Jessica","Monika","Maren","Anne","Antje","Eva","Jana","Diana","Cornelia","Wiebke","Tina","Kirsten","Miriam","Carolin","Maria","Astrid","Jennifer","Tatjana","Annika","Angela","Corinna","Barbara","Elena","Annette","Jasmin","Olga","Birte","Verena","Ines","Natalie","Inga","Iris","Ina","Irina"],surnames:["Mller","Schmidt","Schneider","Fischer","Meyer","Weber","Schulz","Wagner","Becker","Hoffmann","Schfer","Koch","Bauer","Schrder","Klein","Richter","Wolf","Neumann","Schwarz","Schmitz","Krger","Braun","Zimmermann","Schmitt","Lange","Hartmann","Hofmann","Krause","Werner","Meier","Schmid","Schulze","Lehmann","Khler","Maier","Herrmann","Knig","Mayer","Walter","Peters","Mller","Huber","Kaiser","Fuchs","Scholz","Weiss","Lang","Jung","Hahn","Keller"]},chinese:{props:{surname_first:!0},male:["An","Bo","Cheng","De","Dong","Feng","Gang","Guo","Hui","Jian","Jie","Kang","Liang","Ning","Peng","Tao","Wei","Yong","Wen"],female:["Ai","Bi","Cai","Dan","Fang","Hong","Hui","Juan","Lan","Li","Li","Lian","Na","Ni","Qian","Qiong","Shan","Shu","Ting","Xia","Xian","Yan","Yun","Zhen"],surnames:["Wang","Lei","Chang","Liu","Chen","Yang","Wong","Chao","Wu","Chou","Hs","Sun","Ma","Chu","Hu"]},japanese:{props:{surname_first:!0},male:["Akira","Atsushi","Daiki","Daisuke","Eiichi","Fumio","Hideo","Hiroshi","Hisao","Hisashi","Hitoshi","Hosei","Ichiro","Jiro","Jun","Junichi","Katsumi","Kazuo","Kazuya","Keiichi","Ken","Kenichi","Kiyoshi","Koichi","Makoto","Manabu","Masahiro","Masatoshi","Michio","Naoki","Nobuo","Norio","Osamu","Seiji","Shigeru","Shinichi","Shinji","Shouji","Shouta","Shozo","Susumu","Tadao","Takashi","Takeo","Takeshi","Takuya","Teruo","Tetsuo","Yasuo","Yasushi","Yoichi","Yoshihiro","Yoshio","Yutaka"],female:["Akiko","Hiroko","Kaori","Kaoru","Kazuko","Keiko","Kumiko","Kyouko","Mai","Mami","Masako","Mayumi","Megumi","Michiko","Noriko","Reiko","Sachiko","Tomoko","Toshiko","Yoshiko","Youko","Yumiko","Yuuko"],surnames:["Satou","Suzuki","Takahashi","Tanaka","Watanabe","Itou","Nakamura","Kobayashi","Yamamoto","Katou","Yoshida","Yamada","Sasaki","Yamaguchi","Hamada","Matsumoto","Inoue","Kimura","Shimizu","Hayashi","Saitou","Yamasaki","Nakajima","Mori","Abe","Ikeda","Hashimoto","Ishikawa","Yamashita","Ogawa","Ishii","Hasegawa","Gotou","Okada","Kond","Maeda","Fujita","Endo","Aoki","Sakamoto","Murakami","Ota","Kaneko","Fujii","Fukuda","Nishimura","Miura","Takeuchi","Nakagawa","Okamoto","Matsuda","Harada","Nakano"]},korean:{props:{surname_first:!0},male:["Dong-hyun","Hyun-woo","Ji-hoon","Jin-ho","Joon-ho","Jun-young","Jung-hoon","Min-ho","Sung-hoon","Sung-min"],female:["Ji-hye","Hye-jin","Ji-young","Ji-eun","Soo-jin","Eun-jung","Jiyeon","Eun-young","Sun-young","Hyun-jung"],surnames:["Kim","Lee","Park","Choi","Jeong","Kang","Cho","Yoon","Jang","Lim","Han","O","Shin","Seo","Kwon","Hwang","Ahn","Song","Yoo","Hong","Jeon","Ko","Mun","Son","Yang"]}},eventManager=new PIXI.EventTarget,numberFormatters=[rawFormatter,formatEveryThirdPower([""," million"," billion"," trillion"," quadrillion"," quintillion"," sextillion"," septillion"," octillion"," nonillion"," decillion"],2),formatEveryThirdPower([""," M"," B"," T"," Qa"," Qi"," Sx"," Sp"," Oc"," No"," De"],2),formatEveryThirdPower([""," M"," B"," T"," Qa"," Qi"," Sx"," Sp"," Oc"," No"," De"],3)],Options;!function(a){a.drawClickPopups=!0,eventManager.addEventListener("toggleDrawClickPopups",function(){a.drawClickPopups=!a.drawClickPopups,eventManager.dispatchEvent({type:"saveOptions",content:null})}),a.autosaveLimit=3,eventManager.addEventListener("setAutosaveLimit",function(b){a.autosaveLimit=b.content,eventManager.dispatchEvent({type:"saveOptions",content:null})})}(Options||(Options={}));var Strawb;!function(a){var b=function(){function a(a){this.autoStart=a,this.runningTime=0,this.running=!1,this.getTime=Date.now;var b=window.performance;b||b.now&&(this.getTime=function(){return b.now()}),a!==!1&&this.start()}return a.prototype.start=function(){if(!this.running){var a=this.getTime();this.startTime||(this.startTime=a),this._runStartTime=a,this._previousTime=a,this.running=!0}},a.prototype.stop=function(){this.getRunningTime(),this.running=!1},a.prototype.getTotalTime=function(){return this.totalTime=this.getTime()-this.startTime,this.totalTime},a.prototype.getRunningTime=function(){if(!this.running)return this.runningTime;var a=this.getTime();return this.runningTime+=a-this._runStartTime,this._runStartTime=a,this.runningTime},a.prototype.getDelta=function(){var a=this.getTime();return this.deltaTime=.001*(a-this._previousTime),this._previousTime=a,this.deltaTime},a}();a.Timer=b}(Strawb||(Strawb={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},SortedDisplayObjectContainer=function(a){function b(b){this._sortingIndexes=new Array(b),a.call(this),this.init()}return __extends(b,a),b.prototype.init=function(){for(var a=0;a<this._sortingIndexes.length;a++)this._sortingIndexes[a]=0},b.prototype.incrementIndexes=function(a){for(var b=a+1;b<this._sortingIndexes.length;b++)this._sortingIndexes[b]++},b.prototype.decrementIndexes=function(a){for(var b=a+1;b<this._sortingIndexes.length;b++)this._sortingIndexes[b]--},b.prototype._addChildAt=function(b,c){a.prototype.addChildAt.call(this,b,this._sortingIndexes[c]),this.incrementIndexes(c)},b.prototype._removeChildAt=function(b,c){a.prototype.removeChild.call(this,b),this.decrementIndexes(c)},b}(PIXI.DisplayObjectContainer),mapGeneration;!function(a){function b(a){return j[a]||(j[a]=findType(a)),j[a]}function c(a){a.height=a.height||a.width;for(var b=[],c=0;c<a.width;c++){b[c]=[];for(var d=0;d<a.height;d++)b[c][d]="grass"}return b}function d(a,c,d){for(var e=window,f=e.Cell,g=0;g<a.length;g++)for(var h=0;h<a[g].length;h++)a[g][h]=new f([g,h],b(a[g][h]),c,d);if(d!==!0)for(var g=0;g<a.length;g++)for(var h=0;h<a[g].length;h++)a[g][h].init()}function e(a){for(var c=a.board.cells,d=0;d<a.board.width;d++)for(var e=0;e<a.board.height;e++){var f=c[d][e],g=a.savedCells[d][e];f.replace(b(g.type)),g.player&&g.player.addCell(f),g.content&&f.changeContent(b(g.content.type),!0,g.content.player,!1),g.undergroundContent&&f.changeUndergroundContent(cg.content.tubes.tube_nesw)}}function f(a){a.mapHeight=a.mapHeight||a.width;var b=function(a){if(a.coasts)return a.coasts;var b=a.amount,c={n:{hasCoast:!1},e:{hasCoast:!1},s:{hasCoast:!1},w:{hasCoast:!1}};if(void 0===b)for(var b=0,d=a.amountWeights||[1,.5,.5,0],e=0;e<d.length&&1-Math.random()<d[e];e++)b++;if(0===b)for(var f in c)c[f].hasCoast=!1;else if(4===b)for(var f in c)c[f].hasCoast=!0;else{var g=getRandomKey(c);c[g].hasCoast=!0;for(var h=Object.keys(c),i=h.indexOf(g),j=2*Math.round(Math.random())-1,e=1;b>e;e++){var k=(i+j)%h.length;0>k&&(k+=h.length);var l=h[k];c[l].hasCoast=!0,j*=-1}}return c}(a);for(var c in b){var d=b[c];if(d.hasCoast){var e=a.width,f=a.mapHeight;d.depth=d.depth||a.depth||Math.floor(f/4),d.variation=d.variation||a.variation||.05,d.baseVariation=d.baseVariation||a.baseVariation||[0,1],d.yFalloff=d.yFalloff||a.yFalloff||d.depth/50,d.yFalloffType=d.yFalloffType||a.yFalloffType||"logarithmic",d.xCutoff=d.xCutoff||a.xCutoff||.3,d.xFalloff=d.xFalloff||a.xFalloff||a.width/150,d.xFalloffType=d.xFalloffType||a.xFalloffType||"logarithmic",d.landThreshhold=d.landThreshhold||a.landThreshhold||.2,d.xFalloffPerY=d.xFalloffPerY||a.xFalloffPerY||0}for(var g=d.finalCoast=[],h=0;h<d.depth;h++){g[h]=[];var i;switch(d.yFalloffType){case"linear":i=1-d.yFalloff*h;break;case"logarithmic":i=1-Math.log(1+d.yFalloff*h),0>i&&(i=0)}for(var j=a.width/2-a.width/2*d.xCutoff,k=0;e>k;k++){var l=1,m=Math.abs(a.width/2-(k+.5)),n=1-m/(a.width/2);if(n<d.xCutoff){var o=m-j;switch(d.xFalloffType){case"linear":l=1-d.xFalloff*o;break;case"logarithmic":l=1-d.xFalloff*Math.log(o),0>l&&(l=0)}l*=1-d.xFalloffPerY*Math.log(h)}var p=(randRange(d.baseVariation[0],d.baseVariation[1])+randRange(-d.variation,d.variation))*i*l;p=p>d.landThreshhold?1:0,g[h][k]=p}}}return b}function g(a){var b=a.coasts;for(var c in b){var d=b[c],e=d.offset?[Math.round(d.offset[0]),Math.round(d.offset[1])]:[0,0];if(d.hasCoast){switch(c){case"n":case"w":d.finalCoast=d.finalCoast.reverse()}switch(c){case"e":case"w":for(var f=[],g=0;g<d.finalCoast.length;g++)for(var h=0;h<d.finalCoast[g].length;h++)f[h]||(f[h]=[]),f[h][g]=d.finalCoast[g][h];d.finalCoast=f}switch(c){case"w":d.startPoint=[e[1],e[0]];break;case"n":d.startPoint=e;break;case"e":d.startPoint=[a.cells.length-d.depth+e[1],e[0]];break;case"s":d.startPoint=[e[0],a.cells.length-d.depth+e[1]]}for(var g=0;g<d.finalCoast.length;g++)for(var h=0;h<d.finalCoast[g].length;h++){var i=d.startPoint[0]+h,j=d.startPoint[1]+g,k=1===d.finalCoast[g][h]?a.primaryType:a.subType;a.cells[i][j]=k}}}}function h(a,b,c,d,e){"undefined"==typeof e&&(e=1);var g=[];for(var h in a)a[h].hasCoast&&g.push(h);if(g.length<1&&(b+=.2,c.xFalloffPerY=0,c.yFalloff=1e-7,g.push(getRandomArrayItem(["n","e","s","w"]))),g.length>e||Math.random()>b)return null;var i=getRandomArrayItem(g),j=getReverseDir(i);c.coasts={n:{hasCoast:!1},e:{hasCoast:!1},s:{hasCoast:!1},w:{hasCoast:!1}},c.coasts[j].hasCoast=!0,c.coasts[j].offset=d;var k=f(c);return k}function i(a,b,c,d){"undefined"==typeof b&&(b=.4),"undefined"==typeof c&&(c=1),"undefined"==typeof d&&(d=1);for(var e=[],f=0;f<a.length;f++){e[f]=[];for(var g=0;g<a[f].length;g++){for(var h=(a[f][g],getArea({targetArray:a,start:[f,g],size:c,excludeStart:!1})),j=0,k={},l=0;l<h.length;l++){var m=h[l];void 0!==m&&(k[m]||(k[m]=0),k[m]++,j++)}var n=void 0,o=0;for(var p in k)k[p]>o&&(n=p,o=k[p]);e[f][g]=o/j>=b?n:a[f][g]}}return d--,d>0?i(e,b,d):e}var j={};a.makeBlankCells=c,a.convertCells=d,a.readSavedMap=e,a.generateCellNoise=f,a.applyCoastsToCells=g,a.makeRivers=h,a.smoothCells=i}(mapGeneration||(mapGeneration={}));var cityGeneration;!function(a){function b(a){return h[a]||(h[a]=findType(a)),h[a]}function c(a,b,c){var d=!0;if(c)for(var e=0;e<c.length;e++)for(var f=c[e].flags,g=a.getArea({size:c[e].radius}),h=0;h<g.length;h++){if(arrayLogic.or(f,g[h].flags)){d=!1;break}if(g[h].content&&arrayLogic.or(f,g[h].content.flags)){d=!1;break}}return a.checkBuildable(b)||(d=!1),d}function d(a,d,e,f){for(var g,h=b(d),i=1-e,j=a.width/2*i,k=a.height/2*i,l=[j,k],m=[a.width-j-1,a.height-k-1],n=0;100>n;n++){var o=randInt(l[0],m[0]),p=randInt(l[1],m[1]),q=a.getCell([o,p]),r=c(q,h,f);if(r){g=[o,p];break}}if(g)return q.changeContent(h),g;throw new Error("Couldn't place building")}function e(a){var b=[];for(var c in a.mapGenInfo.coasts)a.mapGenInfo.coasts[c].hasCoast!==!0&&b.push(c);b.length<1&&b.push(getRandomArrayItem(["n","e","s","w"]));for(var d=a.mapGenInfo.mainStationPos.slice(0),e=0;e<b.length;e++){var f,c=b[e];switch(c){case"w":f=[0,d[1]];break;case"n":f=[d[0],0];break;case"e":f=[a.width-1,d[1]];break;case"s":f=[d[0],a.height-1]}for(var g=a.getCells(manhattanSelect(d,f)),h=0;h<g.length;h++)g[h].changeUndergroundContent(cg.content.tubes.tube_nesw)}}function f(a){var b={},c=!1;for(var d in a.mapGenInfo.coasts)a.mapGenInfo.coasts[d].hasCoast!==!0&&(b[d]=!0,c=!0);if(!c){var e=getRandomArrayItem(["n","e","s","w"]);b[e]=!0}var f=a.mapGenInfo.mainStationPos.slice(0),g=[0,0],h={n:[0,1],s:[0,-1],e:[-1,0],w:[1,0]},i=Object.keys(b);[["n","s"],["e","w"]].forEach(function(a){var b=[];if(a.forEach(function(a){i.indexOf(a)>-1&&b.push(a)}),b.length>0)if(i.length<=1)g[0]+=h[b[0]][1],g[1]+=h[b[0]][0];else if(1===b.length)g[0]+=h[b[0]][0],g[1]+=h[b[0]][1];else{var c=getRandomArrayItem(a);g[0]+=h[c][0],g[1]+=h[c][1]}}),f[0]+=g[0],f[1]+=g[1];for(var d in b){var j;switch(d){case"w":j=[0,f[1]];break;case"n":j=[f[0],0];break;case"e":j=[a.width-1,f[1]];break;case"s":j=[f[0],a.height-1]}for(var k=a.getCells(manhattanSelect(f,j)),l=0;l<k.length;l++)k[l].changeContent(cg.content.roads.road_nesw)}}function g(a){var c=a.population,e=[];for(var f in cg.content.buildings)"apartment"===cg.content.buildings[f].categoryType&&5===cg.content.buildings[f].population&&e.push(f);for(;c>0;){var g=getRandomArrayItem(e);d(a,g,.9,[{radius:1,flags:["water"]}]),c-=b(g).population}}var h={};a.placeBuilding=d,a.placeMainSubwayLines=e,a.placeStationRoads=f,a.placeInitialHousing=g}(cityGeneration||(cityGeneration={}));var idGenerator=idGenerator||{};idGenerator.board=0;var Board=function(){function a(a){this.mapGenInfo={},this.layers={},this.id=void 0!==a.id?a.id:idGenerator.board++,this.name="City "+this.id,this.width=a.width,this.height=a.height||a.width,this.totalSize=this.width*this.height,this.initLayers(),this.population=a.population||randInt(this.totalSize/15,this.totalSize/10),this.cells=mapGeneration.makeBlankCells({width:this.width,height:this.height}),a.savedCells?(mapGeneration.convertCells(this.cells,this,!0),mapGeneration.readSavedMap({board:this,savedCells:a.savedCells})):(this.generateMap(),this.generateCity())}return a.prototype.generateMap=function(){var a=window.performance?window.performance.now():Date.now(),b=this.mapGenInfo.coasts=mapGeneration.generateCellNoise({width:this.width,mapHeight:this.height,amountWeights:[1,.5,.4,0],variation:.5,yFalloff:.14,xCutoff:.3,xFalloff:.1,xFalloffPerY:.3,landThreshhold:.4});mapGeneration.applyCoastsToCells({cells:this.cells,primaryType:"grass",subType:"water",coasts:b});var c=this.mapGenInfo.rivers=mapGeneration.makeRivers(b,.7,{width:this.width/4,mapHeight:this.height,depth:this.height,variation:1e-6,baseVariation:[.8,1],yFalloff:1e-5,xCutoff:.7,xFalloff:.6,xFalloffPerY:.4,landThreshhold:.2},[this.width/2-this.width/8,0]);this.cells=mapGeneration.smoothCells(this.cells,.6,1,4),this.cells=mapGeneration.smoothCells(this.cells,.6,2,2),this.cells=mapGeneration.smoothCells(this.cells,.7,3,1),c&&mapGeneration.applyCoastsToCells({cells:this.cells,primaryType:"water",subType:"grass",coasts:c}),this.cells=mapGeneration.smoothCells(this.cells,.5,1,2),mapGeneration.convertCells(this.cells,this,!1);var d=window.performance?window.performance.now():Date.now(),e=d-a;console.log("map gen in "+Math.round(e)+" ms")},a.prototype.generateCity=function(){this.mapGenInfo.mainStationPos=cityGeneration.placeBuilding(this,"smallstation",.4,[{flags:["water"],radius:4}]),cityGeneration.placeStationRoads(this),cityGeneration.placeMainSubwayLines(this),cityGeneration.placeInitialHousing(this)},a.prototype.getCell=function(a){return this.cells[a[0]]&&this.cells[a[1]]?this.cells[a[0]][a[1]]:!1},a.prototype.getCells=function(a){return getFrom2dArray(this.cells,a)},a.prototype.destroy=function(){for(var a=0;a<this.cells.length;a++)for(var b=0;b<this.cells[a].length;b++)this.cells[a][b]=null},a.prototype.initLayers=function(){for(var a=1;1>=a;a++){var b="zoom"+a,c=this.layers[b]={};c.undergroundContent=new SortedDisplayObjectContainer(2*this.totalSize),c.ground=new PIXI.DisplayObjectContainer,c.landValueOverlay=new PIXI.DisplayObjectContainer,c.cellOverlay=new SortedDisplayObjectContainer(2*this.totalSize),c.content=new SortedDisplayObjectContainer(2*this.totalSize)}},a.prototype.addSpriteToLayer=function(a,b,c){for(var d in this.layers){var e=this.layers[d][a];e._addChildAt?e._addChildAt(b,c[0]+c[1]):e.addChild(b)}},a.prototype.removeSpriteFromLayer=function(a,b,c){for(var d in this.layers){var e=this.layers[d][a];e._removeChildAt?e._removeChildAt(b,c[0]+c[1]):e.removeChild(b)}},a}(),Highlighter=function(){function a(){this.currHighlighted=[],this.currTransparent=[]}return a.prototype.tintSprites=function(a,b,c){"undefined"==typeof c&&(c=!0);for(var d=0;d<a.length;d++){var e=a[d];e.tint=b,c&&this.currHighlighted.push(a[d])}},a.prototype.clearSprites=function(a){"undefined"==typeof a&&(a=!0);for(var b=0;b<this.currHighlighted.length;b++){var c=this.currHighlighted[b];c.tint=16777215}a&&this.clearHighlighted()},a.prototype.clearHighlighted=function(){this.currHighlighted=[]},a.prototype.tintCells=function(a,b,c){"undefined"==typeof c&&(c=!0);for(var d=[],e=0;e<a.length;e++)d.push(a[e].sprite),void 0!==a[e].content&&(d=d.concat(a[e].content.sprites));this.tintSprites(d,b,c)},a.prototype.alphaBuildings=function(a,b){for(var c=0;c<a.length;c++)if(void 0!==a[c].content)for(var d=a[c].content,e=0;e<d.sprites.length;e++){var f=d.sprites[e];f.height<53||(f.alpha=b,this.currTransparent.push(f))}},a.prototype.clearAlpha=function(){for(var a=0;a<this.currTransparent.length;a++)this.currTransparent[a].alpha=1;this.currTransparent=[]},a}(),__extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},Blinker=function(a){function b(b,c,d,e){return"undefined"==typeof e&&(e=!0),a.call(this),this.delay=b,this.color=c,this.repeat=d,this.toBlink={},this.idGenerator=0,this.blinkFunctions=[],this.onRemoveCallbacks={},this.repeat=2*d,this.makeBlinkFunctions(),e&&this.start(),this}return __extends(b,a),b.prototype.getToBlink=function(a){if(a)return this.toBlink[a];var b=[];for(var c in this.toBlink)b=b.concat(this.toBlink[c]);return b},b.prototype.makeBlinkFunctions=function(){var a=function(){return this.color}.bind(this),b=function(){this.tintCells(this.getToBlink(),a(),!1)}.bind(this),c=this.clearFN=function(a){this.tintCells(this.getToBlink(a),16777215,!1)}.bind(this);this.blinkFunctions=[b,c],this.blink=function(){this.blinkFunctions[0].call(),this.blinkFunctions[this.blinkFunctions.length-1]=this.blinkFunctions.shift(),eventManager.dispatchEvent({type:"updateWorld",content:""}),this.repeat>0&&(this.repeat--,this.repeat<=0&&this.stop())}.bind(this)},b.prototype.addCells=function(a,b,c){return"undefined"==typeof c&&(c=this.idGenerator++),this.toBlink[c]=this.toBlink[c]?this.toBlink[c].concat(a):a,b&&(this.onRemoveCallbacks[c]=b),c},b.prototype.removeCells=function(a){return this.toBlink[a]?(Object.keys(this.toBlink).length<=1?this.stop():(this.clearFN(a),this.toBlink[a]=null,delete this.toBlink[a]),this.onRemoveCallbacks[a]&&(this.onRemoveCallbacks[a].call(),this.onRemoveCallbacks[a]=null,delete this.onRemoveCallbacks[a]),a):void 0},b.prototype.start=function(){if(this.intervalFN)return this;var a=this;return a.blink(),this.intervalFN=window.setInterval(a.blink,a.delay),this},b.prototype.pause=function(){return window.clearInterval(this.intervalFN),this.intervalFN=null,this},b.prototype.stop=function(){return this.pause(),this.clearFN(),eventManager.dispatchEvent({type:"updateWorld",content:""}),this.toBlink={},this},b}(Highlighter),keyboardStates={"default":{keydown:{32:function(){},107:function(){eventManager.dispatchEvent({type:"incrementSpeed",content:""})},187:function(){eventManager.dispatchEvent({type:"incrementSpeed",content:""})},109:function(){eventManager.dispatchEvent({type:"decrementSpeed",content:""})},189:function(){eventManager.dispatchEvent({type:"decrementSpeed",content:""})},82:function(){eventManager.dispatchEvent({type:"recruitHotkey",content:""})},85:function(a){eventManager.dispatchEvent({type:"buyHotkey",content:a})},66:function(a){eventManager.dispatchEvent({type:"buildHotkey",content:a})},67:function(a){eventManager.dispatchEvent({type:"clickHotkey",content:a})},83:function(a){eventManager.dispatchEvent({type:"sellHotkey",content:a})}}}},KeyboardEventHandler=function(){function a(a){"undefined"==typeof a&&(a="default"),this.listeners={},this.statesObj=keyboardStates,this.setState(a)}return a.prototype.setState=function(a){this.removeListeners(),this.addEventListeners(a),this.currState=a},a.prototype.addEventListeners=function(a){for(var b in this.statesObj[a]){var c;if("keydown"===b)c=this.handleKeydown.bind(this);else{if("keyup"!==b)return void console.warn("Tried to bind invalid keyboard event ",b);c=this.handleKeyup.bind(this)}this.listeners[b]=document.addEventListener(b,c)}},a.prototype.removeListeners=function(){for(var a in this.listeners)document.removeEventListener(a,this.listeners[a]);this.listeners={}},a.prototype.handleKeydown=function(a){if(this.statesObj[this.currState].keydown[a.keyCode]){if("INPUT"===a.target.tagName&&"text"===a.target.type||"TEXTAREA"===a.target.tagName)return;a.preventDefault(),this.statesObj[this.currState].keydown[a.keyCode].call(null,a)}},a.prototype.handleKeyup=function(){},a}(),idGenerator=idGenerator||{};idGenerator.employee=0;var Employee=function(){function a(a,b){this.active=!0,this.id=b.id||"employee"+idGenerator.employee++,this.gender=b.gender||getRandomArrayItem(["male","female"]),this.ethnicity=b.ethnicity||getRandomKey(a),this.name=b.name||this.getName(a,this.gender,this.ethnicity);var c=Math.round(b.skillVariance)||1;if(b.skills&&b.skills.management&&delete b.skills.management,this.skills=b.skills||this.setSkillsByLevel(b.skillLevel,c),this.growth=b.growth||this.setGrowthByLevel(b.growthLevel),this.potential=b.potential||60,b.trait&&this.addTrait(employeeModifiers[b.trait]),this.setSkillTotal(),void 0===b.id){var d=isFinite(b.traitChance)?b.traitChance:.05,e=Math.random();d>=e&&this.addRandomTrait()}}return a.prototype.getName=function(a,b,c){var d=getRandomArrayItem(a[c][b]),e=getRandomArrayItem(a[c].surnames),f="";return f+=a[c].props&&a[c].props.surname_first?e+" "+d:d+" "+e},a.prototype.setSkillsByLevel=function(a,b){var c={negotiation:1,recruitment:1,construction:1},d=8*a+1,e=16*a+1+b;for(var f in c)c[f]=randInt(d,e),c[f]>20&&(c[f]=20);return c},a.prototype.setGrowthByLevel=function(a){var b={negotiation:1,recruitment:1,construction:1};for(var c in b){var d=Math.random()*a;b[c]=d>.4?d:.4}return b},a.prototype.setSkillTotal=function(){var a=0;for(var b in this.skills)a+=this.skills[b];this.skillTotal=a},a.prototype.trainSkill=function(a){if(!(this.skillTotal>=this.potential||this.skills[a]>=20)){var b=Math.random(),c=this.growth[a]*(2/Math.log(this.skills[a]+.5));b+c>1&&(this.skills[a]++,this.skillTotal++)}},a.prototype.addTrait=function(a){this.trait=a,this.player&&this.player.addEmployeeModifier(a)},a.prototype.addRandomTrait=function(){var a=getRandomArrayItem(this.getAvailableTraits());this.addTrait(a)},a.prototype.getAvailableTraits=function(){var a=[],b=employeeModifiers.modifiersByUnlock.skillTotal;for(var c in b)this.skillTotal>=parseInt(c)&&(a=a.concat(b[c]));return a},a}(),Player=function(){function a(a,b){"undefined"==typeof b&&(b=16711680),this.money=0,this.clicks=0,this.level=1,this.experience=0,this.experienceForCurrentLevel=0,this.experienceToNextLevel=0,this.timesReset=0,this.prestige=0,this.totalResetExperience=0,this.permanentLevelupUpgrades=[],this.ownedContent={},this.amountBuiltPerType={},this.amountBuiltPerCategory={},this.ownedCells={},this.ownedCellsAmount=0,this.employees={},this.usedInitialRecruit=!1,this.incomePerDate={},this.incomePerType={},this.rollingIncome=[0,0,0],this.modifiers={},this.dynamicModifiers={},this.timedModifiers={},this.levelUpModifiers={},this.specialModifiers={},this.defaultModifiers={},this.employeeModifiers={},this.modifierEffects={profit:{},buildCost:{},buyCost:{},recruitQuality:1,sellPrice:.5},this.unlockedModifiers=[],this.lockedModifiers=[],this.unlockedLevelUpModifiers={},this.levelUpModifiersPerLevelUp=4,this.levelsAlreadyPicked={},this.recentlyCheckedUnlockConditions={},this.indexedProfits={},this.indexedProfitsWithoutGlobals={},this.id=a,this.color=b,this.init(),this.updateElements()}return a.prototype.updateElements=function(){var a=this.money>999999?3:0,b="$"+beautify(this.money,a),c=this.experienceToNextLevel>999999?2:0,d=this.rollingIncome[2],e={total:b,rolling:d.toFixed(1)};eventManager.dispatchEvent({type:"updatePlayerMoney",content:e}),eventManager.dispatchEvent({type:"updatePlayerExp",content:{experience:beautify(this.experience,c),nextLevel:beautify(this.experienceToNextLevel,c),level:this.level,percentage:this.getExperiencePercentage()}})},a.prototype.init=function(){for(var a in cg.content.buildings){var b=cg.content.buildings[a];this.ownedContent[b.categoryType]||(this.ownedContent[b.categoryType]=[]),void 0===this.amountBuiltPerType[b.type]&&(this.amountBuiltPerType[b.type]=0),void 0===this.amountBuiltPerCategory[b.categoryType]&&(this.amountBuiltPerCategory[b.categoryType]=0),void 0===this.incomePerType[b.categoryType]&&(this.incomePerType[b.categoryType]=0),this.modifierEffects.profit[b.categoryType]={addedProfit:0,multiplier:1},this.modifierEffects.buildCost[b.categoryType]={addedCost:0,multiplier:1}}this.modifierEffects.profit.global={addedProfit:0,multiplier:1},this.modifierEffects.buildCost.global={addedCost:0,multiplier:1},this.modifierEffects.buyCost.global={addedCost:0,multiplier:1},this.modifierEffects.profit.click={addedProfit:1,multiplier:1},this.setExperienceToNextLevel(),this.setInitialAvailableModifiers(),this.addModifier(playerModifiers.prestigeDefault,"defaultModifiers")},a.prototype.addEmployee=function(a){this.employees[a.id]=a,a.player=this,a.trait&&this.addEmployeeModifier(a.trait)},a.prototype.removeEmployee=function(a){if(a.trait){this.removeModifier(a.trait,"employeeModifiers");for(var b in this.employees){var c=this.employees[b];c.trait&&c.trait.type===a.trait.type&&this.addEmployeeModifier(c.trait)}}this.employees[a.id]=null,delete this.employees[a.id]},a.prototype.getEmployees=function(){var a=[];for(var b in this.employees)a.push(this.employees[b]);return a},a.prototype.getActiveEmployees=function(){var a=[];for(var b in this.employees)b.active!==!1&&a.push(this.employees[b]);return a},a.prototype.addCell=function(a){this.ownedCells[a.gridPos]||(this.ownedCells[a.gridPos]=a,a.player=this,a.addOverlay(this.color),this.ownedCellsAmount++)},a.prototype.removeCell=function(a){this.ownedCells[a.gridPos]&&(a.overlay&&a.removeOverlay(),delete this.ownedCells[a.gridPos],a.player=null,this.ownedCellsAmount--)},a.prototype.sellCell=function(a){var b=this.getCellBuyCost(a)*this.modifierEffects.sellPrice;this.addMoney(b,"sell"),this.removeCell(a)},a.prototype.addContent=function(a){this.ownedContent[a.categoryType]&&(this.ownedContent[a.categoryType].push(a),this.amountBuiltPerType[a.type.type]++,this.amountBuiltPerCategory[a.type.categoryType]++,this.checkLockedModifiers(a.type.type,-1),this.checkLockedModifiers(a.type.categoryType,-1),a.player=this,this.updateDynamicModifiers(a.type.type),this.updateDynamicModifiers(a.type.categoryType))
},a.prototype.removeContent=function(a){this.ownedContent[a.categoryType]=this.ownedContent[a.categoryType].filter(function(b){return b.id!==a.id}),this.amountBuiltPerType[a.type.type]--,this.amountBuiltPerCategory[a.type.categoryType]--,this.updateDynamicModifiers(a.type.type),this.updateDynamicModifiers(a.type.categoryType)},a.prototype.sellContent=function(a){var b=a.type;if(b.cost&&a.player&&a.player.id===this.id){var c=this.getBuildCost(b)*this.modifierEffects.sellPrice;this.addMoney(c,"sell")}},a.prototype.addMoney=function(a,b,c,d){var e=a;if(b&&["sell","initial"].indexOf(b)<0&&(e=this.getIndexedProfit(b,a,c)),e>0&&"sell"!==b&&"initial"!==b&&this.addExperience(e),b&&(void 0===this.incomePerType[b]&&(this.incomePerType[b]=0),this.incomePerType[b]+=e),d){this.incomePerDate[d.year]=this.incomePerDate[d.year]||{total:0};var f=this.incomePerDate[d.year];f.total+=e,f[d.month]=f[d.month]||{total:0};var g=f[d.month];g.total+=e,g[d.day]?g[d.day]+=e:g[d.day]=e,this.addToRollingIncome(e,d)}if(!isFinite(e))throw new Error("Infinite amount of money added");return this.money+=e,this.checkLockedModifiers("money"),this.updateElements(),e},a.prototype.subtractCost=function(a){if(!isFinite(a))throw new Error("Infinite amount of money subtracted");return this.money-=a,this.checkLockedModifiers("money"),this.updateElements(),a},a.prototype.addModifier=function(a,b,c){if("undefined"==typeof b&&(b="modifiers"),"undefined"==typeof c&&(c=!0),!this[b][a.type]){if(c){if(a.cost&&a.cost>this.money)return;a.cost&&this.subtractCost(a.cost)}var d=this.unlockedModifiers.indexOf(a);d>-1&&this.unlockedModifiers.splice(d,1),this[b][a.type]=Object.create(a),a.effects&&this.applyModifier(a),a.onAdd&&(a.onAdd.oneTime&&c!==!0||a.onAdd.effect.call(null,this)),a.dynamicEffect&&this.addDynamicModifier(a)}},a.prototype.addSpecialModifier=function(a){this.specialModifiers[a.type]&&this.removeModifier(this.specialModifiers[a.type],"specialModifiers"),this.addModifier(a,"specialModifiers")},a.prototype.addTimedModifier=function(a){if(!a.lifeTime)throw new Error("Timed modifier"+a.type+"has no life time set");this.timedModifiers[a.type]&&window.clearTimeout(this.timedModifiers[a.type]);var b=function(){this.removeModifier(this.specialModifiers[a.type],"specialModifiers"),window.clearTimeout(this.timedModifiers[a.type])}.bind(this);this.timedModifiers[a.type]=window.setTimeout(b,a.lifeTime),this.addSpecialModifier(a)},a.prototype.addDynamicModifier=function(a){for(var b in a.dynamicEffect){var c=a.dynamicEffect[b];this.dynamicModifiers[b]||(this.dynamicModifiers[b]={}),this.dynamicModifiers[b][a.type]=c,this.updateDynamicModifiers(b)}},a.prototype.addEmployeeModifier=function(a){this.addModifier(a,"employeeModifiers")},a.prototype.applyModifier=function(a){for(var b=0;b<a.effects.length;b++)for(var c=a.effects[b],d=0;d<c.targets.length;d++){var e=c.targets[d];c.addedProfit&&(this.modifierEffects.profit[e].addedProfit+=c.addedProfit),c.multiplier&&(this.modifierEffects.profit[e].multiplier*=c.multiplier),c.buildCost&&(c.buildCost.addedProfit&&(this.modifierEffects.buildCost[e].addedCost+=c.buildCost.addedCost),c.buildCost.multiplier&&(this.modifierEffects.buildCost[e].multiplier*=c.buildCost.multiplier)),c.buyCost&&(c.buyCost.addedProfit&&(this.modifierEffects.buyCost.addedCost+=c.buyCost.addedCost),c.buyCost.multiplier&&(this.modifierEffects.buyCost.multiplier*=c.buyCost.multiplier)),this.clearIndexedProfits()}},a.prototype.applyAllModifiers=function(){for(var a in this.modifiers)this.applyModifier(this.modifiers[a])},a.prototype.removeModifier=function(a,b){if("undefined"==typeof b&&(b="modifiers"),!this[b][a.type])return void console.warn("Modifier ",a," does not exist on player ",this);for(var c=0;c<a.effects.length;c++)for(var d=a.effects[c],e=0;e<d.targets.length;e++){var f=d.targets[e];d.addedProfit&&(this.modifierEffects.profit[f].addedProfit-=d.addedProfit),d.multiplier&&(this.modifierEffects.profit[f].multiplier*=1/d.multiplier),d.buildCost&&(d.buildCost.addedProfit&&(this.modifierEffects.buildCost[f].addedCost-=d.buildCost.addedCost),d.buildCost.multiplier&&(this.modifierEffects.buildCost[f].multiplier*=1/d.buildCost.multiplier)),d.buycost&&(d.buycost.addedProfit&&(this.modifierEffects.buyCost.addedCost-=d.buycost.addedCost),d.buycost.multiplier&&(this.modifierEffects.buyCost.multiplier*=1/d.buycost.multiplier)),this.clearIndexedProfits()}this[b][a.type]=null,delete this.modifiers[a.type]},a.prototype.getBuildCost=function(a){var b=a.cost,c=this.amountBuiltPerType[a.type],d=b*Math.pow(1.4,c);return b+=this.modifierEffects.buildCost[a.categoryType].addedCost,b+=this.modifierEffects.buildCost.global.addedCost,b*=this.modifierEffects.buildCost[a.categoryType].multiplier,b*=this.modifierEffects.buildCost.global.multiplier,b*=Math.pow(1.4,c),.2*d>b&&(b=.2*d),Math.round(b)},a.prototype.getCellBuyCost=function(a){var b=a.landValue*Math.pow(1.1,this.ownedCellsAmount),c=b;return c+=this.modifierEffects.buyCost.global.addedCost,c*=this.modifierEffects.buyCost.global.multiplier,.2*b>c&&(c=.2*b),c},a.prototype.addExperience=function(a){this.experience+=a,this.experience>=this.experienceToNextLevel&&this.levelUp()},a.prototype.levelUp=function(a){if("undefined"==typeof a&&(a=0),this.level++,this.setExperienceToNextLevel(),this.unlockLevelUpModifiers(this.level),this.updateDynamicModifiers("level"),this.experience>=this.experienceToNextLevel){if(a>101)throw new Error;this.levelUp(a++)}},a.prototype.getExperienceForLevel=function(a){return 0>=a?0:Math.round(100*Math.pow(1.12,a-1))},a.prototype.setExperienceToNextLevel=function(){this.experienceForCurrentLevel=this.experienceToNextLevel,this.experienceToNextLevel+=this.getExperienceForLevel(this.level)},a.prototype.getExperiencePercentage=function(){var a=this.experience-this.experienceForCurrentLevel;return Math.floor(100*(a/this.getExperienceForLevel(this.level)))},a.prototype.getModifiedProfit=function(a,b,c,d){"undefined"==typeof d&&(d=!0);var e=a,c=c||1;return d&&(e+=this.modifierEffects.profit.global.addedProfit*c),b&&this.modifierEffects.profit[b]&&(e+=this.modifierEffects.profit[b].addedProfit*c,e>0&&(e*=this.modifierEffects.profit[b].multiplier)),d&&e>0&&(e*=this.modifierEffects.profit.global.multiplier),a>0&&0>e&&(e=0),e},a.prototype.getIndexedProfit=function(a,b,c){return this.indexedProfits[a]||(this.indexedProfits[a]={}),this.indexedProfits[a][b]||(this.indexedProfits[a][b]=this.getModifiedProfit(b,a,c)),this.indexedProfits[a][b]},a.prototype.getIndexedProfitWithoutGlobals=function(a,b){return this.indexedProfitsWithoutGlobals[a]||(this.indexedProfitsWithoutGlobals[a]={}),this.indexedProfitsWithoutGlobals[a][b]||(this.indexedProfitsWithoutGlobals[a][b]=this.getModifiedProfit(b,a,1,!1)),this.indexedProfitsWithoutGlobals[a][b]},a.prototype.clearIndexedProfits=function(){this.indexedProfits={},this.indexedProfitsWithoutGlobals={}},a.prototype.getUnlockConditionVariable=function(a){return-1!==["clicks","money","level","prestige"].indexOf(a)?this[a]:void 0!==this.amountBuiltPerType[a]?this.amountBuiltPerType[a]:void 0!==this.amountBuiltPerCategory[a]?this.amountBuiltPerCategory[a]:void 0},a.prototype.checkIfUnlocked=function(a){if(!a.unlockConditions)return!1;for(var b=!0,c=0;c<a.unlockConditions.length;c++){var d=a.unlockConditions[c],e=this.getUnlockConditionVariable(d.type);e<d.value&&(b=!1)}return b},a.prototype.setInitialAvailableModifiers=function(){var a=playerModifiers.allModifiers;this.lockedModifiers=a.slice(0),this.unlockedModifiers=[];for(var b=0;b<this.lockedModifiers.length;b++){var c=this.lockedModifiers[b];this.checkIfUnlocked(c)&&this.unlockModifier(c)}},a.prototype.checkLockedModifiers=function(a,b){"undefined"==typeof b&&(b=1e3);var c=playerModifiers.modifiersByUnlock[a];if(c&&!this.recentlyCheckedUnlockConditions[a]){b>0&&(this.recentlyCheckedUnlockConditions[a]=!0,window.setTimeout(function(){this.recentlyCheckedUnlockConditions[a]=!1}.bind(this),b));for(var d=Object.keys(c),e=0;e<d.length;e++){var f=this.getUnlockConditionVariable(a);if(f>=parseInt(d[e]))for(var g=c[d[e]],h=0;h<g.length;h++)if(!(this.modifiers[g[h].type]||this.unlockedModifiers.indexOf(g[h])>-1)){var i=this.checkIfUnlocked(g[h]);i&&this.unlockModifier(g[h])}}}},a.prototype.unlockModifier=function(a){!this.modifiers[a.type]&&this.unlockedModifiers.indexOf(a)<=-1&&this.unlockedModifiers.push(a);var b=this.lockedModifiers.indexOf(a);b>-1&&this.lockedModifiers.splice(b,1)},a.prototype.updateDynamicModifiers=function(a){for(var b in this.dynamicModifiers[a]){var c=this.dynamicModifiers[a][b];c.call(null,this)}},a.prototype.addClicks=function(a){this.clicks+=a,this.checkLockedModifiers("clicks")},a.prototype.unlockLevelUpModifiers=function(a){var b=this;if(levelUpModifiers.modifiersByUnlock.level[a]){var c=levelUpModifiers.modifiersByUnlock.level[a].slice(0);if(!this.levelsAlreadyPicked[a]){c=c.filter(function(a){return b.levelUpModifiers[a.type]?!1:b.checkIfUnlocked(a)});var d=[];if(c.length<=this.levelUpModifiersPerLevelUp)for(var e in c)d.push(c[e]);else for(var f=0;f<this.levelUpModifiersPerLevelUp&&!(c.length<1);f++){var g=randInt(0,c.length-1),h=c.splice(g,1);d.push(h[0])}return d.length<1?(this.unlockedLevelUpModifiers[a]=null,void delete this.unlockedLevelUpModifiers[a]):void(this.unlockedLevelUpModifiers[a]=d)}}},a.prototype.addLevelUpModifier=function(a,b,c){"undefined"==typeof b&&(b=!0),"undefined"==typeof c&&(c=!0);var d=a.unlockConditions[0].value;return b&&this.levelsAlreadyPicked[d]?!1:(this.addModifier(a,"levelUpModifiers",c),void(b&&(this.unlockedLevelUpModifiers[d]=null,delete this.unlockedLevelUpModifiers[d],this.levelsAlreadyPicked[d]=!0)))},a.prototype.applyPermedModifiers=function(a){"undefined"==typeof a&&(a=!0);for(var b=0;b<this.permanentLevelupUpgrades.length;b++){var c=this.permanentLevelupUpgrades[b],d=levelUpModifiers[c];this.addLevelUpModifier(d,!1,a)}},a.prototype.getPrestige=function(a){return Math.pow(a/1e6,.7)},a.prototype.applyPrestige=function(){this.prestige=this.getPrestige(this.totalResetExperience),this.updateDynamicModifiers("prestige")},a.prototype.addToRollingIncome=function(a,b){b.day!==this.lastRollingIncomeDay&&(this.lastRollingIncomeDay=b.day,this.rollingIncome=this.rollingIncome.slice(1,3),this.rollingIncome.push(0)),this.rollingIncome[this.rollingIncome.length-1]+=a},a}(),actions;!function(a){function b(a){var b=window,c=b.game,d=c.getCell(a),e=c.players[a.playerId];if(!d||!e)throw new Error;var i=e.employees[a.employeeId],j=cloneObject(a);void 0===j.finishedOn&&(j.time=f([i.skills.negotiation],14).approximate);var k=e.getCellBuyCost(d);k=g([i.skills.negotiation],k).actual;var l=h.idGenerator++,m=function(){i.active=!1,i.currAction="buyCell",e.subtractCost(k),e.ownedCellsAmount++},n=function(){return i.active=!0,i.currAction=void 0,i.trainSkill("negotiation"),e.ownedCellsAmount--,e.addCell(d),h.removeCells(l),eventManager.dispatchEvent({type:"updateWorld",content:""}),!0},o=function(){h.addCells([d],null,l),h.start(),window.setTimeout(n,2400)};m.call(null),eventManager.dispatchEvent({type:"delayedAction",content:{type:"buyCell",data:j,onComplete:o}})}function c(a){var b=window,c=b.game,d=c.players[a.playerId];if(!d)throw new Error("No player with that id found");var g=d.employees[a.employeeId],h=cloneObject(a);void 0===h.finishedOn&&(h.time=f([g.skills.recruitment],14).approximate);var i=function(){g.active=!1,g.currentAction="recruit"},j=e([g.skills.recruitment],4,function(a){return 1/(1.5/Math.log(a+1))},.33);if(!g.player)throw new Error("No player on employee");var k=g.skills.recruitment*g.player.modifierEffects.recruitQuality,l=function(){g.active=!0,g.currentAction=void 0,g.trainSkill("recruitment");var a=makeNewEmployees(j.actual,k);eventManager.dispatchEvent({type:"makeRecruitCompleteNotification",content:{player:d,employees:a,text:[g.name+" was able to scout the following people.","Which one should we recruit?"],recruitingEmployee:g}})};i.call(null),eventManager.dispatchEvent({type:"delayedAction",content:{type:"recruitEmployee",data:h,onComplete:l}})}function d(a){var b=window,c=b.game,d=c.getCell(a),e=c.players[a.playerId];if(!d||!e)throw new Error;var i=e.employees[a.employeeId],j=findType(a.buildingType),k=cloneObject(a);void 0===k.finishedOn&&(k.time=f([i.skills.construction],j.buildTime).approximate);var l=e.getBuildCost(j),m=g([i.skills.construction],l).actual;if(!(e.money<m)){var n=j.size||[1,1],o=d.gridPos[0]+n[0]-1,p=d.gridPos[1]+n[1]-1,q=d.board.getCells(rectSelect(d.gridPos,[o,p])),r=h.idGenerator++,s=function(){for(var a=0;a<q.length;a++)q[a].changeContent(cg.content.underConstruction,!0);e.subtractCost(m),i.active=!1,i.currentAction="constructBuilding",e.amountBuiltPerType[j.type]++,eventManager.dispatchEvent({type:"updateWorld",content:""})},t=function(){return i.active=!0,i.currentAction=void 0,i.trainSkill("construction"),e.amountBuiltPerType[j.type]--,d.changeContent(j,!0,e),h.removeCells(r),eventManager.dispatchEvent({type:"updateWorld",content:""}),!0},u=function(){h.addCells(q,null,r),h.start(),window.setTimeout(t,2400)};s.call(null),eventManager.dispatchEvent({type:"delayedAction",content:{type:"constructBuilding",data:k,onComplete:u}})}}function e(a,b,c,d){var e=a.reduce(function(a,b){return a+b})/a.length,f=c?c(e):Math.pow(1-.166904*Math.log(e),.4),g=Math.round(b*f),h=Math.round(g+randRange(-b*d,b*d));return{approximate:g,actual:1>h?1:h}}function f(a,b){return e(a,b,null,.25)}function g(a,b){return e(a,b,null,0)}var h=new Blinker(600,8912981,-1,!1);a.buyCell=b,a.recruitEmployee=c,a.constructBuilding=d,a.getActionTime=f,a.getActionCost=g}(actions||(actions={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},SystemsManager=function(){function a(a){this.systems={},this.tickNumber=0,this.accumulated=0,this.paused=!1,this.speed=1,this.timer=new Strawb.Timer,this.tickTime=a/1e3,this.init()}return a.prototype.init=function(){this.addEventListeners()},a.prototype.addSystem=function(a,b){this.systems[a]=b},a.prototype.addEventListeners=function(){var a=this,b=document.getElementById("speed-control");eventManager.addEventListener("togglePause",function(){a.togglePause()}),eventManager.addEventListener("incrementSpeed",function(){a.setSpeed(a.speed+1)}),eventManager.addEventListener("decrementSpeed",function(){a.setSpeed(a.speed-1)}),b.addEventListener("change",function(){"0"===b.value?a.pause():a.setSpeed(parseInt(b.value))})},a.prototype.pause=function(){this.speedBeforePausing=this.speed,this.speed=0,this.timer.stop(),this.paused=!0;var a=document.getElementById("speed-control");a.value="0"},a.prototype.unPause=function(a){this.timer.start(),this.paused=!1,a&&this.setSpeed(a)},a.prototype.togglePause=function(){this.paused?this.unPause(this.speedBeforePausing):this.pause()},a.prototype.setSpeed=function(a){var b=document.getElementById("speed-control");if(0>=a)return void this.pause();if(!(a>parseInt(b.max))){this.paused&&this.unPause();var a=this.speed=Math.round(a),c=Math.pow(a,2);this.tickTime=1/c,this.accumulated=this.accumulated/c,b.value=""+a}},a.prototype.update=function(){if(!this.paused)for(this.accumulated+=this.timer.getDelta();this.accumulated>=this.tickTime;)this.tick()},a.prototype.tick=function(){this.accumulated-=this.tickTime,this.tickNumber++;for(var a in this.systems)this.systems[a].tick(this.tickNumber)},a}(),System=function(){function a(a,b){this.activationRate=a,this.updateTicks(b),1>a&&console.warn("<1 activationRate on system",this)}return a.prototype.activate=function(){},a.prototype.updateTicks=function(a){this.lastTick=a,this.nextTick=a+this.activationRate},a.prototype.tick=function(a){a>=this.nextTick&&(this.activate(a),this.updateTicks(a))},a}(),ProfitSystem=function(a){function b(b,c,d,e){a.call(this,b,c.tickNumber),this.systemsManager=c,this.players=d,this.targetTypes=e}return __extends(b,a),b.prototype.activate=function(){var a=this.systemsManager.systems.date.getDate();for(var b in this.players)for(var c=this.players[b],d=0;d<this.targetTypes.length;d++){var e=0,f=c.ownedContent[this.targetTypes[d]];if(!(f.length<1)){for(var g=0;g<f.length;g++){var h=f[g].modifiedProfit;isFinite(h)&&(e+=h)}c.addMoney(e,this.targetTypes[d],f.length,a)}}},b}(System),DateSystem=function(a){function b(b,c,d,e){a.call(this,b,c.tickNumber),this.year=e?e.year:2e3,this.month=e?e.month:1,this.day=e?e.day:1,this.dateElem=d,this.updateDate()}return __extends(b,a),b.prototype.activate=function(){this.incrementDate()},b.prototype.incrementDate=function(){this.day++,this.fireCallbacks(this.onDayChange,this.day),this.calculateDate()},b.prototype.calculateDate=function(){this.day>30&&(this.day-=30,this.month++,this.fireCallbacks(this.onMonthChange,this.month)),this.month>12&&(this.month-=12,this.year++,this.fireCallbacks(this.onYearChange,this.year)),this.day>30||this.month>12?this.calculateDate():this.updateDate()},b.prototype.fireCallbacks=function(a,b){if(a)for(var c=0;c<a.length;c++)a[c].call(b)},b.prototype.getDate=function(){var a={year:this.year,month:this.month,day:this.day};return a},b.prototype.setDate=function(a){this.year=a.year,this.month=a.month,this.day=a.day,this.updateDate()},b.prototype.toString=function(){return""+this.day+"."+this.month+"."+this.year},b.prototype.updateDate=function(){this.dateElem.innerHTML=this.toString()},b}(System),DelayedActionSystem=function(a){function b(b,c){a.call(this,b,c.tickNumber),this.callbacks={},this.systemsManager=c,this.addEventListeners()}return __extends(b,a),b.prototype.addEventListeners=function(){var a=this;eventManager.addEventListener("delayedAction",function(b){var c=b.content;c.data.finishedOn=c.data.finishedOn||a.lastTick+c.data.time,a.addAction(c)})},b.prototype.addAction=function(a){this.callbacks[a.data.finishedOn]||(this.callbacks[a.data.finishedOn]=[]),this.callbacks[a.data.finishedOn].push(a)},b.prototype.activate=function(a){if(this.callbacks[a]){for(var b=0;b<this.callbacks[a].length;b++)this.callbacks[a][b].onComplete.call();this.callbacks[a]=null,delete this.callbacks[a]}},b.prototype.reset=function(){this.callbacks={}},b}(System),AutosaveSystem=function(a){function b(b,c){a.call(this,b,c.tickNumber),this.systemsManager=c}return __extends(b,a),b.prototype.activate=function(){eventManager.dispatchEvent({type:"autosave",content:""})},b}(System),Loader=function(){function a(a){this.loaded={fonts:!0,sprites:!1,dom:!1};var b=this;this.game=a,document.addEventListener("DOMContentLoaded",function(){b.loaded.dom=!0,addClickAndTouchEventListener(document.getElementById("show-info"),function(){var a=document.getElementById("info-container").style;a.display="flex"===a.display?"none":"flex"}),addClickAndTouchEventListener(document.getElementById("close-info"),function(){document.getElementById("info-container").style.display="none"}),b.checkLoaded()}),this.startTime=window.performance?window.performance.now():Date.now(),this.loadFonts(),this.loadSprites()}return a.prototype.loadFonts=function(){return},a.prototype.loadSprites=function(){var a=this,b=new PIXI.JsonLoader("img/sprites.json");b.addEventListener("loaded",function(b){a.spriteImages=spritesheetToImages(b.content.json,b.content.baseUrl),a.loaded.sprites=!0,a.checkLoaded()}),b.load()},a.prototype.checkLoaded=function(){for(var a in this.loaded)if(!this.loaded[a])return;this.game.frameImages=this.spriteImages,this.game.init();var b=window.performance?window.performance.now():Date.now(),c=b-this.startTime;console.log("loaded in "+Math.round(c)+" ms")},a}(),__extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},SCREEN_WIDTH=720,SCREEN_HEIGHT=480,TILE_WIDTH=64,TILE_HEIGHT=32,SPRITE_HEIGHT=31,TILES=32,WORLD_WIDTH=TILES*TILE_WIDTH,WORLD_HEIGHT=TILES*TILE_HEIGHT,ZOOM_LEVELS=[1],AMT_OF_BOARDS=1,idGenerator=idGenerator||{};idGenerator.content=0,idGenerator.player=0;var Sprite=function(a){function b(b,c){var d=isFinite(c)?b.frame[c]:b.frame,e=PIXI.Texture.fromFrame(d);a.call(this,e),this.type=b.type,this.anchor=arrayToPoint(b.anchor),b.interactive===!0&&(this.interactive=!0,this.hitArea=arrayToPolygon(b.hitArea))}return __extends(b,a),b}(PIXI.Sprite),GroundSprite=function(a){function b(b,c){this.cell=c,a.call(this,b)}return __extends(b,a),b}(Sprite),ContentSprite=function(a){function b(b,c,d){this.content=c,a.call(this,b,d)}return __extends(b,a),b}(Sprite),Content=function(){function a(a){this.sprites=[],this.baseProfit=0,this.modifiers={},this.modifiedProfit=0,this.cells=a.cells;for(var b,c,d=0;d<this.cells.length;d++){var e=this.cells[d].gridPos;(void 0===c||e[1]<=c)&&(c=e[1],(void 0===b||e[0]<b)&&(b=e[0]))}this.baseCell=this.cells[0].board.getCell([b,c]),this.size=a.type.size||[1,1];var f=this.type=a.type;this.id=a.id||idGenerator.content++,this.baseType=f.baseType||void 0,this.categoryType=f.categoryType||void 0,this.flags=f.flags?f.flags.slice(0):[],this.flags.push(this.baseType,this.categoryType),this.baseProfit=f.baseProfit||void 0,a.player&&a.player.addContent(this),this.init(f,a.layer)}return a.prototype.init=function(a,b){"undefined"==typeof b&&(b="content");for(var c=0;c<this.cells.length;c++){var d=this.cells[c],e=new ContentSprite(a,this,c);this.sprites.push(e),e.position=d.board.getCell(d.gridPos).sprite.position.clone(),e.position.y-="water"===d.type.type?7:d.sprite.height-SPRITE_HEIGHT,d.board.addSpriteToLayer(b,e,d.gridPos)}},a.prototype.applyModifiers=function(){var a={addedProfit:this.baseProfit,multiplier:1};for(var b in this.modifiers){var c=this.modifiers[b];if(!isFinite(c.strength)||c.strength<=0)this.modifiers[b]=null,delete this.modifiers[b];else for(var d in c.effect)a[d]+=c.scaling(c.strength)*c.effect[d]}this.modifiedProfit=a.addedProfit*a.multiplier},a.prototype.remove=function(){this.player&&this.player.removeContent(this),this.type.effects&&this.baseCell.removeAllPropagatedModifiers(this.type.translatedEffects);for(var a=0;a<this.cells.length;a++)this.cells[a].content=void 0,this.cells[a].board.removeSpriteFromLayer("content",this.sprites[a],this.cells[a].gridPos)},a}(),Cell=function(){function a(a,b,c,d){"undefined"==typeof d&&(d=!0),this.modifiers={},this.landValueModifiers={},this.overlay=void 0,this.gridPos=a,this.type=b;var e=Math.abs((c.width-1)/2-a[0]),f=Math.abs((c.height-1)/2-a[1]),g=(f+e)/2,h=(c.width-1+c.height-1)/2,i=1-g/h,j=c.population/4;this.baseLandValue=this.landValue=Math.round(j+j*i*.5),this.board=c,this.flags=this.type.flags.slice(0),d&&this.init()}return a.prototype.init=function(){var a=this.sprite=new GroundSprite(this.type,this);a.position=arrayToPoint(getIsoCoord(this.gridPos[0],this.gridPos[1],TILE_WIDTH,TILE_HEIGHT,[WORLD_WIDTH/2,TILE_HEIGHT])),this.board.addSpriteToLayer("ground",a),this.type.effects&&this.propagateAllModifiers(this.type.translatedEffects)},a.prototype.getScreenPos=function(a){var b=a.worldTransform,c=b.a,d=[b.tx+WORLD_WIDTH/2*c,b.ty+TILE_HEIGHT/2*c];return getIsoCoord(this.gridPos[0],this.gridPos[1],TILE_WIDTH*c,TILE_HEIGHT*c,d)},a.prototype.getNeighbors=function(a){return"undefined"==typeof a&&(a=!1),a?(this.neighborsWithDiagonals||(this.neighborsWithDiagonals=getNeighbors(this.board.cells,this.gridPos,a)),this.neighborsWithDiagonals):(this.neighbors||(this.neighbors=getNeighbors(this.board.cells,this.gridPos,a)),this.neighbors)},a.prototype.getArea=function(a){var b=Object.create(a);return b.targetArray=this.board.cells,b.start=this.gridPos,getArea(b)},a.prototype.getDistances=function(a,b){"undefined"==typeof b&&(b=[1,1]);var c=[this.gridPos[0]+b[0]-1,this.gridPos[1]+b[1]-1],d=this.board.getCells(rectSelect(this.gridPos,c));return getDistanceFromCell(this.board.cells,d,a,!0)},a.prototype.replace=function(a){var b=this.type,c=a.frame;this.sprite.setTexture(PIXI.Texture.fromFrame(c)),this.sprite.type=this.type=a,this.flags=a.flags.slice(0),this.content&&"plant"===this.content.baseType?this.addPlant():this.content&&(this.checkBuildable(this.content.type,null,!1)?this.changeContent(this.content.type,!1,this.content.player):this.changeContent("none")),b.effects&&this.removeAllPropagatedModifiers(b.translatedEffects),a.effects&&this.propagateAllModifiers(a.translatedEffects)},a.prototype.changeUndergroundContent=function(a,b){"undefined"==typeof b&&(b=!0),this.undergroundContent&&(this.board.removeSpriteFromLayer("undergroundContent",this.undergroundContent.sprites[0],this.gridPos),this.undergroundContent=void 0),a&&(this.undergroundContent=new Content({cells:[this],type:a,layer:"undergroundContent"})),b&&getTubeConnections(this,1)},a.prototype.changeContent=function(a,b,c,d){"undefined"==typeof b&&(b=!0),"undefined"==typeof d&&(d=!0);var e,f=a.size&&(a.size[0]>1||a.size[1]>1);if(f){var g=this.gridPos[0]+a.size[0]-1,h=this.gridPos[1]+a.size[1]-1;e=this.board.getCells(rectSelect(this.gridPos,[g,h]))}else e=[this];var i=d?c:null,j=this.checkBuildable(a,i);f&&e.length!==a.size[0]*a.size[1]&&(j=!1);var k="none"!==a&&j!==!1,l="none"===a||k;if(l)for(var m=0;m<e.length;m++)e[m].removeContent();if(k&&this.addContent(a,e,c),b)for(var m=0;m<e.length;m++)e[m].updateCell()},a.prototype.checkBuildable=function(a,b,c){function d(a,b,d){var e=!0;if(d&&(!a.player||a.player.id!==d.id))return!1;if(b.canNotBuildOn&&(e=arrayLogic.not(a.flags,b.canNotBuildOn),c&&e!==!1&&a.content&&(e=arrayLogic.not(a.content.flags,b.canNotBuildOn))),e===!1)return!1;var f=!0;return b.canBuildOn&&(f=arrayLogic.or(a.flags,b.canBuildOn),c&&!f&&a.content&&(f=arrayLogic.or(a.content.flags,b.canBuildOn))),f}if("undefined"==typeof c&&(c=!0),"none"===a)return!0;var e;if(a.size&&(a.size[0]>1||a.size[1]>1)){var f=this.gridPos[0]+a.size[0]-1,g=this.gridPos[1]+a.size[1]-1;if(f>=this.board.width||g>=this.board.height)return!1;e=this.board.getCells(rectSelect(this.gridPos,[f,g]))}else e=[this];for(var h=!0,i=0;i<e.length;i++){var j=d(e[i],a,b);if(!j){h=!1;break}}return h},a.prototype.addPlant=function(){var a=this.type.type,b=cg.content.plants[a];this.changeContent(getRandomProperty(b))},a.prototype.updateCell=function(){getRoadConnections(this,1)},a.prototype.addContent=function(a,b,c){for(var d=new Content({cells:b,type:a,player:c}),e=0;e<b.length;e++)b[e].content=d,b[e].applyModifiersToContent();if(a.effects&&this.propagateAllModifiers(a.translatedEffects),a.underground)for(var e=0;e<b.length;e++)b[e].changeUndergroundContent(cg.content.tubes[a.underground]);return this.content},a.prototype.removeContent=function(){void 0!==this.content&&this.content.remove()},a.prototype.checkIfModifierApplies=function(a){return this.content&&(arrayLogic.or(a.targets,this.flags)||this.content&&arrayLogic.or(a.targets,this.content.flags))?!0:!1},a.prototype.getModifierPolarity=function(a){if(!this.content)return null;if(arrayLogic.or(a.targets,this.content.flags)){var b=a.effect[Object.keys(a.effect)[0]];return b>0}return null},a.prototype.addModifier=function(a,b){this.modifiers[a.type]?this.modifiers[a.type].strength+=a.strength:(this.modifiers[a.type]=Object.create(a),this.modifiers[a.type].sources=[]),this.modifiers[a.type].sources.push(b),this.checkIfModifierApplies&&this.applyModifiersToContent()},a.prototype.removeModifier=function(a,b){this.modifiers[a.type]&&(this.modifiers[a.type].strength-=a.strength,this.modifiers[a.type].sources=this.modifiers[a.type].sources.filter(function(a){return a!==b}),this.modifiers[a.type].strength<=0&&delete this.modifiers[a.type],this.checkIfModifierApplies&&this.applyModifiersToContent())},a.prototype.propagateModifier=function(a){var b=this.getArea({size:a.range,centerSize:a.center,excludeStart:!0});for(var c in b)b[c]!==this&&b[c].addModifier(a,this);a.landValue&&this.propagateLandValueModifier(a)},a.prototype.propagateAllModifiers=function(a){for(var b=0;b<a.length;b++)this.propagateModifier(a[b])},a.prototype.removePropagatedModifier=function(a){var b=this.getArea({size:a.range,centerSize:a.center,excludeStart:!0});for(var c in b)b[c].removeModifier(a,this);a.landValue&&this.removePropagatedLandValueModifier(a)},a.prototype.removeAllPropagatedModifiers=function(a){for(var b=0;b<a.length;b++)this.removePropagatedModifier(a[b])},a.prototype.getValidModifiers=function(a){if("undefined"==typeof a&&(a=this.content.type),a){var b=[a.baseType,a.categoryType],c={};for(var d in this.modifiers){var e=this.modifiers[d];(arrayLogic.or(e.targets,this.flags)||arrayLogic.or(e.targets,b))&&(c[d]=e)}return c}},a.prototype.applyModifiersToContent=function(){if(this.content){var a=this.getValidModifiers();this.content.modifiers=this.content.modifiers||{};for(var b in a){var c=a[b];(!this.content.modifiers[b]||this.content.modifiers[b].strength<c.strength)&&(this.content.modifiers[b]=c)}this.content.applyModifiers()}},a.prototype.propagateLandValueModifier=function(a){var b=this.getDistances(a.landValue.radius,a.center),c={};for(var d in b){var e,f=b[d].invertedDistance,g=b[d].distance;a.landValue.falloffFN?(c[g]||(c[g]=a.landValue.falloffFN(g,f,b[d].invertedDistanceRatio)),e=c[g]):e=f;var h=b[d].item;void 0===h.landValueModifiers[a.type]&&(h.landValueModifiers[a.type]={},h.landValueModifiers[a.type].strength=0,a.landValue.scalingFN&&(h.landValueModifiers[a.type].scalingFN=a.landValue.scalingFN),h.landValueModifiers[a.type].effect={},a.landValue.multiplier&&(h.landValueModifiers[a.type].effect.multiplier=a.landValue.multiplier),a.landValue.addedValue&&(h.landValueModifiers[a.type].effect.addedValue=a.landValue.addedValue)),h.landValueModifiers[a.type].strength+=e,h.updateLandValue()}game.activeBoard&&game.activeBoard.id===this.board.id&&eventManager.dispatchEvent({type:"updateLandValueMapmode",content:""})},a.prototype.removePropagatedLandValueModifier=function(a){var b=this.getDistances(a.landValue.radius,a.center),c={};for(var d in b){var e=b[d].item;if(e.landValueModifiers[a.type]){var f,g=b[d].invertedDistance,h=b[d].distance;a.landValue.falloffFN?(c[g]||(c[g]=a.landValue.falloffFN(h,g,b[d].invertedDistanceRatio)),f=c[g]):f=g,e.landValueModifiers[a.type].strength-=f,e.landValueModifiers[a.type].strength<=0&&delete e.landValueModifiers[a.type],e.updateLandValue()}}game.activeBoard&&game.activeBoard.id===this.board.id&&eventManager.dispatchEvent({type:"updateLandValueMapmode",content:""})},a.prototype.updateLandValue=function(){if("water"===this.type.type)return void(this.landValue=0);var a={addedValue:0,multiplier:1};for(var b in this.landValueModifiers){var c,d=this.landValueModifiers[b];c=d.scalingFN?d.scalingFN(d.strength):d.strength;for(var e in d.effect)a[e]+=d.effect[e]*c}this.landValue=Math.round((this.baseLandValue+a.addedValue)*a.multiplier),this.landValue<.8*this.baseLandValue&&(this.landValue=Math.round(.8*this.baseLandValue))},a.prototype.addOverlay=function(a,b){"undefined"==typeof b&&(b=1),this.overlay&&this.board.removeSpriteFromLayer("cellOverlay",this.overlay,this.gridPos);var c=this.getNeighbors(),d=(this.type.hitArea,{n:!0,e:!0,s:!0,w:!0});for(var e in c){var f=c[e];void 0!==f&&f.overlay&&f.overlayColor===a&&(d[e]=!1)}var g=this.type.hitArea;g.push(g[0]);var h=new PIXI.Graphics;h.lineStyle(3,a,.6),h.moveTo(g[0][0],g[0][1]);var i=1;for(var e in d){var j=g[i];d[e]===!0?h.lineTo(j[0],j[1]):h.moveTo(j[0],j[1]),i++}h.position=this.sprite.position.clone(),h.position.y-=this.sprite.height-SPRITE_HEIGHT,this.board.addSpriteToLayer("cellOverlay",h,this.gridPos),this.overlay=h,this.overlayColor=a;var k=!1;if(b>0)for(var e in d)d[e]===!1&&(k=!0,c[e].addOverlay(a,b-1));k===!1&&game.updateWorld()},a.prototype.removeOverlay=function(){this.board.removeSpriteFromLayer("cellOverlay",this.overlay,this.gridPos),this.overlay=null,this.overlayColor=null;var a=this.getNeighbors();for(var b in a)a[b]&&a[b].overlay&&a[b].addOverlay(a[b].overlayColor)},a}(),WorldRenderer=function(){function a(a,b){this.layers={},this.zoomLevel=ZOOM_LEVELS[0],this.mapmodes={"default":{layers:[{type:"ground"},{type:"cellOverlay"},{type:"content"}]},landValue:{layers:[{type:"ground"},{type:"landValueOverlay",alpha:.7},{type:"cellOverlay"},{type:"content"}]},underground:{layers:[{type:"underground"},{type:"undergroundContent"},{type:"ground",alpha:.15}],properties:{offsetY:32}}},this.currentMapmode="default",this.initContainers(a,b),this.initLayers(),this.addEventListeners()
}return a.prototype.addEventListeners=function(){var a=this;eventManager.addEventListener("changeZoomLevel",function(b){a.changeZoomLevel(b.content.zoomLevel)}),eventManager.addEventListener("updateWorld",function(b){a.render(b.content.clear)});var b=document.getElementById("mapmode-select");b.addEventListener("change",function(){a.setMapmode(b.value)}),eventManager.addEventListener("changeMapmode",function(c){a.setMapmode(c.content),b.value=c.content}),eventManager.addEventListener("updateLandValueMapmode",function(){if("landValue"===a.currentMapmode){var b=a.layers["zoom"+a.zoomLevel];b.landValueOverlay=makeLandValueOverlay(game.activeBoard),a.changeMapmode("landValue")}})},a.prototype.initContainers=function(a,b){this.renderTexture=new PIXI.RenderTexture(a,b,game.renderer,PIXI.scaleModes.NEAREST);var c=this.worldSprite=new PIXI.Sprite(this.renderTexture);c.hitArea=arrayToPolygon(rectToIso(c.width,c.height)),c.interactive=!0;for(var d=0;d<ZOOM_LEVELS.length;d++){var e="zoom"+ZOOM_LEVELS[d],f=this.layers[e]={};this.mapmodes[e]={};{f.main=new PIXI.DisplayObjectContainer}}c.mousedown=c.touchstart=function(a){game.mouseEventHandler.mouseDown(a,"world")},c.mousemove=c.touchmove=function(a){game.mouseEventHandler.mouseMove(a,"world")},c.mouseup=c.touchend=function(a){game.mouseEventHandler.mouseUp(a,"world")},c.mouseupoutside=c.touchendoutside=function(a){game.mouseEventHandler.mouseUp(a,"world")}},a.prototype.initLayers=function(){for(var a=0;a<ZOOM_LEVELS.length;a++){{var b="zoom"+ZOOM_LEVELS[a],c=this.layers[b];c.main}c.underground=new PIXI.DisplayObjectContainer,c.undergroundContent=new PIXI.DisplayObjectContainer,c.ground=new PIXI.DisplayObjectContainer,c.landValueOverlay=new PIXI.DisplayObjectContainer,c.cellOverlay=new PIXI.DisplayObjectContainer,c.content=new PIXI.DisplayObjectContainer}},a.prototype.clearLayers=function(){for(var a=0;a<ZOOM_LEVELS.length;a++){var b="zoom"+ZOOM_LEVELS[a],c=this.layers[b],d=c.main;for(var e in c)c[e].children.length>0&&c[e].removeChildren();d.children.length>0&&d.removeChildren()}},a.prototype.setBoard=function(a){this.clearLayers();for(var b in a.layers)for(var c in a.layers[b])this.layers[b][c].addChild(a.layers[b][c]);this.setMapmode(this.currentMapmode)},a.prototype.changeZoomLevel=function(a){this.zoomLevel=a,this.render()},a.prototype.setMapmode=function(a){var b=this.layers["zoom"+this.zoomLevel];switch(a){case"default":case"terrain":return void this.changeMapmode("default");case"landValue":return b.landValueOverlay=makeLandValueOverlay(game.activeBoard),void this.changeMapmode("landValue");case"underground":if(b.underground.children<=0)for(var c=0;c<b.ground.children[0].children.length;c++){var d=b.ground.children[0].children[c],e=PIXI.Sprite.fromFrame("underground.png");e.position=d.position.clone(),e.anchor=d.anchor.clone(),b.underground.addChild(e)}return void this.changeMapmode("underground")}},a.prototype.changeMapmode=function(a){var b="zoom"+this.zoomLevel,c=this.layers[b];c.main.children.length>0&&c.main.removeChildren();for(var d=0;d<this.mapmodes[a].layers.length;d++){var e=this.mapmodes[a].layers[d];c.main.addChild(c[e.type]),c[e.type].alpha=e.alpha||1}var f=this.mapmodes[a].properties||{};this.worldSprite.y=f.offsetY||0,this.currentMapmode=a,this.render()},a.prototype.render=function(a){"undefined"==typeof a&&(a=!0);var b="zoom"+this.zoomLevel,c=this.layers[b].main;this.renderTexture.render(c,null,a)},a}(),Game=function(){function a(){this.boards=[],this.tools={},this.layers={},this.players={},this.toolCache={},this.editModes=[]}return a.prototype.init=function(){this.resize(),this.initContainers(),this.initTools(),this.bindElements(),this.loadOptions();for(var a=0;AMT_OF_BOARDS>a;a++)this.boards.push(new Board({width:TILES}));this.changeActiveBoard(0),this.updateBoardSelect(),this.highlighter=new Highlighter,this.mouseEventHandler=new MouseEventHandler,this.mouseEventHandler.scroller=new Scroller(this.layers.main,.5),this.keyboardEventHandler=new KeyboardEventHandler,this.uiDrawer=new UIDrawer,this.systemsManager=new SystemsManager(1e3);var b="player"+idGenerator.player++,c=new Player(b);this.reactUI=new ReactUI(c,this.frameImages),this.players[c.id]=c;var d=new ProfitSystem(1,this.systemsManager,this.players,["fastfood","shopping","parking","factory","hotel","apartment","office"]);this.systemsManager.addSystem("dailyProfitSystem",d),this.systemsManager.addSystem("delayedAction",new DelayedActionSystem(1,this.systemsManager)),this.systemsManager.addSystem("autosave",new AutosaveSystem(60,this.systemsManager));var e=new DateSystem(1,this.systemsManager,document.getElementById("date"));this.systemsManager.addSystem("date",e),this.editModes=["play","edit-world"],this.switchEditingMode("play"),eventManager.dispatchEvent({type:"changeMapmode",content:"landValue"}),this.resize(),this.render(),this.updateWorld(),window.setInterval(this.updateSystems.bind(this),1e3)},a.prototype.initContainers=function(){var a=this.stage=new PIXI.Stage(16777215),b=(this.renderer=PIXI.autoDetectRenderer(SCREEN_WIDTH,SCREEN_HEIGHT,null,!1,!0),this.layers.main=new PIXI.DisplayObjectContainer);b.position.set(SCREEN_WIDTH/2-WORLD_WIDTH/2,SCREEN_HEIGHT/2-WORLD_HEIGHT/2),a.addChild(b);var c=this.layers.tooltips=new PIXI.DisplayObjectContainer;a.addChild(c),this.worldRenderer=new WorldRenderer(WORLD_WIDTH,WORLD_HEIGHT),b.addChild(this.worldRenderer.worldSprite);var d=this;a.mousedown=a.touchstart=function(a){d.mouseEventHandler.mouseDown(a,"stage")},a.mousemove=a.touchmove=function(a){d.mouseEventHandler.mouseMove(a,"stage")},a.mouseup=a.touchend=function(a){d.mouseEventHandler.mouseUp(a,"stage")},a.mouseupoutside=a.touchendoutside=function(a){game.mouseEventHandler.mouseUp(a,"stage")}},a.prototype.initTools=function(){this.tools.nothing=new NothingTool,this.tools.water=new WaterTool,this.tools.grass=new GrassTool,this.tools.sand=new SandTool,this.tools.snow=new SnowTool,this.tools.remove=new RemoveTool,this.tools.plant=new PlantTool,this.tools.house=new HouseTool,this.tools.road=new RoadTool,this.tools.subway=new SubwayTool,this.tools.click=new ClickTool,this.tools.buy=new BuyTool,this.tools.build=new BuildTool,this.tools.sell=new SellTool},a.prototype.bindElements=function(){var a=this,b=document.getElementById("zoomBtn");addClickAndTouchEventListener(b,function(){var a=document.getElementById("zoom-amount").value;game.mouseEventHandler.scroller.zoom(a)});for(var c in this.tools){var d=document.getElementById(""+c+"Btn");!function(b,c){var d=a.tools[c],e=d.type;return null===d.button?void(b&&(d.button=b)):(d.button=b,void addClickAndTouchEventListener(b,function(){a.changeTool([e])}))}(d,c)}var e=document.getElementById("saveBtn"),f=document.getElementById("loadBtn"),g=function(){eventManager.dispatchEvent({type:"makeSavePopup",content:""})},h=function(){eventManager.dispatchEvent({type:"makeLoadPopup",content:""})};addClickAndTouchEventListener(e,g),addClickAndTouchEventListener(f,h),eventManager.addEventListener("saveGame",function(b){a.save(b.content)}),eventManager.addEventListener("loadGame",function(b){a.load(b.content)});var i=document.getElementById("recruitBtn"),j=function(){Object.keys(a.players.player0.employees).length<1?(a.players.player0.usedInitialRecruit=!0,eventManager.dispatchEvent({type:"makeRecruitCompletePopup",content:{player:a.players.player0,employees:makeNewEmployees(randInt(4,6),2*a.players.player0.modifierEffects.recruitQuality),delay:0}}),window.setTimeout(function(){a.players.player0.usedInitialRecruit=!1},5e3)):eventManager.dispatchEvent({type:"makeRecruitPopup",content:{player:a.players.player0}})};addClickAndTouchEventListener(i,j),eventManager.addEventListener("recruit",j);var k=document.getElementById("buildBtn"),l=function(b,c){a.tools.build.changeBuilding(b,c),a.changeTool("build")};addClickAndTouchEventListener(k,function(){eventManager.dispatchEvent({type:"makeBuildingSelectPopup",content:{player:a.players.player0,onOk:l}})}),eventManager.addEventListener("changeBuildingType",function(a){l(a.content.building,a.content.continuous)}),eventManager.addEventListener("changeTool",function(b){a.changeTool(b.content.type),a.tools[b.content.type].continuous=b.content.continuous===!1?!1:!0}),this.bindRenderer(),window.addEventListener("resize",game.resize,!1),eventManager.addEventListener("autosave",function(){a.autosave()});var m=document.getElementById("editmode-select");m.addEventListener("change",function(){a.switchEditingMode(m.value)}),addClickAndTouchEventListener(document.getElementById("regen-world"),function(){var b=game.worldRenderer.currentMapmode;a.resetLayers(),a.activeBoard.destroy(),a.boards[a.indexOfActiveBoard]=new Board({width:TILES}),a.changeActiveBoard(a.indexOfActiveBoard),eventManager.dispatchEvent({type:"changeMapmode",content:b}),eventManager.dispatchEvent({type:"updateWorld",content:""}),a.updateBoardSelect()});var n=document.getElementById("board-select");n.addEventListener("change",function(){a.changeActiveBoard(parseInt(n.value))}),eventManager.addEventListener("changeZoom",function(b){a.mouseEventHandler.scroller.zoom(b.content)}),eventManager.addEventListener("prestigeReset",function(b){a.prestigeReset(b.content)}),addClickAndTouchEventListener(document.getElementById("show-stats"),function(){eventManager.dispatchEvent({type:"toggleFullScreenPopup",content:"stats"})}),addClickAndTouchEventListener(document.getElementById("show-changelog"),function(){eventManager.dispatchEvent({type:"toggleFullScreenPopup",content:"changelog"})}),addClickAndTouchEventListener(document.getElementById("show-options"),function(){eventManager.dispatchEvent({type:"toggleFullScreenPopup",content:"options"})}),eventManager.addEventListener("saveOptions",a.saveOptions)},a.prototype.bindRenderer=function(){var a=document.getElementById("pixi-container");a.appendChild(this.renderer.view),this.renderer.view.setAttribute("id","pixi-canvas")},a.prototype.updateBoardSelect=function(){for(var a=document.getElementById("board-select"),b=a.value||"0";a.children.length>0;)a.remove(0);for(var c=0;c<this.boards.length;c++){var d=document.createElement("option");d.value=""+c,d.text=this.boards[c].name,a.add(d)}a.value=b},a.prototype.updateWorld=function(a){eventManager.dispatchEvent({type:"updateWorld",content:{clear:a}})},a.prototype.resize=function(){var a=window.getComputedStyle(document.getElementById("pixi-container"),null);SCREEN_WIDTH=parseInt(a.width),SCREEN_HEIGHT=parseInt(a.height),game.renderer&&game.renderer.resize(SCREEN_WIDTH,SCREEN_HEIGHT),window.innerWidth<=600?eventManager.dispatchEvent({type:"resizeSmaller",content:""}):window.innerWidth>600&&eventManager.dispatchEvent({type:"resizeBigger",content:""})},a.prototype.changeTool=function(a){var b=this.activeTool;this.activeTool=this.tools[a],b&&b.button&&b.button.classList.toggle("selected-tool"),this.activeTool.button&&this.activeTool.button.classList.toggle("selected-tool"),this.activeTool.onChange&&this.activeTool.onChange(),this.activeTool.mapmode&&eventManager.dispatchEvent({type:"changeMapmode",content:this.activeTool.mapmode})},a.prototype.changeActiveBoard=function(a){this.activeBoard;this.activeBoard=this.boards[a],this.indexOfActiveBoard=a,this.worldRenderer.setBoard(this.activeBoard)},a.prototype.destroyAllBoards=function(){for(var a=0;a<this.boards.length;a++)this.boards[a].destroy()},a.prototype.getCell=function(a){for(var b=void 0,c=0;c<this.boards.length;c++)if(this.boards[c].id==a.boardId){b=c;break}if(void 0===b)throw new Error("No board found with id"+a.boardId);return this.boards[b].getCell(a.gridPos)},a.prototype.save=function(a){var b={player:this.savePlayer(this.players.player0),boards:this.saveBoards(this.boards),date:new Date,gameDate:this.systemsManager.systems.date.getDate(),gameTick:this.systemsManager.tickNumber,pendingActions:this.saveActions(this.systemsManager.systems.delayedAction)};localStorage.setItem(a,JSON.stringify(b))},a.prototype.autosave=function(){var a=Options.autosaveLimit,b=[];for(var c in localStorage)c.match(/autosave/)&&b.push(c);b.sort(),b=b.slice(0,a-1);for(var d=b.length-1;d>=0;d--)localStorage.setItem("autosave"+(d+2),localStorage.getItem(b[d]));this.save("autosave")},a.prototype.load=function(a){var b=JSON.parse(localStorage.getItem(a));this.activeBoard=null,this.loadPlayer(b.player),this.loadBoards(b),this.loadActions(b.pendingActions),b.gameTick&&(this.systemsManager.tickNumber=b.gameTick),eventManager.dispatchEvent({type:"clearReact",content:""}),b.gameDate&&this.systemsManager.systems.date.setDate(b.gameDate)},a.prototype.saveBoards=function(a){for(var b=[],c=0;c<a.length;c++){var d={},e=a[c];d.width=e.width,d.height=e.height,d.population=e.population,d.name=e.name,d.cells=[],d.id=e.id;for(var f={},g=0,h=0;h<e.cells.length;h++){d.cells[h]=[];for(var i=0;i<e.cells[h].length;i++){var j=e.cells[h][i],k=d.cells[h][i]={};if(f[j.type.type]||(f[j.type.type]=++g),k.type=f[j.type.type],j.player&&(k.player=j.player.id),j.content&&j.content.baseCell===j){var l=j.content.type.type;"road"===j.content.type.baseType&&(l="road_nesw"),f[l]||(f[l]=++g),k.content={type:f[l],player:j.content.player?j.content.player.id:null}}j.undergroundContent&&(k.undergroundContent=!0)}}d.key=function(){for(var a={},b=0;b<Object.keys(f).length;b++){var c=Object.keys(f)[b];a[f[c]]=c}return a}()}return b.push(d),b},a.prototype.loadBoards=function(a){this.resetLayers(),this.destroyAllBoards();var b=[],c=[],d=a.cachedBoardIndex||0;if(a.board?b.push(a.board):b=a.boards,0===b.length)throw new Error("No boards to load");for(var e=0;e<b.length;e++){var f=b[e],g=f.key;if(g)for(var h=0;h<f.cells.length;h++)for(var i=0;i<f.cells[h].length;i++){var j=f.cells[h][i];j.type=g[j.type],j.content&&(j.content.type=g[j.content.type]),j.player&&(j.player=this.players[j.player],j.content&&(j.content.player=this.players[j.content.player]))}else for(var h=0;h<f.cells.length;h++)for(var i=0;i<f.cells[h].length;i++){var j=f.cells[h][i];j.player&&(j.player=this.players[j.player],j.content&&(j.content.player=this.players[j.content.player]))}var k=new Board({width:f.width,height:f.height,savedCells:f.cells,population:f.population});k.name=f.name||k.name,k.id=f.id||k.id,c.push(k)}game.boards=c,game.changeActiveBoard(d),eventManager.dispatchEvent({type:"updateWorld",content:{clear:!0}}),this.updateBoardSelect()},a.prototype.savePlayer=function(a){var b={};b.id=a.id,b.money=a.money,b.clicks=a.clicks,b.experience=a.experience,b.employees={};for(var c in a.employees){b.employees[c]={};for(var d in a.employees[c])"trait"===d?a.employees[c].trait&&(b.employees[c].trait=a.employees[c].trait.type):"player"!==d&&(b.employees[c][d]=a.employees[c][d])}b.modifiers=[];for(var e in a.modifiers)b.modifiers.push(a.modifiers[e].type);b.levelUpModifiers=[];for(var e in a.levelUpModifiers)b.levelUpModifiers.push(a.levelUpModifiers[e].type);return b.levelsAlreadyPicked=a.levelsAlreadyPicked,b.prestige={prestige:a.prestige,timesReset:a.timesReset,permanentLevelupUpgrades:a.permanentLevelupUpgrades,totalResetExperience:a.totalResetExperience},b.stats={incomePerType:a.incomePerType},b},a.prototype.loadPlayer=function(a){var b=new Player(a.id);b.money=a.money,b.experience=a.experience||0,b.clicks=a.clicks||0,a.stats&&(b.incomePerDate=a.stats.incomePerDate||{},b.incomePerType=a.stats.incomePerType||{});for(var c in a.modifiers)b.addModifier(playerModifiers[a.modifiers[c]],"modifiers",!1);for(var c in a.levelUpModifiers)b.addLevelUpModifier(levelUpModifiers[a.levelUpModifiers[c]],!1,!1);b.levelsAlreadyPicked=a.levelsAlreadyPicked||{};for(var d in a.employees)a.employees[d]=new Employee(names,a.employees[d]),b.addEmployee(a.employees[d]);if(a.prestige)for(var e in a.prestige)b[e]=a.prestige[e];b.setInitialAvailableModifiers(),b.applyPermedModifiers(),b.applyPrestige(),this.players.player0=b,this.reactUI.player=b,b.addExperience(0),b.updateElements()},a.prototype.saveOptions=function(){localStorage.setItem("options",JSON.stringify(Options))},a.prototype.loadOptions=function(){var a=JSON.parse(localStorage.getItem("options"));for(var b in a)Options[b]=a[b]},a.prototype.saveActions=function(a){var b=[];for(var c in a.callbacks)for(var d=a.callbacks[c],e=0;e<d.length;e++)b.push({type:d[e].type,data:d[e].data});return b},a.prototype.loadActions=function(a){if(game.systemsManager.systems.delayedAction.reset(),a&&!(a.length<1))for(var b=0;b<a.length;b++){var c=a[b];actions[c.type].call(null,c.data)}},a.prototype.prestigeReset=function(a){var b=this.players.player0;if(!(b.level<100)){var c=function(c){var d=new Player(b.id);d.incomePerDate=Object.create(b.incomePerDate),d.incomePerType=Object.create(b.incomePerType),d.timesReset=b.timesReset+1,d.totalResetExperience=b.totalResetExperience+b.experience,d.permanentLevelupUpgrades=b.permanentLevelupUpgrades.slice(0),c&&d.permanentLevelupUpgrades.push(c.data.modifier.type),d.applyPermedModifiers(),d.applyPrestige(),d.setInitialAvailableModifiers(),this.players[b.id]=d,this.reactUI.player=d,d.addExperience(0),d.updateElements(),this.resetLayers(),this.destroyAllBoards();var e=[new Board({width:TILES})];return this.boards=e,this.changeActiveBoard(0),eventManager.dispatchEvent({type:"updateWorld",content:{clear:!0}}),eventManager.dispatchEvent({type:"clearReact",content:""}),this.updateBoardSelect(),a&&a.call(),!0}.bind(this),d=[];for(var e in b.levelUpModifiers){var f=b.levelUpModifiers[e];b.permanentLevelupUpgrades.indexOf(f.type)<0&&d.push(f)}var g=b.getPrestige(b.totalResetExperience),h=b.getPrestige(b.experience+b.totalResetExperience),i=h-g;eventManager.dispatchEvent({type:"makeModifierPopup",content:{player:b,text:["Congratulations on reaching level 100!","You can start over from scratch in a new city","","You would gain an additional "+i.toFixed(1)+" prestige","for a total of "+h.toFixed(1)+" prestige","You can also permanently unlock one of the following upgrades:"],modifierList:d,onOk:c,okBtnText:"Reset",excludeCost:!0}})}},a.prototype.render=function(){this.renderer.render(this.stage),TWEEN.update(),requestAnimFrame(this.render.bind(this))},a.prototype.updateSystems=function(){this.systemsManager.update()},a.prototype.resetLayers=function(){this.worldRenderer.clearLayers(),this.worldRenderer.initLayers(),this.worldRenderer.render()},a.prototype.switchEditingMode=function(a){if(a!==this.currentMode){this.toolCache[this.currentMode]=this.activeTool?this.activeTool.type:"nothing",this.changeTool(this.toolCache[a]?this.toolCache[a]:"nothing");for(var b=0;b<this.editModes.length;b++){var c=this.editModes[b];if(a!==c)for(var d=document.getElementsByClassName(c),e=0;e<d.length;e++)d[e].classList.add("hidden");else for(var d=document.getElementsByClassName(c),e=0;e<d.length;e++)d[e].classList.remove("hidden")}this.currentMode=a;var f=document.getElementById("editmode-select");f.value=a}},a}(),Scroller=function(){function a(a,b){this.bounds={},this.currZoom=1,this.container=a,this.bounds.min=b,this.bounds.max=Number((1-b).toFixed(1)),this.setBounds(),this.zoomField=document.getElementById("zoom-amount")}return a.prototype.startScroll=function(a){this.setBounds(),this.startClick=a,this.startPos=[this.container.position.x,this.container.position.y]},a.prototype.end=function(){this.startPos=void 0},a.prototype.setBounds=function(){var a=this.container.getLocalBounds();this.width=SCREEN_WIDTH,this.height=SCREEN_HEIGHT,this.bounds={xMin:this.width*this.bounds.min-a.width*this.container.scale.x,xMax:this.width*this.bounds.max,yMin:this.height*this.bounds.min-a.height*this.container.scale.y,yMax:this.height*this.bounds.max,min:this.bounds.min,max:this.bounds.max}},a.prototype.getDelta=function(a){var b=this.startClick[0]-a[0],c=this.startClick[1]-a[1];return[-b,-c]},a.prototype.move=function(a){var b=this.getDelta(a);this.container.position.x=this.startPos[0]+b[0],this.container.position.y=this.startPos[1]+b[1],this.clampEdges()},a.prototype.zoom=function(a){var b=this.container,c=this.currZoom,d=c-a,e=b.getLocalBounds(),f=1-((b.x-SCREEN_WIDTH/2)/e.width/c+1),g=1-((b.y-SCREEN_HEIGHT/2)/e.height/c+1),h=e.width*f*d,i=e.height*g*d;b.position.x+=h,b.position.y+=i,b.scale.set(a,a),this.zoomField.value=this.currZoom=a,eventManager.dispatchEvent({type:"updateZoomValue",content:this.currZoom})},a.prototype.deltaZoom=function(a,b){if(0!==a){var c=0>a?"out":"in",d=1+Math.abs(a)*b;this.zoom("out"===c?this.currZoom/d:this.currZoom*d)}},a.prototype.clampEdges=function(){var a=this.container.position.x,b=this.container.position.y;a<this.bounds.xMin?a=this.bounds.xMin:a>this.bounds.xMax&&(a=this.bounds.xMax),b<this.bounds.yMin?b=this.bounds.yMin:b>this.bounds.yMax&&(b=this.bounds.yMax),this.container.position.set(a,b)},a}(),MouseEventHandler=function(){function a(){this.preventingGhost=!1;var a=this;this.currAction=void 0,window.oncontextmenu=function(a){var b=a.target;"canvas"===b.localName&&(a.preventDefault(),a.stopPropagation())};var b=document.getElementById("pixi-container");b.addEventListener("DOMMouseScroll",function(b){"canvas"===b.target.localName&&(a.scroller.deltaZoom(-b.detail,.05),game.uiDrawer.clearAllObjects())}),b.addEventListener("mousewheel",function(b){"canvas"===b.target.localName&&(a.scroller.deltaZoom(b.wheelDelta/40,.05),game.uiDrawer.clearAllObjects())}),b.addEventListener("mouseout",function(a){"canvas"===a.target.localName&&game.uiDrawer.removeActive()})}return a.prototype.preventGhost=function(a){this.preventingGhost=!0;var b=this,c=window.setTimeout(function(){b.preventingGhost=!1,window.clearTimeout(c)},a)},a.prototype.mouseDown=function(a,b){game.uiDrawer.removeActive(),2===a.originalEvent.button&&void 0!==this.currAction&&"stage"===b?(game.activeTool.onFinish&&game.activeTool.onFinish(),this.currAction=void 0,this.stashedAction=void 0,this.startPoint=void 0,this.scroller.end(),game.uiDrawer.clearAllObjects(),game.highlighter.clearSprites(),game.updateWorld()):a.originalEvent.ctrlKey||a.originalEvent.metaKey||1===a.originalEvent.button||2===a.originalEvent.button?this.startScroll(a):"world"===b&&this.startCellAction(a)},a.prototype.mouseMove=function(a,b){"stage"!==b||"zoom"!==this.currAction&&"scroll"!==this.currAction?"world"===b&&"cellAction"===this.currAction?this.worldMove(a):"world"===b&&void 0===this.currAction&&this.hover(a):this.stageMove(a)},a.prototype.mouseUp=function(a,b){void 0!==this.currAction&&("stage"!==b||"zoom"!==this.currAction&&"scroll"!==this.currAction?"world"===b&&"cellAction"===this.currAction&&2!==a.originalEvent.button&&3!==a.originalEvent.button&&(this.preventingGhost||this.worldEnd(a)):(this.stageEnd(a),this.preventGhost(15)))},a.prototype.startScroll=function(a){"cellAction"===this.currAction&&(this.stashedAction="cellAction"),this.currAction="scroll",this.startPoint=[a.global.x,a.global.y],this.scroller.startScroll(this.startPoint),game.uiDrawer.clearAllObjects()},a.prototype.startZoom=function(a){"cellAction"===this.currAction&&(this.stashedAction="cellAction"),this.currAction="zoom",this.startPoint=this.currPoint=[a.global.x,a.global.y],game.uiDrawer.clearAllObjects()},a.prototype.stageMove=function(a){if("scroll"===this.currAction)this.scroller.move([a.global.x,a.global.y]);else if("zoom"===this.currAction){var b=a.global.x+this.currPoint[1]-this.currPoint[0]-a.global.y;this.scroller.deltaZoom(b,.005),this.currPoint=[a.global.x,a.global.y]}},a.prototype.stageEnd=function(){"scroll"===this.currAction&&(this.scroller.end(),this.startPoint=void 0,this.currAction=this.stashedAction,this.stashedAction=void 0),"zoom"===this.currAction&&(this.startPoint=void 0,this.currAction=this.stashedAction,this.stashedAction=void 0)},a.prototype.startCellAction=function(a){var b=a.getLocalPosition(a.target),c=getOrthoCoord([b.x,b.y+7],[TILE_WIDTH,TILE_HEIGHT],[TILES,TILES]);game.activeTool.tempContinuous=a.originalEvent.shiftKey?!0:!1,this.currAction="cellAction",this.startCell=c,this.currCell=c,this.selectedCells=game.activeBoard.getCells(game.activeTool.selectType(this.startCell,this.currCell)),game.highlighter.clearSprites(),null!==game.activeTool.tintColor&&game.highlighter.tintCells(this.selectedCells,game.activeTool.tintColor),game.activeTool.onHover&&(game.uiDrawer.clearAllObjects(),game.activeTool.onHover(this.selectedCells)),game.updateWorld()},a.prototype.worldMove=function(a){var b=a.getLocalPosition(a.target),c=getOrthoCoord([b.x,b.y+7],[TILE_WIDTH,TILE_HEIGHT],[TILES,TILES]);this.currCell&&c[0]===this.currCell[0]&&c[1]===this.currCell[1]||(this.currCell=c,this.selectedCells=game.activeBoard.getCells(game.activeTool.selectType(this.startCell,this.currCell)),game.highlighter.clearSprites(),game.activeTool.onHover&&(game.uiDrawer.clearAllObjects(),game.activeTool.onHover(this.selectedCells)),null!==game.activeTool.tintColor&&game.highlighter.tintCells(this.selectedCells,game.activeTool.tintColor),game.updateWorld())},a.prototype.worldEnd=function(){game.activeTool.activate(this.selectedCells),game.activeTool.onFinish&&game.activeTool.onFinish(),game.uiDrawer.clearAllObjects(),game.highlighter.clearSprites(),this.currAction=void 0,this.startCell=void 0,this.currCell=void 0,this.selectedCells=void 0,game.updateWorld(!0)},a.prototype.hover=function(a){var b=a.getLocalPosition(a.target),c=getOrthoCoord([b.x,b.y+7],[TILE_WIDTH,TILE_HEIGHT],[TILES,TILES]),d=game.activeBoard.getCell(c);return!c||c[0]>=TILES||c[1]>=TILES||c[0]<0||c[1]<0?void game.uiDrawer.removeActive():(this.hoverCell||(this.hoverCell=c),void((c[0]!==this.hoverCell[0]||c[1]!==this.hoverCell[1])&&(this.hoverCell=c,game.uiDrawer.removeActive(),game.uiDrawer.clearAllObjects(),game.uiDrawer.makeCellTooltip(a,d,a.target),game.uiDrawer.makeBuildingTipsForCell(d))))},a}(),UIDrawer=function(){function a(){this.fonts={},this.styles={},this.textureCache={},this.permanentUIObjects=[],this.layer=game.layers.tooltips,this.init()}return a.prototype.init=function(){this.fonts={base:{font:"16px Arial",fill:"#444444",align:"left"},black:{font:"bold 20pt Arial",fill:"#000000",align:"left"},green:{font:"bold 20pt Arial",fill:"#00FF00",stroke:"#005500",strokeThickness:2,align:"left"},red:{font:"bold 20pt Arial",fill:"#FF0000",stroke:"#550000",strokeThickness:2,align:"left"}},this.styles.base={lineStyle:{width:2,color:5798274,alpha:1},fillStyle:{color:15268863,alpha:.8}},this.textureCache={buildingPlacement:{positive1:PIXI.Texture.fromCanvas(new PIXI.Text("+",this.fonts.green).canvas),negative1:PIXI.Texture.fromCanvas(new PIXI.Text("-",this.fonts.red).canvas)}}},a.prototype.removeActive=function(){this.active&&(this.active.remove(),this.active=void 0)},a.prototype.clearAllObjects=function(){for(var a=0;a<this.permanentUIObjects.length;a++)this.permanentUIObjects[a].remove();this.permanentUIObjects=[],this.removeActive()},a.prototype.makeCellTooltip=function(a,b,c){var d=b.getScreenPos(c),e=d[0],f=d[1],g=a.global.x,h=a.global.y,i=b.content?b.content.type.title||b.content.type.type:b.type.type;if("landValue"===game.worldRenderer.currentMapmode&&(i+="\nLand value: "+b.landValue,i+="\nApproximate cost: "+parseInt(game.players.player0.getCellBuyCost(b))),b.content&&b.content.player&&b.content.baseProfit){var j=game.players.player0.getIndexedProfit(b.content.type.categoryType,b.content.modifiedProfit).toFixed(2);i+="\n--------------\n",i+="Base profit: "+b.content.baseProfit.toFixed(2)+"/d\n",i+="-------\n";for(var k in b.content.modifiers){var l=b.content.modifiers[k];l.scaling(l.strength)>0&&(i+="Modifier: "+l.title+" "+l.scaling(l.strength).toFixed(2)+"\n")}Object.keys(b.content.modifiers).length>0&&(i+="-------\n"),i+="Final profit: "+j+"/d"}var m,n,o=this.fonts.base,p=new PIXI.Text(i,o);g+p.width+100>SCREEN_WIDTH?(m="left",n=.75):(m="right",n=.25);var q=h-p.height-100<0?"up":"down",r=e,s=b.content&&"down"===q?f-b.content.sprites[0].height*b.content.sprites[0].worldTransform.a/2:f,t=this.active=new UIObject(this.layer).delay(500).lifeTime(-1),u=makeToolTip({style:this.styles.base,autoSize:!0,tipPos:n,tipWidth:10,tipHeight:20,tipDir:m,pointing:q,padding:[10,10]},p);return t.position.set(Math.round(r),Math.round(s-(b.sprite.height-SPRITE_HEIGHT))),t.addChild(u),t.start(),t},a.prototype.makeCellPopup=function(a,b,c,d){"undefined"==typeof d&&(d="black");var e=a.getScreenPos(c),f=new PIXI.Text(b,this.fonts[d]);this.makeFadeyPopup([e[0],e[1]],[0,-20],2e3,f)},a.prototype.makeBuildingTipsForCell=function(a,b){if("undefined"==typeof b&&(b=500),this.buildingTipTimeOut&&window.clearTimeout(this.buildingTipTimeOut),a.content&&a.content.player){var c=this;this.buildingTipTimeOut=window.setTimeout(function(){c.makeBuildingTips(a.content.cells,a.content.type)},b)}},a.prototype.makeBuildingTips=function(a,b){for(var c={positive1:[],negative1:[]},d=0;d<a.length;d++){var e=a[d].getValidModifiers(b);for(var f in e)if(!(e[f].strength<=0))for(var g=e[f].sources,h=e[f].effect[Object.keys(e[f].effect)[0]]>0,i=h===!0?"positive1":"negative1",j=0;j<g.length;j++)c[i][g[j].gridPos]=g[j]}for(var k in c)for(var l in c[k])this.makeBuildingPlacementTip(c[k][l],k,game.worldRenderer.worldSprite)},a.prototype.makeBuildingPlacementTip=function(a,b,c){var d=a.getScreenPos(c),e=new PIXI.Sprite(this.textureCache.buildingPlacement[b]),f=new UIObject(this.layer,!1);f.position.set(d[0],d[1]-10),f.addChild(e),e.width&&(e.position.x-=e.width/2,e.position.y-=e.height/2),f.start(),this.permanentUIObjects.push(f)},a.prototype.makeFadeyPopup=function(a,b,c,d,e){"undefined"==typeof e&&(e=TWEEN.Easing.Linear.None);var f=new TWEEN.Tween({alpha:1,x:a[0],y:a[1]});f.easing(e);var g=new UIObject(this.layer).lifeTime(c).onAdded(function(){f.start()}).onComplete(function(){TWEEN.remove(f)});return f.to({alpha:0,x:a[0]+b[0],y:a[1]+b[1]},c).onUpdate(function(){g.alpha=this.alpha,g.position.set(this.x,this.y)}),g.position.set(a[0],a[1]),d.width&&(d.position.x-=d.width/2,d.position.y-=d.height/2),g.addChild(d),g.start(),g},a.prototype.clearLayer=function(){for(var a=this.layer.children.length-1;a>=0;a--)this.layer.removeChild(this.layer.children[a])},a}(),Tool=function(){function a(){this.mapmode="default",this.continuous=!0,this.tempContinuous=!0}return a.prototype.activate=function(a){for(var b=0;b<a.length;b++)this.onActivate(a[b])},a.prototype.onChange=function(){},a.prototype.onActivate=function(){},a.prototype.onHover=function(){},a.prototype.onFinish=function(){},a}(),WaterTool=function(a){function b(){a.call(this),this.type="water",this.selectType=rectSelect,this.tintColor=4474111,this.mapmode=void 0}return __extends(b,a),b.prototype.onActivate=function(a){a.replace(cg.terrain.water)},b}(Tool),GrassTool=function(a){function b(){a.call(this),this.type="grass",this.selectType=rectSelect,this.tintColor=6388302,this.mapmode=void 0}return __extends(b,a),b.prototype.onActivate=function(a){a.replace(cg.terrain.grass)},b}(Tool),SandTool=function(a){function b(){a.call(this),this.type="sand",this.selectType=rectSelect,this.tintColor=14860179,this.mapmode=void 0}return __extends(b,a),b.prototype.onActivate=function(a){a.replace(cg.terrain.sand)},b}(Tool),SnowTool=function(a){function b(){a.call(this),this.type="snow",this.selectType=rectSelect,this.tintColor=12312535,this.mapmode=void 0}return __extends(b,a),b.prototype.onActivate=function(a){a.replace(cg.terrain.snow)},b}(Tool),RemoveTool=function(a){function b(){a.call(this),this.type="remove",this.selectType=rectSelect,this.tintColor=16733525,this.mapmode=void 0}return __extends(b,a),b.prototype.onActivate=function(a){"underground"!==game.worldRenderer.currentMapmode?a.changeContent("none"):a.changeUndergroundContent()},b}(Tool),SellTool=function(a){function b(){a.call(this),this.type="remove",this.selectType=rectSelect,this.tintColor=16733525,this.mapmode=void 0,this.button=null}return __extends(b,a),b.prototype.activate=function(a){for(var b=!1,c=0;c<a.length;c++)a[c].content&&a[c].player&&(b=!0);for(var c=0;c<a.length;c++)this.onActivate(a[c],{onlySellBuildings:b})},b.prototype.onActivate=function(a,b){var c=b.onlySellBuildings,d=a.player&&a.player.id===game.players.player0.id;c&&a.content&&d?(game.players.player0.sellContent(a.content),a.changeContent("none")):!c&&d&&game.players.player0.sellCell(a),this.continuous||this.tempContinuous||eventManager.dispatchEvent({type:"clickHotkey",content:""})
},b}(Tool),PlantTool=function(a){function b(){a.call(this),this.type="plant",this.selectType=rectSelect,this.tintColor=3377203,this.mapmode=void 0}return __extends(b,a),b.prototype.onActivate=function(a){a.addPlant()},b}(Tool),HouseTool=function(a){function b(){a.call(this),this.type="house",this.selectType=rectSelect,this.tintColor=6908265,this.mapmode=void 0}return __extends(b,a),b.prototype.onActivate=function(a){for(var b;;)if(b=getRandomProperty(cg.content.buildings),b.categoryType&&"apartment"===b.categoryType)break;a.changeContent(b)},b}(Tool),RoadTool=function(a){function b(){a.call(this),this.type="road",this.selectType=manhattanSelect,this.tintColor=6908265}return __extends(b,a),b.prototype.onActivate=function(a){a.changeContent(cg.content.roads.road_nesw)},b}(Tool),SubwayTool=function(a){function b(){a.call(this),this.type="subway",this.selectType=manhattanSelect,this.tintColor=6908265,this.mapmode="underground"}return __extends(b,a),b.prototype.onActivate=function(a){a.changeUndergroundContent(cg.content.tubes.tube_nesw)},b}(Tool),BuyTool=function(a){function b(){a.call(this),this.type="buy",this.selectType=singleSelect,this.tintColor=2289186,this.mapmode=void 0}return __extends(b,a),b.prototype.onActivate=function(a){eventManager.dispatchEvent({type:"makeCellBuyPopup",content:{player:game.players.player0,cell:a}}),this.continuous||this.tempContinuous||eventManager.dispatchEvent({type:"clickHotkey",content:""})},b}(Tool),BuildTool=function(a){function b(){a.call(this),this.timesTriedToBuiltOnNonOwnedPlot=0,this.ghostSprites=[],this.type="build",this.mapmode=void 0,this.button=null,this.setDefaults()}return __extends(b,a),b.prototype.setDefaults=function(){this.selectedBuildingType=void 0,this.selectType=singleSelect,this.tintColor=16777215,this.canBuild=!1,this.mainCell=void 0,this.continuous=!1,eventManager.dispatchEvent({type:"clickHotkey",content:""})},b.prototype.changeBuilding=function(a,b){if("undefined"==typeof b&&(b=!1),this.continuous=b,this.selectedBuildingType!==a){this.selectedBuildingType=a;var c=a.size||[1,1];this.selectType=function(a,b){var d=game.activeBoard.getCell(b);if(!d)return b;this.mainCell=d;var e=d.checkBuildable(this.selectedBuildingType,game.players.player0);return e?(this.tintColor=3377203,this.canBuild=!0):(this.tintColor=16733525,this.canBuild=!1),rectSelect(b,[b[0]+c[0]-1,b[1]+c[1]-1])}.bind(this)}},b.prototype.activate=function(a){if(this.canBuild===!0){var b=game.players.player0.getBuildCost(this.selectedBuildingType);eventManager.dispatchEvent(game.players.player0.money>=b?{type:"makeBuildingConstructPopup",content:{player:game.players.player0,buildingTemplate:this.selectedBuildingType,cell:this.mainCell,onOk:this.continuous||this.tempContinuous?function(){}:this.setDefaults.bind(this)}}:{type:"makeInfoPopup",content:{text:"Not enough funds"}})}else if(!a[0].player||a[0].player.id!==game.players.player0.id)for(var c=0;c<a.length;c++)eventManager.dispatchEvent({type:"makeCellBuyPopup",content:{player:game.players.player0,cell:a[c],onOk:this.continuous||this.tempContinuous?function(){}:this.setDefaults.bind(this)}});this.onFinish()},b.prototype.onHover=function(a){var b=a[0];if(b){var c=b.gridPos,d=this.selectedBuildingType.size||[1,1],e=b.board.getCells(rectSelect(c,[c[0]+d[0]-1,c[1]+d[1]-1])),f=getArea({targetArray:b.board.cells,start:c,centerSize:d,size:2,anchor:"nw"});this.clearEffects();for(var g=0;g<f.length;g++)game.highlighter.alphaBuildings(f,.2);if(!b.content)for(var g=0;g<e.length;g++){var h=e[g];if(h.content){this.clearGhostBuilding();break}var i=new Sprite(this.selectedBuildingType,g);i.alpha=.6,this.ghostSprites.push({sprite:i,pos:h.gridPos}),i.position=h.board.getCell(h.gridPos).sprite.position.clone(),h.board.addSpriteToLayer("content",i,h.gridPos)}for(var g=0;g<this.selectedBuildingType.translatedEffects.length;g++){var j=this.selectedBuildingType.translatedEffects[g],k=(this.selectedBuildingType.categoryType,b.getArea({size:j.range,centerSize:j.center,excludeStart:!0}));for(var h in k){var l=k[h],m=l.getModifierPolarity(j);if(null!==m)for(var n=m===!0?"positive1":"negative1",o=l.content?l.content.cells:l,p=0;p<o.length;p++)game.uiDrawer.makeBuildingPlacementTip(o[p],n,game.worldRenderer.worldSprite)}}game.uiDrawer.makeBuildingTips(e,this.selectedBuildingType)}},b.prototype.onFinish=function(){this.clearEffects(),this.mainCell=void 0},b.prototype.clearEffects=function(){game.highlighter.clearAlpha(),this.clearGhostBuilding()},b.prototype.clearGhostBuilding=function(){for(var a=0;a<this.ghostSprites.length;a++){var b=this.ghostSprites[a].sprite,c=this.ghostSprites[a].pos;this.mainCell.board.removeSpriteFromLayer("content",b,c)}this.ghostSprites=[]},b}(Tool),ClickTool=function(a){function b(){a.call(this),this.type="click",this.selectType=singleSelect,this.tintColor=null,this.mapmode=void 0,this.button=null}return __extends(b,a),b.prototype.onChange=function(){game.players.player0.money<1&&game.uiDrawer.makeFadeyPopup([SCREEN_WIDTH/2,SCREEN_HEIGHT/2],[0,0],3e3,new PIXI.Text("Click here!",{font:"bold 50px Arial",fill:"#FFFFFF",stroke:"#000000",strokeThickness:6,align:"center"}),TWEEN.Easing.Quartic.In)},b.prototype.onActivate=function(a){var b=game.players.player0,c=0;a.content&&a.content.player&&a.content.player.id===b.id&&(c+=.25*b.getIndexedProfitWithoutGlobals(a.content.type.categoryType,a.content.modifiedProfit));var d=b.addMoney(c,"click");b.addClicks(1),Options.drawClickPopups&&game.uiDrawer.makeCellPopup(a,""+d.toFixed(3),game.worldRenderer.worldSprite)},b}(Tool),NothingTool=function(a){function b(){a.call(this),this.type="nothing",this.selectType=singleSelect,this.tintColor=null,this.mapmode=void 0,this.button=null}return __extends(b,a),b.prototype.onActivate=function(){},b}(Tool),game=new Game,loader=new Loader(game),__extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},UIObject=function(a){function b(b,c){return"undefined"==typeof c&&(c=!0),a.call(this),this._timeouts={},this._callbacks={start:[],added:[],complete:[]},this._delay=0,this._lifeTime=-1,this.visible=!1,this.setParent(b),this._destroyChildren=c,this}return __extends(b,a),b.prototype.start=function(){var a=this;return a.fireCallbacks("start"),a._timeouts.add=window.setTimeout(function(){a._parent.addChild(a),a.visible=!0,a.fireCallbacks("added"),a._lifeTime>0&&(a._timeouts.remove=window.setTimeout(function(){a.remove.call(a)},a._lifeTime))},a._delay),this},b.prototype.setParent=function(a){return this._parent=a,this},b.prototype.delay=function(a){return this._delay=a,this},b.prototype.lifeTime=function(a){return this._lifeTime=a,this},b.prototype.addChild=function(b){return a.prototype.addChild.call(this,b),this},b.prototype.fireCallbacks=function(a){if(!this._callbacks[a])throw new Error("UIObject fired callbacks with id: "+a);for(var b=this._callbacks[a],c=0;c<b.length;c++)b[c].call();return this},b.prototype.remove=function(){this.fireCallbacks("complete"),this.clearTimeouts(),this.parent&&this.parent.removeChild(this),this._destroyChildren&&deepDestroy(this)},b.prototype.onStart=function(a){return this._callbacks.start.push(a),this},b.prototype.onAdded=function(a){return this._callbacks.added.push(a),this},b.prototype.onComplete=function(a){return this._callbacks.complete.push(a),this},b.prototype.clearTimeouts=function(){for(var a in this._timeouts)window.clearTimeout(this._timeouts[a])},b}(PIXI.DisplayObjectContainer);